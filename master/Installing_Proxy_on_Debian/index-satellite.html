<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Installing Capsule Server</title>
<link rel="stylesheet" href="./satellite.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Installing Capsule Server</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#preparing-environment-for-capsule-installation">1. Preparing your Environment for Installation</a>
<ul class="sectlevel2">
<li><a href="#system-requirements_capsule">1.1. System Requirements</a></li>
<li><a href="#capsule-storage-requirements_capsule">1.2. Storage Requirements</a></li>
<li><a href="#storage-guidelines_capsule">1.3. Storage Guidelines</a></li>
<li><a href="#supported-operating-systems_capsule">1.4. Supported Operating Systems</a></li>
<li><a href="#capsule-ports-and-firewalls-requirements_capsule">1.5. Ports and Firewalls Requirements</a></li>
<li><a href="#enabling-connections-from-capsule-to-satellite_capsule">1.6. Enabling Connections from Capsule&#160;Server to Satellite&#160;Server</a></li>
<li><a href="#enabling-connections-to-capsule_capsule">1.7. Enabling Connections from Satellite&#160;Server and Clients to a Capsule&#160;Server</a></li>
<li><a href="#verifying-firewall-settings_capsule">1.8. Verifying Firewall Settings</a></li>
</ul>
</li>
<li><a href="#installing-capsule-server">2. Installing Capsule&#160;Server</a>
<ul class="sectlevel2">
<li><a href="#registering-to-satellite-server_capsule">2.1. Registering to Satellite&#160;Server</a></li>
<li><a href="#attaching-satellite-infrastructure-subscription_capsule">2.2. Attaching the Satellite Infrastructure Subscription</a></li>
<li><a href="#configuring-repositories-proxy_capsule">2.3. Configuring Repositories</a></li>
<li><a href="#installing-capsule-server-packages_capsule">2.4. Installing Capsule&#160;Server Packages</a></li>
<li><a href="#synchronizing-the-system-clock-with-chronyd_capsule">2.5. Synchronizing the System Clock With chronyd</a></li>
<li><a href="#configuring-capsule-server-with-ssl-certificates">2.6. Configuring Capsule&#160;Server with SSL Certificates</a></li>
</ul>
</li>
<li><a href="#performing-additional-configuration-on-capsule-server">3. Performing Additional Configuration on Capsule&#160;Server</a>
<ul class="sectlevel2">
<li><a href="#installing-the-katello-agent_capsule">3.1. Installing the Katello Agent</a></li>
<li><a href="#enabling-remote-execution_capsule">3.2. Enabling Remote Execution on Capsule&#160;Server</a></li>
<li><a href="#enabling-openscap_capsule">3.3. Enabling OpenSCAP on External Capsules</a></li>
<li><a href="#adding-life-cycle-environments_capsule">3.4. Adding Life Cycle Environments to Capsule&#160;Servers</a></li>
<li><a href="#enabling-power-management-on-managed-hosts_capsule">3.5. Enabling Power Management on Managed Hosts</a></li>
<li><a href="#configuring-dns-dhcp-and-tftp_capsule">3.6. Configuring DNS, DHCP, and TFTP on Capsule&#160;Server</a></li>
<li><a href="#restricting-access-to-mongod_capsule">3.7. Restricting Access to mongod</a></li>
</ul>
</li>
<li><a href="#capsule-server-scalability-considerations_capsule">Appendix A: Capsule&#160;Server Scalability Considerations</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="preparing-environment-for-capsule-installation">1. Preparing your Environment for Installation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="system-requirements_capsule">1.1. System Requirements</h3>
<div class="paragraph">
<p>The following requirements apply to the networked base operating system:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>x86_64 architecture</p>
</li>
<li>
<p>The latest version of Red Hat Enterprise Linux 7 Server</p>
</li>
<li>
<p>4-core 2.0 GHz CPU at a minimum</p>
</li>
<li>
<p>A minimum of 12 GB RAM is required for Capsule&#160;Server to function. In addition, a minimum of 4 GB RAM of swap space is also recommended. Capsule running with less RAM than the minimum value might not operate correctly.</p>
</li>
<li>
<p>A unique host name, which can contain lower-case letters, numbers, dots (.) and hyphens (-)</p>
</li>
<li>
<p>A current Red&#160;Hat Satellite subscription</p>
</li>
<li>
<p>Administrative user (root) access</p>
</li>
<li>
<p>A system umask of 0022</p>
</li>
<li>
<p>Full forward and reverse DNS resolution using a fully-qualified domain name</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Before you install Capsule&#160;Server, ensure that your environment meets the requirements for installation.</p>
</div>
<div class="paragraph">
<p>Capsule&#160;Server must be installed on a freshly provisioned system that serves no other function except to run Capsule&#160;Server. The freshly provisioned system must not have the following users provided by external identity providers to avoid conflicts with the local users that Capsule&#160;Server creates:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>postgres</p>
</li>
<li>
<p>mongodb</p>
</li>
<li>
<p>apache</p>
</li>
<li>
<p>qpidd</p>
</li>
<li>
<p>qdrouterd</p>
</li>
<li>
<p>squid</p>
</li>
<li>
<p>foreman-proxy</p>
</li>
<li>
<p>puppet</p>
</li>
<li>
<p>puppetserver</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information on scaling your Capsule&#160;Servers, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.7/html/installing_capsule_server/capsule-server-scalability-considerations_capsule">Capsule&#160;Server Scalability Considerations</a>.</p>
</div>
<div class="paragraph">
<div class="title">Certified hypervisors</div>
<p>Capsule&#160;Server is fully supported on both physical systems and virtual machines that run on hypervisors that are supported to run Red&#160;Hat Enterprise Linux. For more information about certified hypervisors, see <a href="https://access.redhat.com/certified-hypervisors">Which hypervisors are certified to run Red Hat Enterprise Linux?</a>.</p>
</div>
<div class="paragraph">
<div class="title">FIPS Mode</div>
<p>You can install Capsule&#160;Server on a Red&#160;Hat Enterprise Linux system that is operating in FIPS mode. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/security_guide/chap-federal_standards_and_regulations#sec-Enabling-FIPS-Mode">Enabling FIPS Mode</a> in the <em>Red&#160;Hat Enterprise Linux Security Guide</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="capsule-storage-requirements_capsule">1.2. Storage Requirements</h3>
<div class="paragraph">
<p>The following table details storage requirements for specific directories. These values are based on expected use case scenarios and can vary according to individual environments.</p>
</div>
<div class="paragraph">
<p>The runtime size was measured with Red&#160;Hat Enterprise Linux 6, 7, and 8 repositories synchronized.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Storage Requirements for Capsule&#160;Server Installation</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Directory</th>
<th class="tableblock halign-left valign-top">Installation Size</th>
<th class="tableblock halign-left valign-top">Runtime Size</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/var/cache/pulp/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20 GB (Minimum)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/var/lib/pulp/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">300 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/var/lib/mongodb/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.5 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">50 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">500 MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not Applicable</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="storage-guidelines_capsule">1.3. Storage Guidelines</h3>
<div class="paragraph">
<p>Consider the following guidelines when installing Capsule&#160;Server to increase efficiency.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Because most Capsule&#160;Server data is stored in the <code>/var</code> directory, mounting <code>/var</code> on LVM storage can help the system to scale.</p>
</li>
<li>
<p>Using the same volume for the <code>/var/cache/pulp/</code> and <code>/var/lib/pulp/</code> directories can decrease the time required to move content from <code>/var/cache/pulp/</code> to <code>/var/lib/pulp/</code> after synchronizing.</p>
</li>
<li>
<p>The <code>/var/lib/qpidd/</code> directory uses slightly more than 2 MB per Content Host managed by the <code>goferd</code> service. For example, 10 000 Content Hosts require 20 GB of disk space in <code>/var/lib/qpidd/</code>.</p>
</li>
<li>
<p>Use high-bandwidth, low-latency storage for the <code>/var/lib/pulp/</code> and <code>/var/lib/mongodb/</code> directories. As Red&#160;Hat Satellite has many operations that are I/O intensive, using high latency, low-bandwidth storage causes performance degradation. Ensure your installation has a speed in the range 60 - 80 Megabytes per second.
You can use the <code>fio</code> tool to get this data. See the Red&#160;Hat Knowledgebase solution <a href="https://access.redhat.com/solutions/3397771">Impact of Disk Speed on Satellite Operations</a> for more information on using the <code>fio</code> tool.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">File System Guidelines</div>
<ul>
<li>
<p>Use the XFS file system for Red&#160;Hat Satellite&#160;6 because it does not have the inode limitations that <code>ext4</code> does. Because Capsule&#160;Server uses a lot of symbolic links it is likely that your system might run out of inodes if using <code>ext4</code> and the default number of inodes.</p>
</li>
<li>
<p>Do not use NFS with MongoDB because MongoDB does not use conventional I/O to access data files and performance problems occur when both the data files and the journal files are hosted on NFS. If required to use NFS, mount the volume with the following options in the <code>/etc/fstab</code> file: <code>bg</code>, <code>nolock</code>, and <code>noatime</code>.</p>
</li>
<li>
<p>Do not use NFS for Pulp data storage. Using NFS for Pulp has a negative performance impact on content synchronization.</p>
</li>
<li>
<p>Do not use the GFS2 file system as the input-output latency is too high.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Log File Storage</div>
<p>Log files are written to <code>/var/log/messages/,</code> <code>/var/log/httpd/</code>, and <code>/var/lib/foreman-proxy/openscap/content/</code>. You can manage the size of these files using <strong>logrotate</strong>.
For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/ch-viewing_and_managing_log_files#s2-log_rotation">Log Rotation</a> in the <em>Red Hat Enterprise Linux 7 System Administrator’s Guide</em>.</p>
</div>
<div class="paragraph">
<p>The exact amount of storage you require for log messages depends on your installation and setup.</p>
</div>
<div class="paragraph">
<div class="title">SELinux Considerations for NFS Mount</div>
<p>When the <code>/var/lib/pulp</code> directory is mounted using an NFS share, SELinux blocks the synchronization process. To avoid this, specify the SELinux context of the <code>/var/lib/pulp</code> directory in the file system table by adding the following lines to <code>/etc/fstab</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>nfs.example.com:/nfsshare  /var/lib/pulp/content  nfs  context="system_u:object_r:httpd_sys_rw_content_t:s0"  1 2</pre>
</div>
</div>
<div class="paragraph">
<p>If NFS share is already mounted, remount it using the above configuration and enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># chcon -R system_u:object_r:httpd_sys_rw_content_t:s0 /var/lib/pulp</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Duplicated Packages</div>
<p>Packages that are duplicated in different repositories are only stored once on the disk. Additional repositories containing duplicate packages require less additional storage. The bulk of storage resides in the <code>/var/lib/mongodb/</code> and <code>/var/lib/pulp/</code> directories. These end points are not manually configurable. Ensure that storage is available on the <code>/var</code> file system to prevent storage problems.</p>
</div>
<div class="paragraph">
<div class="title">Temporary Storage</div>
<p>The <code>/var/cache/pulp/</code> directory is used to temporarily store content while it is being synchronized. For content in RPM format, a maximum of 5 RPM files are stored in this directory at any time. After each file is synchronized, it is moved to the <code>/var/lib/pulp/</code> directory. Up to 8 RPM content synchronization tasks can run simultaneously by default, with each using up to 1 GB of metadata.</p>
</div>
<div class="paragraph">
<div class="title">Software Collections</div>
<p>Software collections are installed in the <code>/opt/rh/</code> and <code>/opt/theforeman/</code> directories.</p>
</div>
<div class="paragraph">
<p>Write and execute permissions by the root user are required for installation to the <code>/opt</code> directory.</p>
</div>
<div class="paragraph">
<div class="title">Symbolic links</div>
<p>You cannot use symbolic links for <code>/var/lib/pulp/</code> and <code>/var/lib/mongodb/</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="supported-operating-systems_capsule">1.4. Supported Operating Systems</h3>
<div class="paragraph">
<p>You can install the operating system from a disc, local ISO image, kickstart, or any other method that Red&#160;Hat supports. Red&#160;Hat Capsule&#160;Server is supported only on the latest versions of Red&#160;Hat Enterprise Linux 7 Server that is available at the time when Capsule&#160;Server 6.7 is installed. Previous versions of Red&#160;Hat Enterprise Linux including EUS or z-stream are not supported.</p>
</div>
<div class="paragraph">
<p>Red&#160;Hat Capsule&#160;Server requires a Red&#160;Hat Enterprise Linux installation with the <code>@Base</code> package group with no other package-set modifications, and without third-party configurations or software not directly necessary for the direct operation of the server. This restriction includes hardening and other non-Red&#160;Hat security software. If you require such software in your infrastructure, install and verify a complete working Capsule&#160;Server first, then create a backup of the system before adding any non-Red&#160;Hat software.</p>
</div>
<div class="paragraph">
<p>Install Capsule&#160;Server on a freshly provisioned system.</p>
</div>
<div class="paragraph">
<p>Do not register Capsule&#160;Server to the Red&#160;Hat Content Delivery Network (CDN).</p>
</div>
<div class="paragraph">
<p>Red&#160;Hat does not support using the system for anything other than running Capsule&#160;Server.</p>
</div>
</div>
<div class="sect2">
<h3 id="capsule-ports-and-firewalls-requirements_capsule">1.5. Ports and Firewalls Requirements</h3>
<div class="paragraph">
<p>For the components of Satellite architecture to communicate, ensure that the required network ports are open and free on the base operating system. You must also ensure that the required network ports are open on any network-based firewalls.</p>
</div>
<div class="paragraph">
<p>The installation of a Capsule&#160;Server fails if the ports between Satellite&#160;Server and Capsule&#160;Server are not open before installation starts.</p>
</div>
<div class="paragraph">
<p>Use this information to configure any network-based firewalls. Note that some cloud solutions must be specifically configured to allow communications between machines because they isolate machines similarly to network-based firewalls.
If you use an application-based firewall, ensure that the application-based firewall permits all applications that are listed in the tables and known to your firewall. If possible, disable the application checking and allow open port communication based on the protocol.</p>
</div>
<div class="paragraph">
<div class="title">Integrated Capsule</div>
<p>Satellite&#160;Server has an integrated Capsule and any host that is directly connected to Satellite&#160;Server is a Client of Satellite in the context of this section. This includes the base operating system on which Capsule&#160;Server is running.</p>
</div>
<div class="paragraph">
<div class="title">Clients of Capsule</div>
<p>Hosts which are clients of Capsules, other than Satellite&#8217;s integrated Capsule, do not need access to Satellite&#160;Server. For more information on Satellite Topology, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.7/html/planning_for_red_hat_satellite_6/chap-documentation-architecture_guide-capsule_server_overview#sect-Documentation-Architecture_Guide-Capsule_Networking">Capsule Networking</a> in <em>Planning for Red&#160;Hat Satellite&#160;6</em>.</p>
</div>
<div class="paragraph">
<p>Required ports can change based on your configuration.</p>
</div>
<div class="paragraph">
<p>A matrix table of ports is available in the Red&#160;Hat Knowledgebase solution <a href="https://access.redhat.com/solutions/4527661">Red Hat Satellite 6.6 List of Network Ports</a>.</p>
</div>
<div class="paragraph">
<p>The following tables indicate the destination port and the direction of network traffic:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Ports for Capsule to Satellite Communication</caption>
<colgroup>
<col style="width: 24%;">
<col style="width: 20%;">
<col style="width: 18%;">
<col style="width: 38%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Port</th>
<th class="tableblock halign-left valign-top">Protocol</th>
<th class="tableblock halign-left valign-top">Service</th>
<th class="tableblock halign-left valign-top">Required For</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5646</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">amqp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Capsule&#8217;s Qpid dispatch router to Qpid dispatch router in Satellite</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Ports for Client to Capsule Communication</caption>
<colgroup>
<col style="width: 24%;">
<col style="width: 20%;">
<col style="width: 18%;">
<col style="width: 38%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Port</th>
<th class="tableblock halign-left valign-top">Protocol</th>
<th class="tableblock halign-left valign-top">Service</th>
<th class="tableblock halign-left valign-top">Required for</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Anaconda, yum, and for obtaining Katello certificate
updates</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Anaconda, yum, Telemetry Services, and Puppet</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5646</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AMQP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Capsule Qpid dispatch router to the Qpid dispatch router in Satellite</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5647</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AMQP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Katello agent to communicate with Capsule&#8217;s
Qpid dispatch router</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Anaconda to download kickstart templates to hosts,
and for downloading iPXE firmware</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8140</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Puppet agent to Puppet master connections</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subscription Management Services and Telemetry Services</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9090</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sending SCAP reports to the Capsule and for the discovery image during provisioning</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">53</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP and UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client DNS queries to a Capsule&#8217;s DNS service (Optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">67</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client to Capsule broadcasts, DHCP broadcasts for Client provisioning from a Capsule (Optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">69</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TFTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clients downloading PXE boot image files from a Capsule for provisioning (Optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection to Katello for the Docker registry (Optional)</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Ports for Capsule to Client Communication</caption>
<colgroup>
<col style="width: 24%;">
<col style="width: 20%;">
<col style="width: 18%;">
<col style="width: 38%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Port</th>
<th class="tableblock halign-left valign-top">Protocol</th>
<th class="tableblock halign-left valign-top">Service</th>
<th class="tableblock halign-left valign-top">Required For</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP and UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ICMP</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>DHCP Capsule to Client network, ICMP ECHO to verify IP address is free (Optional)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">68</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Capsule to Client broadcasts, DHCP broadcasts for Client provisioning from a Capsule (Optional)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Capsule to Client "reboot" command to a discovered host during provisioning (Optional)</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Any managed host that is directly connected to Satellite&#160;Server is a client in this context because it is a client of the integrated Capsule. This includes the base operating system on which a Capsule&#160;Server is running.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Optional Network Ports</caption>
<colgroup>
<col style="width: 24%;">
<col style="width: 20%;">
<col style="width: 18%;">
<col style="width: 38%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Port</th>
<th class="tableblock halign-left valign-top">Protocol</th>
<th class="tableblock halign-left valign-top">Service</th>
<th class="tableblock halign-left valign-top">Required For</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSH</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Satellite and Capsule originated communications, for Remote Execution (Rex) and Ansible.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7911</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Capsule originated commands for orchestration of DHCP records (local or external).</p>
</li>
<li>
<p>If DHCP is provided by an external service, you must open the port on the external server.</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
A DHCP Capsule sends an ICMP ECHO to confirm an IP address is free, <strong>no response</strong> of any kind is expected. ICMP can be dropped by a networked-based firewall, but <strong>any</strong> response prevents the allocation of IP addresses.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="enabling-connections-from-capsule-to-satellite_capsule">1.6. Enabling Connections from Capsule&#160;Server to Satellite&#160;Server</h3>
<div class="paragraph">
<p>On Satellite&#160;Server, you must enable the incoming connection from Capsule&#160;Server to Satellite&#160;Server and make this rule persistent across reboots.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that the firewall rules on Satellite&#160;Server are configured to enable connections for client to Satellite communication, because Capsule&#160;Server is a client of Satellite&#160;Server. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.7/html/installing_satellite_server_from_a_connected_network/preparing-environment-for-satellite-installation#enabling-client-connections-to-satellite_satellite">Enabling Connections from a Client to Satellite&#160;Server</a> in <em>Installing Satellite Server from a Connected Network</em>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On Satellite&#160;Server, enter the following command to open the port for Capsule to Satellite communication:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --add-port="5646/tcp"</pre>
</div>
</div>
</li>
<li>
<p>Make the changes persistent:</p>
<div class="listingblock">
<div class="content">
<pre># firewall-cmd --runtime-to-permanent</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="enabling-connections-to-capsule_capsule">1.7. Enabling Connections from Satellite&#160;Server and Clients to a Capsule&#160;Server</h3>
<div class="paragraph">
<p>On the base operating system on which you want to install Capsule, you must enable incoming connections from Satellite&#160;Server and clients to Capsule&#160;Server and make these rules persistent across reboots.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On the base operating system on which you want to install Capsule, enter the following command to open the ports for Satellite&#160;Server and clients communication to Capsule&#160;Server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --add-port="53/udp" --add-port="53/tcp" \
--add-port="67/udp" --add-port="69/udp" \
--add-port="80/tcp" --add-port="443/tcp" \
--add-port="5000/tcp" --add-port="5647/tcp" \
--add-port="8000/tcp" --add-port="8140/tcp" \
--add-port="8443/tcp" --add-port="9090/tcp"</pre>
</div>
</div>
</li>
<li>
<p>Make the changes persistent:</p>
<div class="listingblock">
<div class="content">
<pre># firewall-cmd --runtime-to-permanent</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="verifying-firewall-settings_capsule">1.8. Verifying Firewall Settings</h3>
<div class="paragraph">
<p>Use this procedure to verify your changes to the firewall settings.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To verify the firewall settings, complete the following step:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --list-all</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/security_guide/sec-using_firewalls#sec-Getting_started_with_firewalld">Getting Started with firewalld</a> in the <em>Red Hat Enterprise Linux 7 Security Guide</em>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installing-capsule-server">2. Installing Capsule&#160;Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before you install Capsule&#160;Server, you must ensure that your environment meets the requirements for installation.
For more information, see <a href="#system-requirements_capsule">System Requirements</a>.</p>
</div>
<div class="sect2">
<h3 id="registering-to-satellite-server_capsule">2.1. Registering to Satellite&#160;Server</h3>
<div class="paragraph">
<p>Use this procedure to register the base operating system on which you want to install Capsule&#160;Server to Satellite&#160;Server.</p>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>Before registering it to Satellite&#160;Server, ensure that the base operating system on which you want to install Capsule meets the following conditions:</p>
</div>
<div class="ulist">
<div class="title">Subscription Manifest Prerequisites</div>
<ul>
<li>
<p>On Satellite&#160;Server, a manifest must be installed and it must contain the appropriate repositories for the organization you want Capsule to belong to.</p>
</li>
<li>
<p>The manifest must contain repositories for the base operating system on which you want to install Capsule, as well as any clients that you want to connect to Capsule.</p>
</li>
<li>
<p>The repositories must be synchronized.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information on manifests and repositories, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.7/html/content_management_guide/managing_subscriptions/">Managing Subscriptions</a> in the <em>Red&#160;Hat Satellite Content Management Guide</em>.</p>
</div>
<div class="ulist">
<div class="title">Proxy and Network Prerequisites</div>
<ul>
<li>
<p>The Satellite&#160;Server base operating system must be able to resolve the host name of the Capsule base operating system and vice versa.</p>
</li>
<li>
<p>The base operating system on which you want to install Capsule&#160;Server must not be configured to use a proxy to connect to the Red Hat CDN.</p>
</li>
<li>
<p>You must configure the host and network-based firewalls accordingly. For more information, see <a href="#capsule-ports-and-firewalls-requirements_capsule">Ports and Firewalls Requirements</a>.</p>
</li>
<li>
<p>You must have a Satellite&#160;Server user name and password. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.7/html/administering_red_hat_satellite/chap-red_hat_satellite-administering_red_hat_satellite-configuring_external_authentication">Configuring External Authentication</a> in <em>Administering Red&#160;Hat Satellite</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To register your system to Satellite&#160;Server, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download the <code>katello-ca-consumer-latest.noarch.rpm</code> package on the base operating system on which you want to install Capsule. The consumer RPM configures the host to download content from the content source that is specified in Satellite.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># curl --insecure --output katello-ca-consumer-latest.noarch.rpm https://<em>satellite.example.com</em>/pub/katello-ca-consumer-latest.noarch.rpm</pre>
</div>
</div>
</li>
<li>
<p>Install the <code>katello-ca-consumer-latest.noarch.rpm</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum localinstall katello-ca-consumer-latest.noarch.rpm</pre>
</div>
</div>
</li>
<li>
<p>Register the Capsule base operating system with the environments that you want Capsule to belong to. Use an activation key to simplify specifying the environments. For more information about activation keys, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.7/html/content_management_guide/managing_activation_keys">Managing Activation Keys</a> in the <em>Content Management Guide</em>.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># subscription-manager register --org=<em>organization_name</em> --activationkey=<em>example_activation_key</em></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="attaching-satellite-infrastructure-subscription_capsule">2.2. Attaching the Satellite Infrastructure Subscription</h3>
<div class="paragraph">
<p>After you have registered Capsule&#160;Server, you must identify your subscription Pool ID and attach an available subscription. The Red&#160;Hat Satellite Infrastructure subscription provides access to the Red&#160;Hat Satellite, Red&#160;Hat Enterprise Linux, and Red&#160;Hat Software Collections (RHSCL) content. This is the only subscription required.</p>
</div>
<div class="paragraph">
<p>Red&#160;Hat Satellite Infrastructure is included with all subscriptions that include Smart Management. For more information, see the Red&#160;Hat Knowledgebase solution <a href="https://access.redhat.com/solutions/3382781">Satellite Infrastructure Subscriptions MCT3718 MCT3719</a>.</p>
</div>
<div class="paragraph">
<p>Subscriptions are classified as available if they are not already attached to a system. If you are unable to find an available Satellite subscription, see the Red&#160;Hat Knowledgebase solution <a href="https://access.redhat.com/solutions/2058823">How do I figure out which subscriptions have been consumed by clients registered under Red Hat Subscription Manager?</a> to run a script to see if your subscription is being consumed by another system.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Identify the Pool ID of the Satellite Infrastructure subscription:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># subscription-manager list --all --available --matches 'Red Hat Satellite Infrastructure Subscription (Beta)'</pre>
</div>
</div>
<div class="paragraph">
<p>The command displays output similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Subscription Name:   Red Hat Satellite Infrastructure Subscription (Beta)
Provides:            Red Hat Satellite
                      Red Hat Software Collections (for RHEL Server)
                      Red Hat CodeReady Linux Builder for x86_64
                      Red Hat Ansible Engine
                      Red Hat Enterprise Linux Load Balancer (for RHEL Server)
                      Red Hat
                      Red Hat Software Collections (for RHEL Server)
                      Red Hat Enterprise Linux Server
                      Red Hat Satellite Capsule
                      Red Hat Enterprise Linux for x86_64
                      Red Hat Enterprise Linux High Availability for x86_64
                      Red Hat Satellite
                      Red Hat Satellite 5 Managed DB
                      Red Hat Satellite 6
                      Red Hat Discovery
SKU:                 MCT3719
Contract:            11878983
Pool ID:             8a85f99968b92c3701694ee998cf03b8
Provides Management: No
Available:           1
Suggested:           1
Service Level:       Premium
Service Type:        L1-L3
Subscription Type:   Standard
Ends:                03/04/2020
System Type:         Physical</pre>
</div>
</div>
</li>
<li>
<p>Make a note of the subscription Pool ID. Your subscription Pool ID is different from the example provided.</p>
</li>
<li>
<p>Attach the Satellite Infrastructure subscription to the base operating system that your Capsule&#160;Server is running on:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># subscription-manager attach --pool=<em>pool_id</em></pre>
</div>
</div>
<div class="paragraph">
<p>The command displays output similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Successfully attached a subscription for: Red Hat Satellite Infrastructure Subscription</pre>
</div>
</div>
</li>
<li>
<p>Optional: Verify that the Satellite Infrastructure subscription is attached:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># subscription-manager list --consumed</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-repositories-proxy_capsule">2.3. Configuring Repositories</h3>
<div class="paragraph">
<p>Use this procedure to enable the repositories that are required to install Capsule&#160;Server.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To configure the required repositories, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Disable all repositories:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># subscription-manager repos --disable "*"</pre>
</div>
</div>
</li>
<li>
<p>Enable the following repositories:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># subscription-manager repos --enable=rhel-7-server-rpms \
--enable=rhel-server-7-satellite-capsule-6-beta-rpms \
--enable=rhel-7-server-satellite-maintenance-6-beta-rpms \
--enable=rhel-7-server-satellite-tools-6-beta-rpms \
--enable=rhel-server-rhscl-7-rpms \
--enable=rhel-7-server-ansible-2.9-rpms</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you are installing Capsule&#160;Server as a virtual machine hosted on Red&#160;Hat&#160;Virtualization, you must also enable the <strong>Red&#160;Hat Common</strong> repository, and install Red&#160;Hat&#160;Virtualization guest agents and drivers. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.3/html/virtual_machine_management_guide/installing_guest_agents_and_drivers_linux#Installing_the_Guest_Agents_and_Drivers_on_Red_Hat_Enterprise_Linux">Installing the Guest Agents and Drivers on Red Hat Enterprise Linux</a> in the <em>Virtual Machine Management Guide</em> for more information.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Clear any metadata:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum clean all</pre>
</div>
</div>
</li>
<li>
<p>Optional: Verify that the required repositories are enabled:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum repolist enabled</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="installing-capsule-server-packages_capsule">2.4. Installing Capsule&#160;Server Packages</h3>
<div class="paragraph">
<p>Before installing the Capsule&#160;Server packages, you must update all packages that are installed on the base operating system.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To install Capsule&#160;Server, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Update all packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum update</pre>
</div>
</div>
</li>
<li>
<p>Install the <code>satellite-capsule</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install satellite-capsule</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="synchronizing-the-system-clock-with-chronyd_capsule">2.5. Synchronizing the System Clock With chronyd</h3>
<div class="paragraph">
<p>To minimize the effects of time drift, you must synchronize the system clock on the base operating system on which you want to install Capsule&#160;Server with Network Time Protocol (NTP) servers. If the base operating system clock is configured incorrectly, certificate verification might fail.</p>
</div>
<div class="paragraph">
<p>For more information about the <code>chrony</code> suite, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/ch-configuring_ntp_using_the_chrony_suite">Configuring NTP Using the chrony Suite</a> in the <em>Red Hat Enterprise Linux 7 System Administrator&#8217;s Guide</em>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install the <code>chrony</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install chrony</pre>
</div>
</div>
</li>
<li>
<p>Start and enable the <code>chronyd</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl start chronyd
# systemctl enable chronyd</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-capsule-server-with-ssl-certificates">2.6. Configuring Capsule&#160;Server with SSL Certificates</h3>
<div class="paragraph">
<p>Red&#160;Hat Satellite uses SSL certificates to enable encrypted communications between Satellite&#160;Server, external Capsule&#160;Servers, and all hosts. Depending on the requirements of your organization, you must configure your Capsule&#160;Server with a default or custom certificate.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you use a default SSL certificate, you must also configure each external Capsule&#160;Server with a distinct default SSL certificate. For more information, see <a href="#configuring-capsule-default-certificate_capsule">Configuring Capsule&#160;Server with a Default SSL Certificate</a>.</p>
</li>
<li>
<p>If you use a custom SSL certificate, you must also configure each external Capsule&#160;Server with a distinct custom SSL certificate. For more information, see <a href="#configuring-capsule-custom-server-certificate_capsule">Configuring Capsule&#160;Server with a Custom SSL Certificate</a>.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="configuring-capsule-default-certificate_capsule">2.6.1. Configuring Capsule&#160;Server with a Default SSL Certificate</h4>
<div class="paragraph">
<p>Use this section to configure Capsule&#160;Server with an SSL certificate that is signed by the Satellite&#160;Server default Certificate Authority (CA).</p>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>Before configuring Capsule&#160;Server with a default server certificate, ensure that your Capsule&#160;Server meets the following conditions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Capsule&#160;Server is registered to Satellite&#160;Server. For more information, see <a href="#registering-to-satellite-server_capsule">Registering to Satellite&#160;Server</a>.</p>
</li>
<li>
<p>The Capsule&#160;Server packages are installed. For more information, see <a href="#installing-capsule-server-packages_capsule">Installing Capsule&#160;Server Packages</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To configure Capsule&#160;Server with a default server certificate, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On Satellite&#160;Server, to store all the source certificate files for your Capsule&#160;Server, create a directory that is accessible only to the <code>root</code> user, for example <code>/root/capsule_cert</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir /root/<em>capsule_cert</em></pre>
</div>
</div>
</li>
<li>
<p>On Satellite&#160;Server, generate the <code><em>/root/capsule_cert/capsule_certs.tar</em></code> certificate archive for your Capsule&#160;Server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># capsule-certs-generate \
--foreman-proxy-fqdn <em>capsule.example.com</em> \
--certs-tar <em>/root/capsule_cert/capsule_certs.tar</em></pre>
</div>
</div>
<div class="paragraph">
<p>Retain a copy of the <code>satellite-installer</code> command that the <code>capsule-certs-generate</code> command returns for deploying the certificate to your Capsule&#160;Server.</p>
</div>
<div class="listingblock">
<div class="title">Example output of <code>capsule-certs-generate</code></div>
<div class="content">
<pre class="nowrap"><em>output omitted</em>
satellite-installer \
--scenario capsule \
--certs-tar-file                              "<em>/root/capsule_certs.tar</em>"\
--foreman-proxy-content-parent-fqdn           "<em>satellite.example.com</em>"\
--foreman-proxy-register-in-foreman           "true"\
--foreman-proxy-foreman-base-url              "https://<em>satellite.example.com</em>"\
--foreman-proxy-trusted-hosts                 "<em>satellite.example.com</em>"\
--foreman-proxy-trusted-hosts                 "<em>capsule.example.com</em>"\
--foreman-proxy-oauth-consumer-key            "<em>s97QxvUAgFNAQZNGg4F9zLq2biDsxM7f</em>"\
--foreman-proxy-oauth-consumer-secret         "<em>6bpzAdMpRAfYaVZtaepYetomgBVQ6ehY</em>"\
--puppet-server-foreman-url                   "https://<em>satellite.example.com</em>"</pre>
</div>
</div>
</li>
<li>
<p>On Satellite&#160;Server, copy the certificate archive file to your Capsule&#160;Server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp /root/capsule_cert/<em>capsule.example.com</em>-certs.tar \
root@<em>capsule.example.com</em>:/root/<em>capsule.example.com</em>-certs.tar</pre>
</div>
</div>
</li>
<li>
<p>On Capsule&#160;Server, to deploy the certificate, enter the <code>satellite-installer</code> command that the <code>capsule-certs-generate</code> command returns.</p>
<div class="paragraph">
<p>When network connections or ports to Satellite are not yet open, you can set the <code>--foreman-proxy-register-in-foreman</code> option to <code>false</code> to prevent Capsule from attempting to connect to Satellite and reporting errors. Run the installer again with this option set to <code>true</code> when the network and firewalls are correctly configured.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Do not delete the certificate archive file after you deploy the certificate. It is required, for example, when upgrading Capsule&#160;Server.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-capsule-custom-server-certificate_capsule">2.6.2. Configuring Capsule&#160;Server with a Custom SSL Certificate</h4>
<div class="paragraph">
<p>If you configure Satellite&#160;Server to use a custom SSL certificate, you must also configure each of your external Capsule&#160;Servers with a distinct custom SSL certificate.</p>
</div>
<div class="paragraph">
<p>To configure your Capsule&#160;Server with a custom certificate, complete the following procedures on each Capsule&#160;Server:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#creating-a-custom-certificate_capsule">Creating a Custom SSL Certificate for Capsule&#160;Server</a></p>
</li>
<li>
<p><a href="#deploying-a-custom-ssl-certificate-to-capsule-server_capsule">Deploying a Custom SSL Certificate to Capsule&#160;Server</a></p>
</li>
<li>
<p><a href="#deploying-a-custom-ssl-certificate-to-hosts_capsule">Deploying a Custom SSL Certificate to Hosts</a></p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="creating-a-custom-certificate_capsule">Creating a Custom SSL Certificate for Capsule&#160;Server</h5>
<div class="paragraph">
<p>On Satellite&#160;Server, create a custom certificate for your Capsule&#160;Server. If you already have a custom SSL certificate for Capsule&#160;Server, skip this procedure.</p>
</div>
<div class="paragraph">
<p>When you configure Capsule&#160;Server with custom certificates, note the following considerations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You must use the Privacy-Enhanced Mail (PEM) encoding for the SSL certificates.</p>
</li>
<li>
<p>You cannot use the same certificate for both Satellite&#160;Server and Capsule&#160;Server.</p>
</li>
<li>
<p>The same Certificate Authority must sign certificates for Satellite&#160;Server and Capsule&#160;Server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To create a custom SSL certificate, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To store all the source certificate files, create a directory that is accessible only to the <code>root</code> user.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir /root/capsule_cert</pre>
</div>
</div>
</li>
<li>
<p>Create a private key with which to sign the Certificate Signing Request (CSR).</p>
<div class="paragraph">
<p>Note that the private key must be unencrypted. If you use a password-protected private key, remove the private key password.</p>
</div>
<div class="paragraph">
<p>If you already have a private key for this Capsule&#160;Server, skip this step.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># openssl genrsa -out <code>/root/capsule_cert/capsule_cert_key.pem</code> 4096</pre>
</div>
</div>
</li>
<li>
<p>Create the <code>/root/capsule_cert/openssl.cnf</code> configuration file for the Certificate Signing Request (CSR) and include the following content:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[ req ]
req_extensions = v3_req
distinguished_name = req_distinguished_name
x509_extensions = usr_cert
prompt = no

[ req_distinguished_name ] <b class="conum">(1)</b>
C  = <em>Country Name (2 letter code)</em>
ST = <em>State or Province Name (full name)</em>
L  = <em>Locality Name (eg, city)</em>
O  = <em>Organization Name (eg, company)</em>
OU = <em>The division of your organization handling the certificate</em>
CN = <em>capsule.example.com</em> <b class="conum">(2)</b>

[ v3_req ]
basicConstraints = CA:FALSE
keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment
extendedKeyUsage = serverAuth, clientAuth, codeSigning, emailProtection
subjectAltName = @alt_names

[ usr_cert ]
basicConstraints=CA:FALSE
nsCertType = client, server, email
keyUsage = nonRepudiation, digitalSignature, keyEncipherment
extendedKeyUsage = serverAuth, clientAuth, codeSigning, emailProtection
nsComment = "OpenSSL Generated Certificate"
subjectKeyIdentifier=hash
authorityKeyIdentifier=keyid,issuer

[ alt_names ]
DNS.1 = <em>capsule.example.com</em> <b class="conum">(3)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>In the <code>[ req_distinguished_name ]</code> section, enter information about your organization.</p>
</li>
<li>
<p>Set the certificate&#8217;s Common Name <code>CN</code> to match the fully qualified domain name (FQDN) of your Capsule&#160;Server or a wildcard value <code>*</code>. To confirm a FQDN, on that Capsule&#160;Server, enter the <code>hostname -f</code> command. This is required to ensure that the <code>katello-certs-check</code> command validates the certificate correctly. If you set a wildcard value, you must add the <code>-t capsule</code> option when you use the <code>katello-certs-check</code> command.</p>
</li>
<li>
<p>Set the Subject Alternative Name (SAN) <code>DNS.1</code> to match the fully qualified domain name (FQDN) of your server.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Generate the Certificate Signing Request (CSR):</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># openssl req -new \
-key <em>/root/capsule_cert/capsule_cert_key.pem</em> \ <b class="conum">(1)</b>
-config <em>/root/capsule_cert/openssl.cnf</em> \ <b class="conum">(2)</b>
-out <em>/root/capsule_cert/capsule_cert_csr.pem</em> <b class="conum">(3)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Path to the private key.</p>
</li>
<li>
<p>Path to the configuration file.</p>
</li>
<li>
<p>Path to the CSR to generate.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Send the certificate signing request to the Certificate Authority. The same Certificate Authority must sign certificates for Satellite&#160;Server and Capsule&#160;Server.</p>
<div class="paragraph">
<p>When you submit the request, specify the lifespan of the certificate. The method for sending the certificate request varies, so consult the Certificate Authority for the preferred method. In response to the request, you can expect to receive a Certificate Authority bundle and a signed certificate, in separate files.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="deploying-a-custom-ssl-certificate-to-capsule-server_capsule">Deploying a Custom SSL Certificate to Capsule&#160;Server</h5>
<div class="paragraph">
<p>Use this procedure to configure your Capsule&#160;Server with a custom SSL certificate signed by a Certificate Authority. The <code>satellite-installer</code> command, which the <code>capsule-certs-generate</code> command returns, is unique to each Capsule&#160;Server. Do not use the same command on more than one Capsule&#160;Server.</p>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>Before configuring Capsule&#160;Server with a custom server certificate, ensure that your Satellite and Capsules meet the following conditions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Satellite&#160;Server is configured with a custom certificate. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.7/html/installing_satellite_server_from_a_connected_network/performing-additional-configuration#configuring-satellite-custom-server-certificate_satellite">Configuring Satellite&#160;Server with a Custom SSL Certificate</a> in <em>Installing Satellite Server from a Connected Network</em>.</p>
</li>
<li>
<p>Capsule&#160;Server is registered to Satellite&#160;Server. For more information, see <a href="#registering-to-satellite-server_capsule">Registering to Satellite&#160;Server</a>.</p>
</li>
<li>
<p>The Capsule&#160;Server packages are installed. For more information, see <a href="#installing-capsule-server-packages_capsule">Installing Capsule&#160;Server Packages</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To configure your Capsule&#160;Server with a custom SSL certificate, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On Satellite&#160;Server, validate the custom SSL certificate input files:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># katello-certs-check \
-c <em>/root/capsule_cert/capsule_cert.pem</em> \      <b class="conum">(1)</b>
-k <em>/root/capsule_cert/capsule_cert_key.pem</em> \  <b class="conum">(2)</b>
-b <em>/root/capsule_cert/ca_cert_bundle.pem</em>      <b class="conum">(3)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Path to the Capsule&#160;Server certificate file that is signed by a Certificate Authority.</p>
</li>
<li>
<p>Path to the private key that was used to sign the Capsule&#160;Server certificate.</p>
</li>
<li>
<p>Path to the Certificate Authority bundle.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you set a wildcard value <code>*</code> for the certificate&#8217;s Common Name <code>CN =</code> in the <code>/root/capsule_cert/openssl.cnf</code> configuration file, you must add the <code>-t capsule</code> option to the <code>katello-certs-check</code> command.</p>
</div>
<div class="paragraph">
<p>If the command is successful, it returns two <code>capsule-certs-generate</code> commands, one of which you must use to generate the certificate archive file for your Capsule&#160;Server.</p>
</div>
<div class="listingblock">
<div class="title">Example output of <code>katello-certs-check</code></div>
<div class="content">
<pre class="nowrap">Validation succeeded.

To use them inside a NEW $CAPSULE, run this command:

capsule-certs-generate --foreman-proxy-fqdn "$CAPSULE" \
    --certs-tar  "~/$CAPSULE-certs.tar" \
    --server-cert "<em>/root/capsule_cert/capsule_cert.pem</em>" \
    --server-key "<em>/root/capsule_cert/capsule_cert_key.pem</em>" \
    --server-ca-cert "<em>/root/capsule_cert/ca_cert_bundle.pem</em>" \

To use them inside an EXISTING $CAPSULE, run this command INSTEAD:

  capsule-certs-generate --foreman-proxy-fqdn "$CAPSULE" \
    --certs-tar  "~/$CAPSULE-certs.tar" \
    --server-cert "<em>/root/capsule_cert/capsule_cert.pem</em>" \
    --server-key "<em>/root/capsule_cert/capsule_cert_key.pem</em>" \
    --server-ca-cert "<em>/root/capsule_cert/ca_cert_bundle.pem</em>" \
    --certs-update-server</pre>
</div>
</div>
</li>
<li>
<p>On Satellite&#160;Server, from the output of the <code>katello-certs-check</code> command, depending on your requirements, enter the <code>capsule-certs-generate</code> command that generates a certificate for a new or existing Capsule.</p>
<div class="paragraph">
<p>In this command, change <code>$CAPSULE</code> to the FQDN of your Capsule&#160;Server.</p>
</div>
</li>
<li>
<p>Retain a copy of the <code>satellite-installer</code> command that the <code>capsule-certs-generate</code> command returns for deploying the certificate to your Capsule&#160;Server.</p>
<div class="listingblock">
<div class="title">Example output of <code>capsule-certs-generate</code></div>
<div class="content">
<pre class="nowrap"><em>output omitted</em>
satellite-installer \
--scenario capsule \
--certs-tar-file                              "<em>/root/capsule_certs.tar</em>"\
--foreman-proxy-content-parent-fqdn           "<em>satellite.example.com</em>"\
--foreman-proxy-register-in-foreman           "true"\
--foreman-proxy-foreman-base-url              "https://<em>satellite.example.com</em>"\
--foreman-proxy-trusted-hosts                 "<em>satellite.example.com</em>"\
--foreman-proxy-trusted-hosts                 "<em>capsule.example.com</em>"\
--foreman-proxy-oauth-consumer-key            "<em>s97QxvUAgFNAQZNGg4F9zLq2biDsxM7f</em>"\
--foreman-proxy-oauth-consumer-secret         "<em>6bpzAdMpRAfYaVZtaepYetomgBVQ6ehY</em>"\
--puppet-server-foreman-url                   "https://<em>satellite.example.com</em>"</pre>
</div>
</div>
</li>
<li>
<p>On Satellite&#160;Server, copy the certificate archive file to your Capsule&#160;Server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp /root/capsule_cert/<em>capsule.example.com</em>-certs.tar \
root@<em>capsule.example.com</em>:/root/<em>capsule.example.com</em>-certs.tar</pre>
</div>
</div>
</li>
<li>
<p>On Capsule&#160;Server, to deploy the certificate, enter the <code>satellite-installer</code> command that the <code>capsule-certs-generate</code> command returns.</p>
<div class="paragraph">
<p>When network connections or ports to Satellite are not yet open, you can set the <code>--foreman-proxy-register-in-foreman</code> option to <code>false</code> to prevent Capsule from attempting to connect to Satellite and reporting errors. Run the installer again with this option set to <code>true</code> when the network and firewalls are correctly configured.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Do not delete the certificate archive file after you deploy the certificate. It is required, for example, when upgrading Capsule&#160;Server.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="deploying-a-custom-ssl-certificate-to-hosts_capsule">Deploying a Custom SSL Certificate to Hosts</h5>
<div class="paragraph">
<p>After you configure Capsule&#160;Server to use a custom SSL certificate, you must also install the <code>katello-ca-consumer</code> package on every host that is registered to this Capsule&#160;Server.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>On each host, install the <code>katello-ca-consumer</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum localinstall \
http://<em>capsule.example.com</em>/pub/katello-ca-consumer-latest.noarch.rpm</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="performing-additional-configuration-on-capsule-server">3. Performing Additional Configuration on Capsule&#160;Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use this chapter to configure additional settings on your Capsule&#160;Server.</p>
</div>
<div class="sect2">
<h3 id="installing-the-katello-agent_capsule">3.1. Installing the Katello Agent</h3>
<div class="paragraph">
<p>You can install the Katello agent to remotely update Satellite clients.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The Katello agent is deprecated and will be removed in a future Satellite version. Migrate your processes to use the remote execution feature to update clients remotely. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.7/html/managing_hosts/host-management-without-goferd-and-katello-agent_managing-hosts">Host Management Without Goferd and Katello Agent</a> in the <em>Managing Hosts Guide</em>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>katello-agent</code> package depends on the <code>gofer</code> package that provides the <code>goferd</code> service. This service must be enabled so that Satellite&#160;Server or Capsule&#160;Server can provide information about errata that are applicable for content hosts.</p>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>Before installing the Katello agent, ensure the following conditions are met:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You have enabled the Satellite Tools 6.8 Beta repository on Satellite&#160;Server. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.7/html/installing_satellite_server_from_a_connected_network/performing-additional-configuration#enabling-the-satellite-tools-repository_satellite">Enabling the Satellite Tools 6.8 Beta Repository</a> in <em>Installing Satellite Server from a Connected Network</em>.</p>
</li>
<li>
<p>You have synchronized the Satellite Tools 6.8 Beta repository on Satellite&#160;Server. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.7/html/installing_satellite_server_from_a_connected_network/performing-additional-configuration#synchronizing-the-satellite-tools-repository_satellite">Synchronizing the Satellite Tools 6.8 Beta Repository</a> in <em>Installing Satellite Server from a Connected Network</em>.</p>
</li>
<li>
<p>You have enabled the Satellite Tools 6.8 Beta repository on the client.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To install the Katello agent, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install the <code>katello-agent</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install katello-agent</pre>
</div>
</div>
</li>
<li>
<p>Start the <code>goferd</code> service :</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl start goferd</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="enabling-remote-execution_capsule">3.2. Enabling Remote Execution on Capsule&#160;Server</h3>
<div class="paragraph">
<p>To run commands on hosts that are registered to Capsule&#160;Server, you must enable the remote execution feature on your Capsule.</p>
</div>
<div class="paragraph">
<p>Remote execution on external Capsules is disabled by default.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To enable remote execution on Capsule&#160;Server, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># satellite-installer --scenario capsule \
--enable-foreman-proxy-plugin-remote-execution-ssh</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="enabling-openscap_capsule">3.3. Enabling OpenSCAP on External Capsules</h3>
<div class="paragraph">
<p>On Satellite&#160;Server and the integrated Capsule of your Satellite&#160;Server, OpenSCAP is enabled by default.</p>
</div>
<div class="paragraph">
<p>To use the OpenSCAP plug-in and content on an external Capsule, you must enable OpenSCAP on each Capsule.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To enable OpenSCAP, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># satellite-installer --scenario capsule \
--enable-foreman-proxy-plugin-openscap</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="adding-life-cycle-environments_capsule">3.4. Adding Life Cycle Environments to Capsule&#160;Servers</h3>
<div class="paragraph">
<p>If your Capsule&#160;Server has the content functionality enabled, you must add an environment so that Capsule can synchronize content from Satellite&#160;Server and provide content to host systems.</p>
</div>
<div class="paragraph">
<p>Do not assign the <em>Library</em> lifecycle environment to your Capsule&#160;Server because it triggers an automated Capsule sync every time the CDN updates a repository. This might consume multiple system resources on Capsules, network bandwidth between Satellite and Capsules, and available disk space on Capsules.</p>
</div>
<div class="paragraph">
<p>You can use Hammer CLI on Satellite&#160;Server or the Satellite web UI.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To add a life cycle environment to Capsule&#160;Server, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Capsules</strong>, and select the Capsule that you want to add a life cycle to.</p>
</li>
<li>
<p>Click <strong>Edit</strong> and click the <strong>Life Cycle Environments</strong> tab.</p>
</li>
<li>
<p>From the left menu, select the life cycle environments that you want to add to Capsule and click <strong>Submit</strong>.</p>
</li>
<li>
<p>To synchronize the content on the Capsule, click the <strong>Overview</strong> tab and click <strong>Synchronize</strong>.</p>
</li>
<li>
<p>Select either <strong>Optimized Sync</strong> or <strong>Complete Sync</strong>.</p>
<div class="paragraph">
<p>For definitions of each synchronization type, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.7/html/content_management_guide/importing_red_hat_content#Importing_Red_Hat_Content-Recovering_a_Repository">Recovering a Repository</a> in the <em>Content Management Guide</em>.</p>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">For CLI Users</div>
<ol class="arabic">
<li>
<p>To display a list of all Capsule&#160;Servers, on Satellite&#160;Server, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer capsule list</pre>
</div>
</div>
<div class="paragraph">
<p>Note the Capsule ID of the Capsule that you want to add a life cycle to.</p>
</div>
</li>
<li>
<p>Using the ID, verify the details of your Capsule:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer capsule info --id <em>capsule_id</em></pre>
</div>
</div>
</li>
<li>
<p>Display the life cycle environments that are available and note the environment ID:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer capsule content available-lifecycle-environments \
--id <em>capsule_id</em></pre>
</div>
</div>
</li>
<li>
<p>To view the life cycle environments available for your Capsule&#160;Server, enter the following command and note the ID and the organization name:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer capsule content available-lifecycle-environments --id <em>capsule_id</em></pre>
</div>
</div>
</li>
<li>
<p>Add the life cycle environment to your Capsule&#160;Server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer capsule content add-lifecycle-environment \
--id <em>capsule_id</em> --organization "<em>My_Organization</em>" \
--environment-id <em>environment_id</em></pre>
</div>
</div>
<div class="paragraph">
<p>Repeat for each life cycle environment you want to add to Capsule&#160;Server.</p>
</div>
</li>
<li>
<p>Synchronize the content from Satellite to Capsule.</p>
<div class="ulist">
<ul>
<li>
<p>To synchronize all content from your Satellite&#160;Server environment to Capsule&#160;Server, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer capsule content synchronize --id <em>capsule_id</em></pre>
</div>
</div>
</li>
<li>
<p>To synchronize a specific life cycle environment from your Satellite&#160;Server to Capsule&#160;Server, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer capsule content synchronize --id <em>external_capsule_id</em> \
--environment-id <em>environment_id</em></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="enabling-power-management-on-managed-hosts_capsule">3.5. Enabling Power Management on Managed Hosts</h3>
<div class="paragraph">
<p>To perform power management tasks on managed hosts using the intelligent platform management interface (IPMI) or a similar protocol, you must enable the baseboard management controller (BMC) module on Capsule&#160;Server.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>All managed hosts must have a network interface of BMC type. Capsule&#160;Server uses this NIC to pass the appropriate credentials to the host.
For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.7/html/managing_hosts/adding_network_interfaces#adding-a-bmc-interface">Adding a Baseboard Management Controller (BMC) Interface</a> in <em>Managing Hosts</em>.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To enable BMC, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># satellite-installer --scenario capsule \
--foreman-proxy-bmc "true" \
--foreman-proxy-bmc-default-provider "freeipmi"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configuring-dns-dhcp-and-tftp_capsule">3.6. Configuring DNS, DHCP, and TFTP on Capsule&#160;Server</h3>
<div class="paragraph">
<p>To configure the DNS, DHCP, and TFTP services on Capsule&#160;Server, use the <code>satellite-installer</code> command with the options appropriate for your environment. To view a complete list of configurable options, enter the <code>satellite-installer --scenario satellite --help</code> command.</p>
</div>
<div class="paragraph">
<p>Any changes to the settings require entering the <code>satellite-installer</code> command again. You can enter the command multiple times and each time it updates all configuration files with the changed values.</p>
</div>
<div class="paragraph">
<p>To use external DNS, DHCP, and TFTP services instead, see <a href="#configuring-external-services">[configuring-external-services]</a>.</p>
</div>
<div class="paragraph">
<div class="title">Adding Multihomed DHCP details</div>
<p>If you want to use Multihomed DHCP, you must update the network interface file.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <code>/etc/systemd/system/dhcpd.service.d/interfaces.conf</code> file, edit the following line to add Multihomed DHCP:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[Service]
ExecStart=/usr/sbin/dhcpd -f -cf /etc/dhcp/dhcpd.conf -user dhcpd -group dhcpd --no-pid eth0 eth1 eth2</pre>
</div>
</div>
<div class="paragraph">
<p>If this file does not exist already, create it.</p>
</div>
</li>
<li>
<p>Enter the following command to perform a daemon reload:</p>
<div class="listingblock">
<div class="content">
<pre># systemctl --system daemon-reload</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to restart the <strong>dhcpd</strong> service:</p>
<div class="listingblock">
<div class="content">
<pre># systemctl restart dhcpd.service</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must have the correct network name (<code>dns-interface</code>) for the DNS server.</p>
</li>
<li>
<p>You must have the correct interface name (<code>dhcp-interface</code>) for the DHCP server.</p>
</li>
<li>
<p>Contact your network administrator to ensure that you have the correct settings.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Enter the <code>satellite-installer</code> command with the options appropriate for your environment. The following example shows configuring full provisioning services:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># satellite-installer --scenario capsule \
--foreman-proxy-dns true \
--foreman-proxy-dns-managed true \
--foreman-proxy-dns-interface <em>eth0</em> \
--foreman-proxy-dns-zone <em>example.com</em> \
--foreman-proxy-dns-reverse <em>2.0.192.in-addr.arpa</em> \
--foreman-proxy-dhcp true \
--foreman-proxy-dhcp-managed true \
--foreman-proxy-dhcp-interface <em>eth0</em> \
--foreman-proxy-dhcp-range "<em>192.0.2.100</em> <em>192.0.2.150</em>" \
--foreman-proxy-dhcp-gateway <em>192.0.2.1</em> \
--foreman-proxy-dhcp-nameservers <em>192.0.2.2</em> \
--foreman-proxy-tftp true \
--foreman-proxy-tftp-managed true \
--foreman-proxy-tftp-servername <em>192.0.2.3</em></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about configuring DHCP, DNS, and TFTP services, see the <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.7/html/provisioning_guide/configuring_networking#Configuring_Networking-Configuring_Network_Services_for_PXE_Boot">Configuring Network Services</a> section in the <em>Provisioning Guide</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="restricting-access-to-mongod_capsule">3.7. Restricting Access to mongod</h3>
<div class="paragraph">
<p>To reduce the risk of data loss, configure only the <code>apache</code> and <code>root</code> users to have access to the MongoDB database daemon, <code>mongod</code>.</p>
</div>
<div class="paragraph">
<p>To restrict access to <code>mongod</code> on your Capsule&#160;Server, you must update your firewall configuration.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Update the firewall configuration by entering the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd  --direct --add-rule ipv4 filter OUTPUT 0 -o lo -p \
tcp -m tcp --dport 27017 -m owner --uid-owner apache -j ACCEPT \
&amp;&amp; firewall-cmd  --direct --add-rule ipv6 filter OUTPUT 0 -o lo -p \
tcp -m tcp --dport 27017 -m owner --uid-owner apache -j ACCEPT \
&amp;&amp; firewall-cmd  --direct --add-rule ipv4 filter OUTPUT 0 -o lo -p \
tcp -m tcp --dport 27017 -m owner --uid-owner root -j ACCEPT \
&amp;&amp; firewall-cmd  --direct --add-rule ipv6 filter OUTPUT 0 -o lo -p \
tcp -m tcp --dport 27017 -m owner --uid-owner root -j ACCEPT \
&amp;&amp; firewall-cmd  --direct --add-rule ipv4 filter OUTPUT 1 -o lo -p \
tcp -m tcp --dport 27017 -j DROP \
&amp;&amp; firewall-cmd  --direct --add-rule ipv6 filter OUTPUT 1 -o lo -p \
tcp -m tcp --dport 27017 -j DROP \
&amp;&amp; firewall-cmd  --direct --add-rule ipv4 filter OUTPUT 0 -o lo -p \
tcp -m tcp --dport 28017 -m owner --uid-owner apache -j ACCEPT \
&amp;&amp; firewall-cmd  --direct --add-rule ipv6 filter OUTPUT 0 -o lo -p \
tcp -m tcp --dport 28017 -m owner --uid-owner apache -j ACCEPT \
&amp;&amp; firewall-cmd  --direct --add-rule ipv4 filter OUTPUT 0 -o lo -p \
tcp -m tcp --dport 28017 -m owner --uid-owner root -j ACCEPT \
&amp;&amp; firewall-cmd  --direct --add-rule ipv6 filter OUTPUT 0 -o lo -p \
tcp -m tcp --dport 28017 -m owner --uid-owner root -j ACCEPT \
&amp;&amp; firewall-cmd  --direct --add-rule ipv4 filter OUTPUT 1 -o lo -p \
tcp -m tcp --dport 28017 -j DROP \
&amp;&amp; firewall-cmd  --direct --add-rule ipv6 filter OUTPUT 1 -o lo -p \
tcp -m tcp --dport 28017 -j DROP</pre>
</div>
</div>
</li>
<li>
<p>Make the changes persistent:</p>
<div class="listingblock">
<div class="content">
<pre># firewall-cmd --runtime-to-permanent</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="capsule-server-scalability-considerations_capsule">Appendix A: Capsule&#160;Server Scalability Considerations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The maximum number of Capsule&#160;Servers that the Satellite&#160;Server can support has no fixed limit. The tested limit is 17 Capsule&#160;Servers with 2 vCPUs on a Satellite&#160;Server with Red Hat Enterprise Linux 7.  However, scalability is highly variable, especially when managing Puppet clients.</p>
</div>
<div class="paragraph">
<p>Capsule&#160;Server scalability when managing Puppet clients depends on the number of CPUs, the run-interval distribution, and the number of Puppet managed resources. The Capsule&#160;Server has a limitation of 100 concurrent Puppet agents running at any single point in time. Running more than 100 concurrent Puppet agents results in a 503 HTTP error.</p>
</div>
<div class="paragraph">
<p>For example, assuming that Puppet agent runs are evenly distributed with less than 100 concurrent Puppet agents running at any single point during a run-interval, a Capsule&#160;Server with 4 CPUs has a maximum of 1250-1600 Puppet clients with a moderate workload of 10 Puppet classes assigned to each Puppet client. Depending on the number of Puppet clients required, the Satellite installation can scale out the number of Capsule&#160;Servers to support them.</p>
</div>
<div class="paragraph">
<p>If you want to scale your Capsule&#160;Server when managing Puppet clients, the following assumptions are made:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There are no external Puppet clients reporting directly to the Satellite&#160;6 integrated Capsule.</p>
</li>
<li>
<p>All other Puppet clients report directly to an external Capsule.</p>
</li>
<li>
<p>There is an evenly distributed run-interval of all Puppet agents.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Deviating from the even distribution increases the risk of filling the passenger request queue. The limit of 100 concurrent requests applies.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following table describes the scalability limits using the recommended 4 CPUs.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Puppet Scalability Using 4 CPUs</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Puppet Managed Resources per Host</th>
<th class="tableblock halign-left valign-top">Run-Interval Distribution</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3000-2500</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2400-2000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1700-1400</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following table describes the scalability limits using the minimum 2 CPUs.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Puppet Scalability Using 2 CPUs</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Puppet Managed Resources per Host</th>
<th class="tableblock halign-left valign-top">Run-Interval Distribution</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1700-1450</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1500-1250</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">850-700</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-09-11 06:08:07 UTC
</div>
</div>
</body>
</html>