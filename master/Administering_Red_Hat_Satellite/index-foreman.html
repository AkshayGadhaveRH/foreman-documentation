<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.12">
<title>Administering Foreman</title>
<link rel="stylesheet" href="./foreman.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Administering Foreman</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#chap-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Accessing_Red_Hat_Satellite">1. Accessing Foreman</a>
<ul class="sectlevel2">
<li><a href="#sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Installing_the_Katello_Root_CA_Certificate">1.1. Installing the Katello Root CA Certificate</a></li>
<li><a href="#sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Logging_on_to_Satellite">1.2. Logging on to Foreman</a></li>
<li><a href="#form-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Navigation_Tabs_in_the_Satellite_Web_UI">1.3. Navigation Tabs in the Foreman Web UI</a></li>
<li><a href="#sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Changing_the_Password">1.4. Changing the Password</a></li>
<li><a href="#sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Resetting_the_Administrative_User_Password">1.5. Resetting the Administrative User Password</a></li>
<li><a href="#sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Setting_a_Custom_Login_Message">1.6. Setting a Custom Message on the Login Page</a></li>
</ul>
</li>
<li><a href="#chap-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Starting_and_Stopping_Red_Hat_Satellite">2. Starting and Stopping Foreman</a></li>
<li><a href="#migrating-from-internal-databases-to-external-databases_admin">3. Migrating from Internal Foreman Databases to External Databases</a>
<ul class="sectlevel2">
<li><a href="#mongodb-as-an-external-database-considerations_admin">3.1. MongoDB as an External Database Considerations</a></li>
<li><a href="#postgresql-as-an-external-database-considerations_admin">3.2. PostgreSQL as an External Database Considerations</a></li>
<li><a href="#preparing-a-host-for-external-databases_admin">3.3. Preparing a Host for External Databases</a></li>
<li><a href="#installing-mongodb_admin">3.4. Installing MongoDB</a></li>
<li><a href="#installing-postgresql_admin">3.5. Installing PostgreSQL</a></li>
<li><a href="#migrating-to-external-databases_admin">3.6. Migrating to External Databases</a></li>
</ul>
</li>
<li><a href="#using-satellite-ansible-content-collections_admin">4. Managing Foreman with Ansible Collections</a>
<ul class="sectlevel2">
<li><a href="#installing-satellite-ansible-modules-via-rpm_admin">4.1. Installing the Foreman Ansible Modules from RPM</a></li>
<li><a href="#listing-using-satellite-ansible-modules_admin">4.2. Viewing the Foreman Ansible Modules</a></li>
</ul>
</li>
<li><a href="#chap-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Users_and_Roles">5. Managing Users and Roles</a>
<ul class="sectlevel2">
<li><a href="#user-management_admin">5.1. User Management</a></li>
<li><a href="#sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Users_and_Roles-Creating_and_Managing_User_Groups">5.2. Creating and Managing User Groups</a></li>
<li><a href="#sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Users_and_Roles-Creating_and_Managing_Roles">5.3. Creating and Managing Roles</a></li>
<li><a href="#sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Users_and_Roles-Granular_Permission_Filtering">5.4. Granular Permission Filtering</a></li>
</ul>
</li>
<li><a href="#chap-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Security_Compliance_Management">6. Managing Security Compliance</a>
<ul class="sectlevel2">
<li><a href="#security-content-automation-protocol_admin">6.1. Security Content Automation Protocol</a></li>
<li><a href="#sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Security_Compliance_Management_with_OpenSCAP-Configuring_SCAP_Content">6.2. Configuring SCAP Content</a></li>
<li><a href="#sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Security_Compliance_Management_with_OpenSCAP-Managing_Compliance_Policies">6.3. Managing Compliance Policies</a></li>
<li><a href="#tailoring-files_admin">6.4. Tailoring Files</a></li>
<li><a href="#configuring-a-host-group-for-openscap_admin">6.5. Configuring a host group for OpenSCAP</a></li>
<li><a href="#configuring-a-host-for-openscap_admin">6.6. Configuring a host for OpenSCAP</a></li>
<li><a href="#monitoring-compliance_admin">6.7. Monitoring Compliance</a></li>
<li><a href="#sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Specifications_Supported_OpenSCAP">6.8. Specifications Supported by OpenSCAP</a></li>
</ul>
</li>
<li><a href="#Disabling_Weak_SSL_2-0_and_3-0_Encryption">7. Disabling TLS 1.0 and TLS 1.1 Encryption</a></li>
<li><a href="#backing-up-satellite-server-and-capsule-server">8. Backing Up Foreman&#160;server and Smart&#160;Proxy&#160;server</a>
<ul class="sectlevel2">
<li><a href="#estimating-the-size-of-a-backup_admin">8.1. Estimating the Size of a Backup</a></li>
<li><a href="#performing-a-full-backup-of-satellite-or-capsule_admin">8.2. Performing a Full Backup of Foreman&#160;server or Smart&#160;Proxy&#160;server</a></li>
<li><a href="#performing-a-backup-without-pulp-content_admin">8.3. Performing a Backup without Pulp Content</a></li>
<li><a href="#performing-an-incremental-backup_admin">8.4. Performing an Incremental Backup</a></li>
<li><a href="#example-of-a-weekly-full-backup-followed-by-daily-incremental-backups_admin">8.5. Example of a Weekly Full Backup Followed by Daily Incremental Backups</a></li>
<li><a href="#performing-an-online-backup_admin">8.6. Performing an Online Backup</a></li>
<li><a href="#performing-a-snapshot-backup_admin">8.7. Performing a Snapshot Backup</a></li>
<li><a href="#white-listing-and-skipping-steps-when-performing-backups_admin">8.8. White-listing and Skipping Steps When Performing Backups</a></li>
</ul>
</li>
<li><a href="#sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Backup_and_Disaster_Recovery-Restoring_Satellite_Server_or_Capsule_Server_from_a_Backup">9. Restoring Foreman&#160;server or Smart&#160;Proxy&#160;server from a Backup</a>
<ul class="sectlevel2">
<li><a href="#restoring-from-a-full-backup_admin">9.1. Restoring from a Full Backup</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="chap-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Accessing_Red_Hat_Satellite">1. Accessing Foreman</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After Foreman has been installed and configured, use the web user interface to log in to Foreman for further configuration.</p>
</div>
<div class="sect2">
<h3 id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Installing_the_Katello_Root_CA_Certificate">1.1. Installing the Katello Root CA Certificate</h3>
<div class="paragraph">
<p>The first time you log on to Foreman, you might see a warning informing you that you are using the default self-signed certificate and you might not be able to connect this browser to Foreman until the root CA certificate is installed in the browser. Use the following procedure to locate the root CA certificate on Foreman and to install it in your browser.</p>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>Your Foreman is installed and configured.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Identify the fully qualified domain name of your Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hostname -f</pre>
</div>
</div>
</li>
<li>
<p>Access the <code>pub</code> directory on your Foreman&#160;server using a web browser pointed to the fully qualified domain name:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">https://<em>foreman.example.com</em>/pub</pre>
</div>
</div>
</li>
<li>
<p>When you access Foreman for the first time, an untrusted connection warning displays in your web browser. Accept the self-signed certificate and add the Foreman URL as a security exception to override the settings. This procedure might differ depending on the browser being used. Ensure that the Foreman URL is valid before you accept the security exception.</p>
</li>
<li>
<p>Select <code>katello-server-ca.crt</code>.</p>
</li>
<li>
<p>Import the certificate into your browser as a certificate authority and trust it to identify websites.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Importing the Katello Root CA Certificate Manually</div>
<p>If you cannot add a security exception in your browser, import the Katello root CA certificate manually.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From the Foreman CLI, copy the <code>katello-server-ca.crt</code> file to the machine you use to access the web UI:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp /var/www/html/pub/katello-server-ca.crt \
<em>username@hostname:remotefile</em></pre>
</div>
</div>
</li>
<li>
<p>In the browser, import the <code>katello-server-ca.crt</code> certificate as a certificate authority and trust it to identify websites.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Logging_on_to_Satellite">1.2. Logging on to Foreman</h3>
<div class="paragraph">
<p>Use the web user interface to log on to Foreman for further configuration.</p>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>Ensure that the Katello root CA certificate is installed in your browser. For more information, see <a href="#sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Installing_the_Katello_Root_CA_Certificate">Installing the Katello Root CA Certificate</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Access the Foreman&#160;server using a web browser pointed to the fully qualified domain name:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">https://<em>foreman.example.com</em>/</pre>
</div>
</div>
</li>
<li>
<p>Enter the user name and password created during the configuration process. If a user was not created during the configuration process, the default user name is <em>admin</em>. If you have problems logging on, you can reset the password. For more information, see <a href="#sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Resetting_the_Administrative_User_Password">Resetting the Administrative User Password</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="form-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Navigation_Tabs_in_the_Satellite_Web_UI">1.3. Navigation Tabs in the Foreman Web UI</h3>
<div class="paragraph">
<p>Use the navigation tabs to browse the Foreman web UI.</p>
</div>
<table id="tabl-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Logging_in_to_Red_Hat_Satellite-Navigation_Tabs" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Navigation Tabs</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 77.7778%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Navigation Tabs</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Any Context</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clicking this tab changes the organization and location. If no organization or location is selected, the default organization is <em>Any Organization</em> and the default location is <em>Any Location</em>. Use this tab to change to different values.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Monitor</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides summary dashboards and reports.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Content</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides content management tools. This includes Content Views, Activation Keys, and Life Cycle Environments.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Hosts</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides host inventory and provisioning configuration tools.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Configure</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides general configuration tools and data including Host Groups and Puppet data.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Infrastructure</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides tools on configuring how Foreman interacts with the environment.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Insights</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides Red&#160;Hat Insights management tools.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>User Name</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides user administration where users can edit their personal information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/notfications1.png" alt="notfications1"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides event notifications to keep administrators informed of important environment changes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Administer</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides advanced configuration for settings such as Users and RBAC, as well as general settings.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Changing_the_Password">1.4. Changing the Password</h3>
<div class="paragraph">
<p>These steps show how to change your password.</p>
</div>
<div id="proc-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Changing_the_Password-To_Change_your_Red_Hat_Satellite_Password" class="olist arabic">
<div class="title">To Change your Foreman Password:</div>
<ol class="arabic">
<li>
<p>Click your user name at the top right corner.</p>
</li>
<li>
<p>Select <strong>My Account</strong> from the menu.</p>
</li>
<li>
<p>In the <strong>Current Password</strong> field, enter the current password.</p>
</li>
<li>
<p>In the <strong>Password</strong> field, enter a new password.</p>
</li>
<li>
<p>In the <strong>Verify</strong> field, enter the new password again.</p>
</li>
<li>
<p>Click the <strong>Submit</strong> button to save your new password.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Resetting_the_Administrative_User_Password">1.5. Resetting the Administrative User Password</h3>
<div class="paragraph">
<p>Use the following procedures to reset the administrative password to randomly generated characters or to set a new administrative password.</p>
</div>
<div id="proc-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Resetting_the_Administrative_User_Password-To_Reset_the_Administrative_User_Password" class="paragraph">
<div class="title">To Reset the Administrative User Password:</div>
<p>To reset the password to randomly generated characters, complete the following procedure:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log on to the base operating system where Foreman&#160;server is installed.</p>
</li>
<li>
<p>Enter the following command to reset the password:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-rake permissions:reset
Reset to user: admin, password: qwJxBptxb7Gfcjj5</pre>
</div>
</div>
</li>
<li>
<p>Use this password to reset the password in the Foreman web UI.</p>
</li>
<li>
<p>Edit the <code>~/.hammer/cli.modules.d/foreman.yml</code> file on Foreman&#160;server to add the new password:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">#  vi ~/.hammer/cli.modules.d/foreman.yml</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Unless you update the <code>~/.hammer/cli.modules.d/foreman.yml</code> file, you cannot use the new password with Hammer CLI.</p>
</div>
<div id="proc-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Resetting_the_Administrative_User_Password-To_Set_a_New_Administrative_User_Password" class="paragraph">
<div class="title">To Set a New Administrative User Password:</div>
<p>To change the administrative user password to a new password, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log on to the base operating system where Foreman&#160;server is installed.</p>
</li>
<li>
<p>To set the password, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-rake permissions:reset password=<em>new_password</em></pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>~/.hammer/cli.modules.d/foreman.yml</code> file on Foreman&#160;server to add the new password:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">#  vi ~/.hammer/cli.modules.d/foreman.yml</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Unless you update the <code>~/.hammer/cli.modules.d/foreman.yml</code> file, you cannot use the new password with Hammer CLI.</p>
</div>
</div>
<div class="sect2">
<h3 id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Setting_a_Custom_Login_Message">1.6. Setting a Custom Message on the Login Page</h3>
<div id="proc-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Setting_a_Custom_Login_Message-To_Set_a_Custom_Login_Message" class="olist arabic">
<div class="title">To Set a Custom Message on the Login Page:</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>, and click the <strong>General</strong> tab.</p>
</li>
<li>
<p>Click the edit button next to <strong>Login page footer text</strong>, and enter the desired text to be displayed on the login page. For example, this text may be a warning message required by your company.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
<li>
<p>Log out of the Foreman&#8217;s web UI and verify that the custom text is now displayed on the login page below the Foreman version number.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Starting_and_Stopping_Red_Hat_Satellite">2. Starting and Stopping Foreman</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Foreman provides the <code>foreman-maintain service</code> command to manage Foreman services from the command line. This is useful when creating a backup of Foreman. For more information on creating backups, see <a href="#backing-up-satellite-server-and-capsule-server">Backing Up Foreman&#160;server and Smart&#160;Proxy&#160;server</a>.</p>
</div>
<div class="paragraph">
<p>After installing Foreman with the <code>foreman-installer</code> command, all Foreman services are started and enabled automatically. View the list of these services by executing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain service list</pre>
</div>
</div>
<div class="paragraph">
<p>To see the status of running services, execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain service status</pre>
</div>
</div>
<div class="paragraph">
<p>To stop the <code>foreman-maintain</code> services, execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain service stop</pre>
</div>
</div>
<div class="paragraph">
<p>To start the <code>foreman-maintain</code> services, execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain service start</pre>
</div>
</div>
<div class="paragraph">
<p>To restart the <code>foreman-maintain</code> services, execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain service restart</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="migrating-from-internal-databases-to-external-databases_admin">3. Migrating from Internal Foreman Databases to External Databases</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For Red Hat systems only.</p>
</div>
<div class="paragraph">
<p>When you install Foreman, the <strong>foreman-installer</strong> command installs MongoDB and PostgreSQL databases on the same server as Foreman. If you are using the default internal databases but want to start using external databases to help with the server load, you can migrate your internal databases to external databases. Depending on your requirements, you can use external databases for either MongoDB or PostgreSQL database, or both.</p>
</div>
<div class="paragraph">
<p>To confirm whether your Foreman&#160;server has internal or external databases, you can query the status of your databases:</p>
</div>
<div class="paragraph">
<p>For PostgreSQL, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain service status --only postgresql</pre>
</div>
</div>
<div class="paragraph">
<p>For MongoDB, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain service status --only rh-mongodb34-mongod</pre>
</div>
</div>
<div class="paragraph">
<p>Use <a href="#mongodb-as-an-external-database-considerations_admin">MongoDB as an External Database Considerations</a> and <a href="#postgresql-as-an-external-database-considerations_admin">PostgreSQL as an External Database Considerations</a> to decide if you want to use external databases for your Foreman deployment.</p>
</div>
<div class="paragraph">
<p>To migrate from the default internal databases to external databases, you must complete the following procedures:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#preparing-a-host-for-external-databases_admin">Preparing a Host for External Databases</a>. Prepare a Red&#160;Hat Enterprise Linux 7 server to host the external databases.</p>
</li>
<li>
<p><a href="#installing-mongodb_admin">Installing MongoDB</a>. Prepare MongoDB with user <code>pulp</code> owning the <code>pulp_database</code></p>
</li>
<li>
<p><a href="#installing-postgresql_admin">Installing PostgreSQL</a>. Prepare PostgreSQL with databases for Foreman and Candlepin and dedicated users owning them.</p>
</li>
<li>
<p><a href="#migrating-to-external-databases_admin">Migrating to External Databases</a>. Edit the parameters of <code>foreman-installer</code> to point to the new databases, and run <code>foreman-installer</code>.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="mongodb-as-an-external-database-considerations_admin">3.1. MongoDB as an External Database Considerations</h3>
<div class="paragraph">
<p>Pulp uses the MongoDB database. If you want to use MongoDB as an external database, the following information can help you decide if this option is right for your Foreman configuration. Foreman supports MongoDB version 3.4.</p>
</div>
<div class="ulist">
<div class="title">Advantages of External MongoDB</div>
<ul>
<li>
<p>Increase in free memory and free CPU on Foreman</p>
</li>
<li>
<p>Flexibility to tune the MongoDB server&#8217;s system without adversely affecting Foreman operations</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Disadvantages of External MongoDB</div>
<ul>
<li>
<p>Increase in deployment complexity that can make troubleshooting more difficult</p>
</li>
<li>
<p>An external MongoDB server is an additional system to patch and maintain</p>
</li>
<li>
<p>If either the Foreman or the Mongo database server suffers a hardware or storage failure, Foreman is not operational</p>
</li>
<li>
<p>If there is latency between the Foreman and the external database server, performance can suffer</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">FIPS-related Restrictions</div>
<ul>
<li>
<p>You cannot use an external MongoDB with Foreman in FIPS mode.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="postgresql-as-an-external-database-considerations_admin">3.2. PostgreSQL as an External Database Considerations</h3>
<div class="paragraph">
<p>Foreman, Katello, and Candlepin use the PostgreSQL database. If you want to use PostgreSQL as an external database, the following information can help you decide if this option is right for your Foreman configuration. Foreman supports PostgreSQL version 12.1.</p>
</div>
<div class="ulist">
<div class="title">Advantages of External PostgreSQL:</div>
<ul>
<li>
<p>Increase in free memory and free CPU on Foreman</p>
</li>
<li>
<p>Flexibility to set <code>shared_buffers</code> on the PostgreSQL database to a high number without the risk of interfering with other services on Foreman</p>
</li>
<li>
<p>Flexibility to tune the PostgreSQL server&#8217;s system without adversely affecting Foreman operations</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Disadvantages of External PostgreSQL</div>
<ul>
<li>
<p>Increase in deployment complexity that can make troubleshooting more difficult</p>
</li>
<li>
<p>The external PostgreSQL server is an additional system to patch and maintain</p>
</li>
<li>
<p>If either Foreman or the PostgreSQL database server suffers a hardware or storage failure, Foreman is not operational</p>
</li>
<li>
<p>If there is latency between the Foreman server and database server, performance can suffer</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="preparing-a-host-for-external-databases_admin">3.3. Preparing a Host for External Databases</h3>
<div class="paragraph">
<p>Install a freshly provisioned system with the latest Red&#160;Hat Enterprise Linux 7 server to host the external databases.</p>
</div>
<div class="paragraph">
<p>Subscriptions for Red&#160;Hat Software Collections and Red&#160;Hat Enterprise Linux do not provide the correct service level agreement for using Foreman with external databases. You must also attach a Foreman subscription to the base operating system that you want to use for the external databases.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Red&#160;Hat Enterprise Linux 7 server must meet Foreman&#8217;s <a href="https://docs.theforeman.org/master/Installing_Server_on_Red_Hat/index-foreman.html#satellite-storage-requirements_foreman">Storage Requirements</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Use the instructions in <a href="https://docs.theforeman.org/master/Installing_Server_on_Red_Hat/index-foreman.html#attaching-satellite-infrastructure-subscription_foreman">Attaching the Foreman Infrastructure Subscription</a> to attach a Foreman subscription to your server.</p>
</li>
<li>
<p>Disable all repositories and enable only the following repositories:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># subscription-manager repos --disable '*'
# subscription-manager repos --enable=rhel-server-rhscl-7-rpms \
--enable=rhel-7-server-rpms</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="installing-mongodb_admin">3.4. Installing MongoDB</h3>
<div class="paragraph">
<p>You can install only the same version of MongoDB that is installed with the <code>foreman-installer</code> tool during an internal database installation. You can install MongoDB using Red Hat Software Collections (RHSCL) repositories or from an external source, as long as the version is supported. Foreman supports MongoDB version 3.4.</p>
</div>
<div class="paragraph">
<p>If you do not use <code>firewall-cmd</code> to configure the Linux firewall, implement using the command of your choice.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To install MongoDB, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre># yum install rh-mongodb34 rh-mongodb34-syspaths</pre>
</div>
</div>
</li>
<li>
<p>Start and enable the <strong>rh-mongodb34</strong> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl start rh-mongodb34-mongod
# systemctl enable rh-mongodb34-mongod</pre>
</div>
</div>
</li>
<li>
<p>Create a Pulp user on MongoDB for database <strong>pulp_database</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mongo pulp_database \
--eval "db.createUser({user:'pulp',pwd:'pulp_password',roles:[{role:'dbOwner', db:'pulp_database'},{ role: 'readWrite', db: 'pulp_database'}]})"</pre>
</div>
</div>
</li>
<li>
<p>In the <code>/etc/opt/rh/rh-mongodb34/mongod.conf</code> file, specify the bind IP:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">bindIp: <em>your_mongodb_server_bind_IP</em>,::1</pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>/etc/opt/rh/rh-mongodb34/mongod.conf</code> file to enable authentication in the <code>security</code> section:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">security:
  authorization: enabled</pre>
</div>
</div>
</li>
<li>
<p>Restart the <code>rh-mongodb34-mongod</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart rh-mongodb34-mongod</pre>
</div>
</div>
</li>
<li>
<p>Open port 27017 for MongoDB:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --add-port=27017/tcp
# firewall-cmd --runtime-to-permanent</pre>
</div>
</div>
</li>
<li>
<p>From Foreman&#160;server, test that you can access the database. If the connection succeeds, the command returns <code>1</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scl enable rh-mongodb34 " mongo --host <em>mongo.example.com</em> \
-u pulp -p <em>pulp_password</em> --port 27017 --eval 'ping:1' <em>pulp_database</em>"</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="installing-postgresql_admin">3.5. Installing PostgreSQL</h3>
<div class="paragraph">
<p>You can install only the same version of PostgreSQL that is installed with the <code>foreman-installer</code> tool during an internal database installation. You can install PostgreSQL using Red Hat Enterprise Linux Server 7 repositories or from an external source, as long as the version is supported. Foreman supports PostgreSQL version 12.1.</p>
</div>
<div class="paragraph">
<p>If you do not use <code>firewall-cmd</code> to configure the Linux firewall, implement using the command of your choice.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To install PostgreSQL, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre># yum install rh-postgresql12-postgresql-server \
rh-postgresql12-syspaths \
rh-postgresql12-postgresql-evr</pre>
</div>
</div>
</li>
<li>
<p>To initialize PostgreSQL, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># postgresql-setup initdb</pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>/var/opt/rh/rh-postgresql12/lib/pgsql/data/postgresql.conf</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># vi /var/opt/rh/rh-postgresql12/lib/pgsql/data/postgresql.conf</pre>
</div>
</div>
</li>
<li>
<p>Remove the <code>#</code> and edit to listen to inbound connections:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">listen_addresses = '*'</pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>/var/opt/rh/rh-postgresql12/lib/pgsql/data/pg_hba.conf</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># vi /var/opt/rh/rh-postgresql12/lib/pgsql/data/pg_hba.conf</pre>
</div>
</div>
</li>
<li>
<p>Add the following line to the file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">  host  all   all   <em>Foreman_ip</em>/24   md5</pre>
</div>
</div>
</li>
<li>
<p>To start, and enable PostgreSQL service, enter the following commands:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl start postgresql
# systemctl enable postgresql</pre>
</div>
</div>
</li>
<li>
<p>Open the <strong>postgresql</strong> port on the external PostgreSQL server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --add-service=postgresql
# firewall-cmd --runtime-to-permanent</pre>
</div>
</div>
</li>
<li>
<p>Switch to the <code>postgres</code> user and start the PostgreSQL client:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ su - postgres -c psql</pre>
</div>
</div>
</li>
<li>
<p>Create two databases and dedicated roles, one for Foreman and one for Candlepin:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">CREATE USER "foreman" WITH PASSWORD '<em>Foreman_Password</em>';
CREATE USER "candlepin" WITH PASSWORD '<em>Candlepin_Password</em>';
CREATE DATABASE foreman OWNER foreman;
CREATE DATABASE candlepin OWNER candlepin;</pre>
</div>
</div>
</li>
<li>
<p>Exit the <code>postgres</code> user:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># \q</pre>
</div>
</div>
</li>
<li>
<p>From Foreman&#160;server, test that you can access the database. If the connection succeeds, the commands return <code>1</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># PGPASSWORD='<em>Foreman_Password</em>' psql -h <em>postgres.example.com</em>  -p 5432 -U foreman -d foreman -c "SELECT 1 as ping"
# PGPASSWORD='<em>Candlepin_Password</em>' psql -h <em>postgres.example.com</em> -p 5432 -U candlepin -d candlepin -c "SELECT 1 as ping"</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="migrating-to-external-databases_admin">3.6. Migrating to External Databases</h3>
<div class="paragraph">
<p>Back up and transfer existing data, then use the <code>foreman-installer</code> command to configure Foreman to connect to external MongoDB and PostgreSQL databases.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have installed and configured MongoDB and PostgreSQL databases on a Red&#160;Hat Enterprise Linux server.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On Foreman&#160;server, stop the <code>foreman-maintain</code> services:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain service stop</pre>
</div>
</div>
</li>
<li>
<p>Start the <strong>postgreSQL</strong> and <strong>mongod</strong> services:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl start postgresql
# systemctl start mongod</pre>
</div>
</div>
</li>
<li>
<p>Back up the internal databases:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain backup online --skip-pulp-content --preserve-directory -y <em>/var/migration_backup</em></pre>
</div>
</div>
</li>
<li>
<p>Transfer the data to the new external databases:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">PGPASSWORD='<em>Foreman_Password</em>' pg_restore -h <em>postgres.example.com</em> -U foreman -d foreman &lt; <em>/var/migration_backup/foreman.dump</em>
PGPASSWORD='<em>Candlepin_Password</em>' pg_restore -h <em>postgres.example.com</em> -U candlepin -d candlepin &lt; <em>/var/migration_backup/candlepin.dump</em>
mongorestore --host <em>mongo.example.com</em> --db <em>pulp_database</em> --username <em>pulp_user</em> --password <em>pulp_password</em> <em>/var/migration_backup/mongo_dump/pulp_database/</em></pre>
</div>
</div>
</li>
<li>
<p>Use the <code>foreman-installer</code> command to update Foreman to point to the new databases:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">foreman-installer --scenario katello \
    --foreman-db-host <em>postgres.example.com</em> \
    --foreman-db-password <em>Foreman_Password</em> \
    --foreman-db-database foreman \
    --foreman-db-manage false \
    --katello-candlepin-db-host <em>postgres.example.com</em> \
    --katello-candlepin-db-name candlepin \
    --katello-candlepin-db-password <em>Candlepin_Password</em> \
    --katello-candlepin-manage-db false \
    --katello-pulp-db-username pulp \
    --katello-pulp-db-password <em>pulp_password</em> \
    --katello-pulp-db-seeds <em>mongo.example.com:27017</em> \
    --katello-pulp-db-name <em>pulp_database</em> \
    --katello-pulp-manage-db false</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-satellite-ansible-content-collections_admin">4. Managing Foreman with Ansible Collections</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Foreman Ansible Collections is a set of Ansible modules that interact with the Foreman API. You can use Foreman Ansible Collections to manage and automate many aspects of Foreman.</p>
</div>
<div class="sect2">
<h3 id="installing-satellite-ansible-modules-via-rpm_admin">4.1. Installing the Foreman Ansible Modules from RPM</h3>
<div class="paragraph">
<p>Use this procedure to install the Foreman Ansible modules.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Install the RPM from the client repository on yum.theforeman.org using the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install ansible-collection-theforeman-foreman</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="listing-using-satellite-ansible-modules_admin">4.2. Viewing the Foreman Ansible Modules</h3>
<div class="paragraph">
<p>Starting with Ansible 2.10, you can view the installed Foreman Ansible modules by running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ansible-doc -l `theforeman.foreman`</pre>
</div>
</div>
<div class="paragraph">
<p>When using Ansible before 2.10, you can view the installed Foreman Ansible modules by listing the content of the following directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ls /usr/share/ansible/collections/ansible_collections/theforeman/foreman/plugins/modules/</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can also see the complete list of Foreman Ansible modules and other related information at <a href="https://galaxy.ansible.com/theforeman/foreman" class="bare">https://galaxy.ansible.com/theforeman/foreman</a>.</p>
</div>
<div class="paragraph">
<p>All modules are in the `theforeman.foreman` namespace and can be referred to in the format `theforeman.foreman._module_name_`. For example, to display information about the <code>activation_key</code> module, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ ansible-doc theforeman.foreman.activation_key</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Users_and_Roles">5. Managing Users and Roles</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A User defines a set of details for individuals using the system. Users can be associated with organizations and environments, so that when they create new entities, the default settings are automatically used. Users can also have one or more <em>roles</em> attached, which grants them rights to view and manage organizations and environments. See <a href="#user-management_admin">User Management</a> for more information on working with users.</p>
</div>
<div class="paragraph">
<p>You can manage permissions of several users at once by organizing them into user groups. User groups themselves can be further grouped to create a hierarchy of permissions. See <a href="#sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Users_and_Roles-Creating_and_Managing_User_Groups">Creating and Managing User Groups</a> for more information on creating user groups.</p>
</div>
<div class="paragraph">
<p>Roles define a set of permissions and access levels. Each role contains one on more <em>permission filters</em> that specify the actions allowed for the role. Actions are grouped according to the <em>Resource type</em>. Once a role has been created, users and user groups can be associated with that role. This way, you can assign the same set of permissions to large groups of users. Foreman provides a set of predefined roles and also enables creating custom roles and permission filters as described in <a href="#sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Users_and_Roles-Creating_and_Managing_Roles">Creating and Managing Roles</a>.</p>
</div>
<div class="sect2">
<h3 id="user-management_admin">5.1. User Management</h3>
<div class="paragraph">
<p>As an administrator, you can create, modify and remove Foreman users. You can also configure access permissions for a user or a group of users by assigning them different <em>roles</em>.</p>
</div>
<div class="sect3">
<h4 id="creating-a-user_admin">5.1.1. Creating a User</h4>
<div class="paragraph">
<p>Use this procedure to create a user.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To create a user, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Users</strong>.</p>
</li>
<li>
<p>Click <strong>Create User</strong>.</p>
</li>
<li>
<p>In the <strong>Login</strong> field, enter a username for the user.</p>
</li>
<li>
<p>In the <strong>Firstname</strong> and <strong>Lastname</strong> fields, enter the real first name and last name of the user.</p>
</li>
<li>
<p>In the <strong>Mail</strong> field, enter the user’s email address.</p>
</li>
<li>
<p>In the <strong>Description</strong> field, add a description of the new user.</p>
</li>
<li>
<p>Select a specific language for the user from the <strong>Language</strong> list.</p>
</li>
<li>
<p>Select a timezone for the user from the <strong>Timezone</strong> list.</p>
<div class="paragraph">
<p>By default, Foreman&#160;server uses the language and timezone settings of the user’s browser.</p>
</div>
</li>
<li>
<p>Set a password for the user:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>From the <strong>Authorized by</strong> list, select the source by which the user is authenticated.</p>
<div class="ulist">
<ul>
<li>
<p><strong>INTERNAL</strong>: to enable the user to be managed inside Foreman&#160;server.</p>
</li>
<li>
<p><strong>EXTERNAL</strong>: to configure external authentication as described in <a href="#chap-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Configuring_External_Authentication">[chap-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Configuring_External_Authentication]</a>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Enter an initial password for the user in the <strong>Password</strong> field and the <strong>Verify</strong> field.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Submit</strong> to create the user.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>To create a user, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer user create \
--login <em>user_name</em> \
--password <em>user_password</em> \
--mail <em>user_mail</em> \
--auth-source-id 1 \
--organization-ids <em>org_ID1</em>,<em>org_ID2</em>...</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>--auth-source-id 1</code> setting means that the user is authenticated internally, you can specify an external authentication source as an alternative. Add the <code>--admin</code> option to grant administrator privileges to the user. Specifying organization IDs is not required, you can modify the user details later using the <code>update</code> subcommand.</p>
</div>
<div class="paragraph">
<p>For more information about user related subcommands, enter <code>hammer user --help</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="assigning-roles-to-a-user_admin">5.1.2. Assigning Roles to a User</h4>
<div class="paragraph">
<p>Use this procedure to assign roles to a user.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Users</strong>.</p>
</li>
<li>
<p>Click the <strong>username</strong> of the user to be assigned one or more roles.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If a user account is not listed, check that you are currently viewing the correct organization. To list all the users in Foreman, click <strong>Default Organization</strong> and then <strong>Any Organization</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Click the <strong>Locations</strong> tab, and select a location if none is assigned.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab, and check that an organization is assigned.</p>
</li>
<li>
<p>Click the <strong>Roles</strong> tab to display the list of available roles.</p>
</li>
<li>
<p>Select the roles to assign from the <strong>Roles</strong> list.</p>
<div class="paragraph">
<p>To grant all the available permissions, select the <strong>Admin</strong> check box.</p>
</div>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To view the roles assigned to a user, click the <strong>Roles</strong> tab; the assigned roles are listed under <strong>Selected items</strong>. To remove an assigned role, click the role name in <strong>Selected items</strong>.</p>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>To assign roles to a user, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer user add-role --id <em>user_id</em> --role <em>role_name</em></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="impersonating-a-different-user-account_admin">5.1.3. Impersonating a Different User Account</h4>
<div class="paragraph">
<p>Administrators can impersonate other authenticated users for testing and troubleshooting purposes by temporarily logging on to the Foreman web UI as a different user.
When impersonating another user, the administrator has permissions to access exactly what the impersonated user can access in the system, including the same menus.</p>
</div>
<div class="paragraph">
<p>Audits are created to record the actions that the administrator performs while impersonating another user. However, all actions that an administrator performs while impersonating another user are recorded as having been performed by the impersonated user.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that you are logged on to the Foreman web UI as a user with administrator privileges for Foreman.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To impersonate a different user account, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Users</strong>.</p>
</li>
<li>
<p>To the right of the user that you want to impersonate, from the list in the <strong>Actions</strong> column, select <strong>Impersonate</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When you want to stop the impersonation session, in the upper right of the main menu, click the impersonation icon.</p>
</div>
</div>
<div class="sect3">
<h4 id="ssh-keys_admin">5.1.4. SSH Keys</h4>
<div class="paragraph">
<p>Adding SSH keys to a user allows deployment of SSH keys during provisioning.</p>
</div>
<div class="paragraph">
<p>For information on deploying SSH keys during provisioning, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.8/html/provisioning_guide/using_pxe_to_provision_hosts#Configuring_Provisioning_Resources-Creating_Provisioning_Templates-Deploying_SSH_Keys_during_Provisioning">Deploying SSH Keys during Provisioning</a> in the <em>Provisioning Guide</em>.</p>
</div>
<div class="paragraph">
<p>For information on SSH keys and SSH key creation, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/ch-getting_started#sec-SSH">Using SSH-based Authentication</a> in the <em>Red&#160;Hat Enterprise Linux 7 System Administrator&#8217;s Guide</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="managing-ssh-keys-for-a-user_admin">5.1.5. Managing SSH Keys for a User</h4>
<div class="paragraph">
<p>Use this procedure to add or remove SSH keys for a user.</p>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>Make sure that you are logged in to the web UI as an Admin user of Foreman or a user with the <em>create_ssh_key</em> permission enabled for adding SSH key and <em>destroy_ssh_key</em> permission for removing a key.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Users</strong>.</p>
</li>
<li>
<p>From the <strong>Username</strong> column, click on the username of the required user.</p>
</li>
<li>
<p>Click on the <strong>SSH Keys</strong> tab.</p>
<div class="ulist">
<ul>
<li>
<p>To Add SSH key</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Prepare the content of the public SSH key in a clipboard.</p>
</li>
<li>
<p>Click <strong>Add SSH Key</strong>.</p>
</li>
<li>
<p>In the <strong>Key</strong> field, paste the public SSH key content from the clipboard.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the SSH key.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>To Remove SSH key</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Click <strong>Delete</strong> on the row of the SSH key to be deleted.</p>
</li>
<li>
<p>Click <strong>OK</strong> in the confirmation prompt.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>To add an SSH key to a user, you must specify either the path to the public SSH key file, or the content of the public SSH key copied to the clipboard.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you have the public SSH key file, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer user ssh-keys add \
--user-id <em>user_id</em> \
--name <em>key_name</em> \
--key-file <em>~/.ssh/id_rsa.pub</em></pre>
</div>
</div>
</li>
<li>
<p>If you have the content of the public SSH key, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer user ssh-keys add \
--user-id <em>user_id</em> \
--name <em>key_name</em> \
--key <em>ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNtYAAABBBHHS2KmNyIYa27Qaa7EHp+2l99ucGStx4P77e03ZvE3yVRJEFikpoP3MJtYYfIe8k 1/46MTIZo9CPTX4CYUHeN8= host@user</em></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>To delete an SSH key from a user, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer user ssh-keys delete --id <em>key_id</em> --user-id <em>user_id</em></pre>
</div>
</div>
<div class="paragraph">
<p>To view an SSH key attached to a user, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer user ssh-keys info --id <em>key_id</em> --user-id <em>user_id</em></pre>
</div>
</div>
<div class="paragraph">
<p>To list SSH keys attached to a user, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer user ssh-keys list --user-id <em>user_id</em></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="email-notifications_admin">5.1.6. Email Notifications</h4>
<div class="paragraph">
<p>Email notifications are created by Foreman&#160;server periodically or after completion of certain events. The periodic notifications can be sent daily, weekly or monthly.</p>
</div>
<div class="paragraph">
<p>The events that trigger a notification are the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Host build</p>
</li>
<li>
<p>Content View promotion</p>
</li>
<li>
<p>Error reported by host</p>
</li>
<li>
<p>Repository sync</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Users do not receive any email notifications by default. An administrator can configure users to receive notifications based on criteria such as the type of notification, and frequency.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you want email notifications sent to a group&#8217;s email address, instead of an individual&#8217;s email address, create a user account with the group&#8217;s email address and minimal Foreman permissions, then subscribe the user account to the desired notification types.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Foreman&#160;server does not enable outgoing emails by default, therefore you must review your email configuration. For more information, see <a href="https://docs.theforeman.org/master/Installing_Server_on_Red_Hat/index-foreman.html#configuring-satellite-for-outgoing-emails_foreman">Configuring Foreman&#160;server for Outgoing Emails</a> in <em>Installing Foreman&#160;server from a Connected Network</em>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="configuring-email-notifications_admin">5.1.7. Configuring Email Notifications</h4>
<div class="paragraph">
<p>Configure email notifications for a user from the Foreman web UI.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Users</strong>.</p>
</li>
<li>
<p>Click the <strong>Username</strong> of the user you want to edit.</p>
</li>
<li>
<p>On the <strong>User</strong> tab, verify the value of the <strong>Mail</strong> field. Email notifications will be sent to the address in this field.</p>
</li>
<li>
<p>On the <strong>Email Preferences</strong> tab, select <strong>Mail Enabled</strong>.</p>
</li>
<li>
<p>Select the notifications you want the user to receive using the drop-down menus next to the notification types.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <strong>Audit Summary</strong> notification can be filtered by entering the required query in the <strong>Mail Query</strong> text box.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
<div class="paragraph">
<p>The user will start receiving the notification emails.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="testing-email-delivery_admin">5.1.8. Testing Email Delivery</h4>
<div class="paragraph">
<p>To verify the delivery of emails, send a test email to a user. If the email gets delivered, the settings are correct.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Users</strong>.</p>
</li>
<li>
<p>Click on the username.</p>
</li>
<li>
<p>On the <strong>Email Preferences</strong> tab, click <strong>Test email</strong>.</p>
<div class="paragraph">
<p>A test email message is sent immediately to the user&#8217;s email address.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>If the email is delivered, the verification is complete. Otherwise, you must perform the following diagnostic steps:</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Verify the user&#8217;s email address.</p>
</li>
<li>
<p>Verify Foreman&#160;server&#8217;s email configuration.</p>
</li>
<li>
<p>Examine firewall and mail server logs.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="testing-email-notifications_admin">5.1.9. Testing Email Notifications</h4>
<div class="paragraph">
<p>To verify that users are correctly subscribed to notifications, trigger the notifications manually.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To trigger the notifications, execute the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-rake reports:&lt;<em>frequency</em>&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Replace <em>frequency</em> with one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>daily</p>
</li>
<li>
<p>weekly</p>
</li>
<li>
<p>monthly</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>This triggers all notifications scheduled for the specified frequency for all the subscribed users. If every subscribed user receives the notifications, the verification succeeds.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Sending manually triggered notifications to individual users is currently not supported.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="notification-types_admin">5.1.10. Notification Types</h4>
<div class="paragraph">
<p>The following are the notifications created by Foreman:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Audit summary</strong>: A summary of all activity audited by the Foreman&#160;server.</p>
</li>
<li>
<p><strong>Host built</strong>: A notification sent when a host is built.</p>
</li>
<li>
<p><strong>Host errata advisory</strong>: A summary of applicable and installable errata for hosts managed by the user.</p>
</li>
<li>
<p><strong>OpenSCAP policy summary</strong>: A summary of OpenSCAP policy reports and their results.</p>
</li>
<li>
<p><strong>Promote errata</strong>: A notification sent only after a Content View promotion. It contains a summary of errata applicable and installable to hosts registered to the promoted Content View. This allows a user to monitor what updates have been applied to which hosts.</p>
</li>
<li>
<p><strong>Puppet error state</strong>: A notification sent after a host reports an error related to Puppet.</p>
</li>
<li>
<p><strong>Puppet summary</strong>: A summary of Puppet reports.</p>
</li>
<li>
<p><strong>Sync errata</strong>: A notification sent only after synchronizing a repository. It contains a summary of new errata introduced by the synchronization.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Users_and_Roles-Creating_and_Managing_User_Groups">5.2. Creating and Managing User Groups</h3>
<div class="sect3">
<h4 id="user-groups_admin">5.2.1. User Groups</h4>
<div class="paragraph">
<p>With Foreman, you can assign permissions to groups of users. You can also create user groups as collections of other user groups. If using an external authentication source, you can map Foreman user groups to external user groups as described in <a href="#sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Creating_User_Groups-Configuring_External_User_Groups">[sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Creating_User_Groups-Configuring_External_User_Groups]</a>.</p>
</div>
<div class="paragraph">
<p>User groups are defined in an organizational context, meaning that you must select an organization before you can access user groups.</p>
</div>
</div>
<div class="sect3">
<h4 id="creating-a-user-group_admin">5.2.2. Creating a User Group</h4>
<div class="paragraph">
<p>Use this procedure to create a user group.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>User Groups</strong>.</p>
</li>
<li>
<p>Click <strong>Create User group</strong>.</p>
</li>
<li>
<p>On the <strong>User Group</strong> tab, specify the name of the new user group and select group members:</p>
<div class="ulist">
<ul>
<li>
<p>Select the previously created user  groups from the <strong>User Groups</strong> list.</p>
</li>
<li>
<p>Select users from the <strong>Users</strong> list.</p>
</li>
</ul>
</div>
</li>
<li>
<p>On the <strong>Roles</strong> tab, select the roles you want to assign to the user group. Alternatively, select the <strong>Admin</strong> check box to assign all available permissions.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>To create a user group, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer user-group create \
--name <em>usergroup_name</em> \
--user-ids <em>user_ID1,user_ID2</em>... \
--role-ids <em>role_ID1,role_ID2</em>...</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="removing-a-user-group_admin">5.2.3. Removing a User Group</h4>
<div class="paragraph">
<p>Use the Foreman web UI to remove a user group.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>User Groups</strong>.</p>
</li>
<li>
<p>Click <strong>Delete</strong> to the right of the user group you want to delete.</p>
</li>
<li>
<p>In the alert box that appears, click <strong>OK</strong> to delete a user group.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Users_and_Roles-Creating_and_Managing_Roles">5.3. Creating and Managing Roles</h3>
<div class="paragraph">
<p>Foreman provides a set of predefined roles with permissions sufficient for standard tasks, as listed in <a href="#predefined-roles-available-in-satellite_admin">Predefined Roles Available in Foreman</a>. It is also possible to configure custom roles, and assign one or more permission filters to them. Permission filters define the actions allowed for a certain resource type. Certain Foreman plug-ins create roles automatically.</p>
</div>
<div class="sect3">
<h4 id="creating-a-role_admin">5.3.1. Creating a Role</h4>
<div class="paragraph">
<p>Use this procedure to create a role.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Roles</strong>.</p>
</li>
<li>
<p>Click <strong>Create Role</strong>.</p>
</li>
<li>
<p>Provide a <strong>Name</strong> for the role.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your new role.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>To create a role, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer role create --name <em>role_name</em></pre>
</div>
</div>
<div class="paragraph">
<p>To serve its purpose, a role must contain permissions. After creating a role, proceed to <a href="#adding-permissions-to-a-role_admin">Adding Permissions to a Role</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="cloning-a-role_admin">5.3.2. Cloning a Role</h4>
<div class="paragraph">
<p>Use the Foreman web UI to clone a role.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Roles</strong> and select <strong>Clone</strong> from the drop-down menu to the right of the required role.</p>
</li>
<li>
<p>Provide a <strong>Name</strong> for the role.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to clone the role.</p>
</li>
<li>
<p>Click the name of the cloned role and navigate to <strong>Filters</strong>.</p>
</li>
<li>
<p>Edit the permissions as required.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your new role.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="adding-permissions-to-a-role_admin">5.3.3. Adding Permissions to a Role</h4>
<div class="paragraph">
<p>Use this procedure to add permissions to a role.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Roles</strong>.</p>
</li>
<li>
<p>Select <strong>Add Filter</strong> from the drop-down list to the right of the required role.</p>
</li>
<li>
<p>Select the <strong>Resource type</strong> from the drop-down list. The <em>(Miscellaneous)</em> group gathers permissions that are not associated with any resource group.</p>
</li>
<li>
<p>Click the permissions you want to select from the <strong>Permission</strong> list.</p>
</li>
<li>
<p>Depending on the <strong>Resource type</strong> selected, you can select or deselect the <strong>Unlimited</strong> and <strong>Override</strong> check box. The <strong>Unlimited</strong> checkbox is selected by default, which means that the permission is applied on all resources of the selected type. When you disable the <strong>Unlimited</strong> check box, the <strong>Search</strong> field activates. In this field you can specify further filtering with use of the Foreman search syntax. See <a href="#sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Users_and_Roles-Granular_Permission_Filtering">Granular Permission Filtering</a> for details. When you enable the <strong>Override</strong> check box, you can add additional locations and organizations to allow the role to access the resource type in the additional locations and organizations; you can also remove an already associated location and organization from the resource type to restrict access.</p>
</li>
<li>
<p>Click <strong>Next</strong>.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save changes.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>To add permissions to a role, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>List all available permissions:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer filter available-permissions</pre>
</div>
</div>
</li>
<li>
<p>Add permissions to a role:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer filter create \
--role <em>role_name</em> \
--permission-ids <em>perm_ID1</em>,<em>perm_ID2</em>...</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>For more information about roles and permissions parameters, enter the <code>hammer role --help</code> and <code>hammer filter --help</code> commands.</p>
</div>
</div>
<div class="sect3">
<h4 id="viewing-permissions-of-a-role_admin">5.3.4. Viewing Permissions of a Role</h4>
<div class="paragraph">
<p>Use the Foreman web UI to view the permissions of a role.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Roles</strong>.</p>
</li>
<li>
<p>Click <strong>Filters</strong> to the right of the required role to get to the <strong>Filters</strong> page.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <strong>Filters</strong> page contains a table of permissions assigned to a role grouped by the resource type. It is also possible to generate a complete table of permissions and actions that you can use on your Foreman system. See <a href="#creating-a-complete-permission-table_admin">Creating a Complete Permission Table</a> for instructions.</p>
</div>
</div>
<div class="sect3">
<h4 id="creating-a-complete-permission-table_admin">5.3.5. Creating a Complete Permission Table</h4>
<div class="paragraph">
<p>Use the Foreman CLI to create a permission table.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Ensure that the required packages are installed. Execute the following command on the Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install tfm-rubygem-foreman*</pre>
</div>
</div>
</li>
<li>
<p>Start the Foreman console with the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-rake console</pre>
</div>
</div>
<div class="paragraph">
<p>Insert the following code into the console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">f = File.open('/tmp/table.html', 'w')

result = Foreman::AccessControl.permissions {|a,b| a.security_block &lt;=&gt; b.security_block}.collect do |p|
      actions = p.actions.collect { |a| "&lt;li&gt;#{a}&lt;/li&gt;" }
      "&lt;tr&gt;&lt;td&gt;#{p.name}&lt;/td&gt;&lt;td&gt;&lt;ul&gt;#{actions.join('')}&lt;/ul&gt;&lt;/td&gt;&lt;td&gt;#{p.resource_type}&lt;/td&gt;&lt;/tr&gt;"
end.join("\n")

f.write(result)</pre>
</div>
</div>
<div class="paragraph">
<p>The above syntax creates a table of permissions and saves it to the <code>/tmp/table.html</code> file.</p>
</div>
</li>
<li>
<p>Press <code><strong>Ctrl</strong></code> + <code><strong>D</strong></code> to exit the Foreman console. Insert the following text at the first line of <code>/tmp/table.html</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;table border="1"&gt;&lt;tr&gt;&lt;td&gt;Permission name&lt;/td&gt;&lt;td&gt;Actions&lt;/td&gt;&lt;td&gt;Resource type&lt;/td&gt;&lt;/tr&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Append the following text at the end of <code>/tmp/table.html</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;/table&gt;</pre>
</div>
</div>
</li>
<li>
<p>Open <code>/tmp/table.html</code> in a web browser to view the table.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="removing-a-role_admin">5.3.6. Removing a Role</h4>
<div class="paragraph">
<p>Use the Foreman web UI to remove a role.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Roles</strong>.</p>
</li>
<li>
<p>Select <strong>Delete</strong> from the drop-down list to the right of the role to be deleted.</p>
</li>
<li>
<p>In an alert box that appears, click <strong>OK</strong> to delete the role.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="predefined-roles-available-in-satellite_admin">5.3.7. Predefined Roles Available in Foreman</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 77.7778%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Role</th>
<th class="tableblock halign-left valign-top">Permissions Provided by Role footnote:[The exact set of allowed actions associated with predefined roles can be viewed by the privileged user as described in
<a href="#viewing-permissions-of-a-role_admin">]</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access Insights Admin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add and edit Insights rules.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access Insights Viewer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">View Insight reports.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ansible Roles Manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Play roles on hosts and host groups. View, destroy, and import Ansible roles. View, edit, create, destroy, and import Ansible variables.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ansible Tower Inventory Reader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">View facts, hosts, and host groups</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bookmarks manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create, edit, and delete bookmarks.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boot disk access</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Download the boot disk.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compliance manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">View, create, edit, and destroy SCAP content files, compliance policies, and tailoring files. View compliance reports.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compliance viewer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">View compliance reports.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create ARF report</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create compliance reports.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default role</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The set of permissions that every user is granted, irrespective of any other roles.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Discovery Manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">View, provision, edit, and destroy discovered hosts and manage discovery rules.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Discovery Reader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">View hosts and discovery rules.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Edit hosts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">View, create, edit, destroy, and build hosts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Edit partition tables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">View, create, edit and destroy partition tables.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A role similar to administrator, but does not have permissions to edit global settings. In the Foreman web UI, global settings can be found under <strong>Administer</strong> &gt; <strong>Settings</strong>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Organization admin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An administrator role defined per organization. The role has no visibility into resources in other organizations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Red&#160;Hat Access Logs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">View the log viewer and the logs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remote Execution Manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A role with full remote execution permissions, including modifying job templates.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remote Execution User</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Run remote execution jobs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Site manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A restrained version of the Manager role.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">System admin</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Edit global settings in <strong>Administer</strong> &gt; <strong>Settings</strong></p>
</li>
<li>
<p>View, create, edit and destroy users, user groups, and roles</p>
</li>
<li>
<p>View, create, edit, destroy, and assign organizations and locations but not view resources within them</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Users with this role can create users and assign all roles to them. Therefore, ensure to give this role only to trusted users.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tasks manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">View and edit Foreman tasks.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tasks reader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A role that can only view Foreman tasks.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Viewer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A passive role that provides the ability to view the configuration of every element of the Foreman structure, logs, reports, and statistics.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">View hosts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A role that can only view hosts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Virt-who Manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A role with full virt-who permissions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Virt-who Reporter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Upload reports generated by virt-who to Foreman. It can be used if you configure virt-who manually and require a user role that has limited virt-who permissions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Virt-who Viewer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">View virt-who configurations. Users with this role can deploy virt-who instances using existing virt-who configurations.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Users_and_Roles-Granular_Permission_Filtering">5.4. Granular Permission Filtering</h3>
<div class="sect3">
<h4 id="granular-permission-filter_admin">5.4.1. Granular Permission Filter</h4>
<div class="paragraph">
<p>As mentioned in <a href="#adding-permissions-to-a-role_admin">Adding Permissions to a Role</a>, Foreman provides the ability to limit the configured user permissions to selected instances of a resource type. These granular filters are queries to the Foreman database and are supported by the majority of resource types.</p>
</div>
</div>
<div class="sect3">
<h4 id="creating-a-granular-permission-filter_admin">5.4.2. Creating a Granular Permission Filter</h4>
<div class="paragraph">
<p>Use this procedure to create a granular filter.</p>
</div>
<div class="paragraph">
<p>Foreman does not apply search conditions to create actions. For example, limiting the <em>create_locations</em> action with <em>name = "Default Location"</em> expression in the search field does not prevent the user from assigning a custom name to the newly created location.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Specify a query in the <strong>Search</strong> field on the <strong>Edit Filter</strong> page. Deselect the <strong>Unlimited</strong> check box for the field to be active. Queries have the following form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"><em>field_name</em> <em>operator</em> <em>value</em></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><em>field_name</em> marks the field to be queried. The range of available field names depends on the resource type. For example, the <em>Partition Table</em> resource type offers <em>family</em>, <em>layout</em>, and <em>name</em> as query parameters.</p>
</li>
<li>
<p><em>operator</em> specifies the type of comparison between <em>field_name</em> and <em>value</em>. See <a href="#supported-operators-for-granular-search_admin">Supported Operators for Granular Search</a> for an overview of applicable operators.</p>
</li>
<li>
<p><em>value</em> is the value used for filtering. This can be for example a name of an organization. Two types of wildcard characters are supported: underscore (_) provides single character replacement, while percent sign (%) replaces zero or more characters.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For most resource types, the <strong>Search</strong> field provides a drop-down list suggesting the available parameters. This list appears after placing the cursor in the search field. For many resource types, you can combine queries using logical operators such as <em>and</em>, <em>not</em> and <em>has</em> operators.</p>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>To create a granular filter, enter the <code>hammer filter create</code> command with the <code>--search</code> option to limit permission filters, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer filter create \
--permission-ids 91 \
--search "name ~ ccv*" \
--role qa-user</pre>
</div>
</div>
<div class="paragraph">
<p>This command adds to the <strong>qa-user</strong> role a permission to view, create, edit, and destroy Content Views that only applies to Content Views with name starting with <code>ccv</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_examples_of_using_granular_permission_filters">5.4.3. Examples of Using Granular Permission Filters</h4>
<div class="paragraph">
<p>As an administrator, you can allow selected users to make changes in a certain part of the environment path. The following filter allows you to work with content while it is in the development stage of the application life cycle, but the content becomes inaccessible once is pushed to production.</p>
</div>
<div class="sect4">
<h5 id="applying-permissions-for-the-host-resource-type_admin">Applying Permissions for the Host Resource Type</h5>
<div class="paragraph">
<p>The following query applies any permissions specified for the Host resource type only to hosts in the group named host-editors.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">hostgroup = host-editors</pre>
</div>
</div>
<div class="paragraph">
<p>The following query returns records where the name matches <em>XXXX</em>, <em>Yyyy</em>, or <em>zzzz</em> example strings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">name ^ (XXXX, Yyyy, zzzz)</pre>
</div>
</div>
<div class="paragraph">
<p>You can also limit permissions to a selected environment. To do so, specify the environment name in the <strong>Search</strong> field, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Dev</pre>
</div>
</div>
<div class="paragraph">
<p>You can limit user permissions to a certain organization or location with the use of the granular permission filter in the <strong>Search</strong> field. However, some resource types provide a GUI alternative, an <strong>Override</strong> check box that provides the <strong>Locations</strong> and <strong>Organizations</strong> tabs. On these tabs, you can select from the list of available organizations and locations. See <a href="#creating-an-organization-specific-manager-role_admin">Creating an Organization Specific Manager Role</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="creating-an-organization-specific-manager-role_admin">Creating an Organization Specific Manager Role</h5>
<div class="paragraph">
<p>Use the Foreman UI to create an administrative role restricted to a single organization named <em>org-1</em>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Roles</strong>.</p>
</li>
<li>
<p>Clone the existing <strong>Organization admin</strong> role. Select <strong>Clone</strong> from the drop-down list next to the <strong>Filters</strong> button. You are then prompted to insert a name for the cloned role, for example <em>org-1 admin</em>.</p>
</li>
<li>
<p>Click the desired locations and organizations to associate them with the role.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to create the role.</p>
</li>
<li>
<p>Click <em>org-1 admin</em>, and click <strong>Filters</strong> to view all associated filters. The default filters work for most use cases. However, you can optionally click <strong>Edit</strong> to change the properties for each filter. For some filters, you can enable the <strong>Override</strong> option if you want the role to be able to access resources in additional locations and organizations. For example, by selecting the <strong>Domain</strong> resource type, the <strong>Override</strong> option, and then additional locations and organizations using the <strong>Locations</strong> and <strong>Organizations</strong> tabs, you allow this role to access domains in the additional locations and organizations that is not associated with this role. You can also click <strong>New filter</strong> to associate new filters with this role.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="supported-operators-for-granular-search_admin">5.4.4. Supported Operators for Granular Search</h4>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Logical Operators</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 77.7778%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">and</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Combines search criteria.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">not</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Negates an expression.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">has</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Object must have a specified property.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Symbolic Operators</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 77.7778%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Is equal to</em>. An equality comparison that is case-sensitive for text fields.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">!=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Is not equal to</em>. An inversion of the = operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">~</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Like</em>. A case-insensitive occurrence search for text fields.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">!~</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Not like</em>. An inversion of the ~ operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">^</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>In</em>. An equality comparison that is case-sensitive search for text fields. This generates a different SQL query to the <em>Is equal to</em> comparison, and is more efficient for multiple value comparison.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">!^</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Not in</em>. An inversion of the ^ operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;, &gt;=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Greater than</em>, <em>greater than or equal to</em>. Supported for numerical fields only.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;, &#8656;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Less than</em>, <em>less than or equal to</em>. Supported for numerical fields only.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Security_Compliance_Management">6. Managing Security Compliance</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Security compliance management is the ongoing process of defining security policies, auditing for compliance with those policies and resolving instances of non-compliance. Any non-compliance is managed according to the organization&#8217;s configuration management policies. Security policies range in scope from host-specific to industry-wide, therefore, flexibility in their definition is required.</p>
</div>
<div class="sect2">
<h3 id="security-content-automation-protocol_admin">6.1. Security Content Automation Protocol</h3>
<div class="paragraph">
<p>Foreman uses the Security Content Automation Protocol (SCAP) to define security configuration policies. For example, a security policy might specify that for hosts running Red&#160;Hat Enterprise&#160;Linux, login via SSH is not permitted for the <code>root</code> account. With Foreman you can schedule compliance auditing and reporting on all hosts under management. For more information about SCAP, see the <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Security_Guide/">Red Hat Enterprise Linux 7 Security Guide</a>.</p>
</div>
<div class="sect3">
<h4 id="scap-content_admin">6.1.1. SCAP Content</h4>
<div class="paragraph">
<p>SCAP content is a datastream format containing the configuration and security baseline against which hosts are checked. Checklists are described in the extensible checklist configuration description format (XCCDF) and vulnerabilities in the open vulnerability and assessment language (OVAL). Checklist items, also known as rules express the desired configuration of a system item. For example, you may specify that no one can log in to a host over SSH using the <code>root</code> user account. Rules can be grouped into one or more profiles, allowing multiple profiles to share a rule. SCAP content consists of both rules and profiles.</p>
</div>
<div class="paragraph">
<p>You can either create SCAP content or obtain it from a vendor. Supported profiles are provided for Red&#160;Hat Enterprise&#160;Linux in the scap-security-guide package. The creation of SCAP content is outside the scope of this guide, but see the <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Security_Guide/">Red Hat Enterprise Linux 7 Security Guide</a> for information on how to download, deploy, modify, and create your own content.</p>
</div>
<div class="paragraph">
<p>The default SCAP content provided with the OpenSCAP components of Foreman depends on the version of Red&#160;Hat Enterprise&#160;Linux. On Red&#160;Hat Enterprise&#160;Linux&#160;7, content for both Red&#160;Hat Enterprise&#160;Linux&#160;6 and Red&#160;Hat Enterprise&#160;Linux&#160;7 is installed.</p>
</div>
</div>
<div class="sect3">
<h4 id="xccdf-profile_admin">6.1.2. XCCDF Profile</h4>
<div class="paragraph">
<p>An XCCDF profile is a checklist against which a host or host group is evaluated. Profiles are created to verify compliance with an industry standard or custom standard.</p>
</div>
<div class="paragraph">
<p>The profiles provided with Foreman are obtained from the <a href="https://www.open-scap.org/">OpenSCAP project</a>.</p>
</div>
<div class="sect4">
<h5 id="listing-available-xccdf-profiles_admin">Listing Available XCCDF Profiles</h5>
<div class="paragraph">
<p>In the Foreman UI, list the available XCCD profiles.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>SCAP contents</strong>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Security_Compliance_Management_with_OpenSCAP-Configuring_SCAP_Content">6.2. Configuring SCAP Content</h3>
<div class="sect3">
<h4 id="importing-openscap-puppet-modules_admin">6.2.1. Importing OpenSCAP Puppet Modules</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you do not use Puppet to configure OpenSCAP auditing on hosts, you can skip this procedure.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To audit hosts with OpenSCAP, you must first import a Puppet environment. The Puppet environment contains the Puppet classes you must assign to each host to deploy the OpenSCAP configuration.</p>
</div>
<div class="paragraph">
<p>You must associate each host that you want to audit with the Puppet environment in the Foreman web UI.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Configure</strong> &gt; <strong>Environments</strong>.</p>
</li>
<li>
<p>Click <strong>Import environments from <em>foreman.example.com</em></strong>.</p>
</li>
<li>
<p>Select the Puppet environment check box associated with the host you want to audit.</p>
<div class="paragraph">
<p>If no Puppet environment exists, select the <strong>production</strong> environment check box. The Puppet classes that you require for OpenSCAP are in the <strong>production</strong> environment by default.</p>
</div>
</li>
<li>
<p>Click <strong>Update</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="loading-the-default-openscap-content">6.2.2. Loading the Default OpenSCAP Content</h4>
<div class="paragraph">
<p>In the CLI, load the default OpenScap content.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Use the <code>foreman-rake</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-rake foreman_openscap:bulk_upload:default</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="extra-scap-content_admin">6.2.3. Extra SCAP Content</h4>
<div class="paragraph">
<p>You can upload extra SCAP content into the Foreman&#160;server, either content created by yourself or obtained elsewhere. SCAP content must be imported into the Foreman&#160;server before being applied in a policy. For example, the <code>scap-security-guide</code> RPM package available in the Red&#160;Hat Enterprise&#160;Linux&#160;7.2 repositories includes a profile for the Payment Card Industry Data Security Standard (PCI-DSS) version 3. You can upload this content into a Foreman&#160;server even if it is not running Red&#160;Hat Enterprise&#160;Linux&#160;7.2 as the content is not specific to an operating system version.</p>
</div>
<div class="sect4">
<h5 id="uploading-extra-scap-content_admin">Uploading Extra SCAP Content</h5>
<div class="paragraph">
<p>In the Foreman web UI, upload the extra SCAP content.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>SCAP contents</strong> and click <strong>New SCAP Content</strong>.</p>
</li>
<li>
<p>Enter a title in the <strong>Title</strong> text box.</p>
<div class="paragraph">
<p>Example: <code><strong>RHEL 7.2 SCAP Content</strong></code>.</p>
</div>
</li>
<li>
<p>Click <strong>Choose file</strong>, navigate to the location containing the SCAP content file and select <strong>Open</strong>.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If the SCAP content file is loaded successfully, a message similar to <code>Successfully created RHEL 7.2 SCAP Content</code> is shown and the list of <strong>SCAP Contents</strong> includes the new title.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Security_Compliance_Management_with_OpenSCAP-Managing_Compliance_Policies">6.3. Managing Compliance Policies</h3>
<div class="sect3">
<h4 id="compliance-policy_admin">6.3.1. Compliance Policy</h4>
<div class="paragraph">
<p>A scheduled audit, also known as a <em>compliance policy</em>, is a scheduled task that checks the specified hosts for compliance against an XCCDF profile. The schedule for scans is specified by the Foreman&#160;server and the scans are performed on the host. When a scan completes, an <em>Asset Reporting File</em> (ARF) is generated in XML format and uploaded to the Foreman&#160;server.
You can see the results of the scan in the compliance policy dashboard. No changes are made to the scanned host by the compliance policy. The SCAP content includes several profiles with associated rules but policies are not included by default.</p>
</div>
</div>
<div class="sect3">
<h4 id="creating-a-complicance-policy_admin">6.3.2. Creating a Compliance Policy</h4>
<div class="paragraph">
<p>With Foreman, you can create a compliance policy to scan your content hosts to ensure that the hosts remain compliant to your security requirements.</p>
</div>
<div class="paragraph">
<p>You can use either Puppet or Ansible to deploy the compliance policy to your hosts. Note that Puppet runs by default every 30 minutes. If you assign a new policy, the next Puppet run synchronizes the policy to the host.
However Ansible does not perform scheduled runs. To add a new policy, you must run Ansible role manually or using remote execution. For more information about remote execution, see <a href="https://docs.theforeman.org/master/Managing_Hosts/index-foreman.html#configuring-and-setting-up-remote-jobs_managing-hosts">Configuring and Setting up Remote Jobs</a> in the <em>Managing Hosts</em> guide.</p>
</div>
<div id="form-Red_Hat_Satellite-Host_Configuration_Guide-Compliance_Policy-Creating_a_Policy-Prerequisites" class="paragraph">
<div class="title">Prerequisites</div>
<p>Before you begin, you must decide whether you want to use a Puppet or Ansible deployment.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For Puppet deployment, ensure that each host that you want to audit is associated with a Puppet environment. For more information, see <a href="#importing-openscap-puppet-modules_admin">Importing OpenSCAP Puppet Modules</a>.</p>
</li>
<li>
<p>For Ansible deployment, ensure that you import the <code>theforeman.foreman_scap_client</code> Ansible role. For more information about importing Ansible roles, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.8/html/configuring_satellite_to_use_ansible/getting-started-with-ansible_ansible">Getting Started with Ansible in Satellite</a> in <em>Configuring Satellite to use Ansible</em>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>Policies</strong>, and select whether you want a manual, Ansible, or Puppet deployment.</p>
</li>
<li>
<p>Enter a name for this policy, a description (optional), then click <strong>Next</strong>.</p>
</li>
<li>
<p>Select the SCAP Content and XCCDF Profile to be applied, then click <strong>Next</strong>.</p>
<div class="paragraph">
<p>Until <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1704582">BZ#1704582</a> is resolved, note that the <code>Default XCCDF Profile</code> might return an empty report.</p>
</div>
</li>
<li>
<p>Specify the scheduled time when the policy is to be applied, then click <strong>Next</strong>.</p>
<div class="paragraph">
<p>Select <strong>Weekly</strong>, <strong>Monthly</strong>, or <strong>Custom</strong> from the <strong>Period</strong> list.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you select <strong>Weekly</strong>, also select the desired day of the week from the <strong>Weekday</strong> list.</p>
</li>
<li>
<p>If you select <strong>Monthly</strong>, also specify the desired day of the month in the <strong>Day of month</strong> field.</p>
</li>
<li>
<p>If you select <strong>Custom</strong>, enter a valid Cron expression in the <strong>Cron line</strong> field.</p>
<div class="paragraph">
<p>The <strong>Custom</strong> option allows for greater flexibility in the policy&#8217;s schedule than either the <strong>Weekly</strong> or <strong>Monthly</strong> options.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Select the locations to which the policy is to be applied, then click <strong>Next</strong>.</p>
</li>
<li>
<p>Select the organizations to which the policy is to be applied, then click <strong>Next</strong>.</p>
</li>
<li>
<p>Select the host groups to which the policy is to be applied, then click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When the Puppet agent runs on the hosts which belong to the selected host group, or hosts to which the policy has been applied, the OpenSCAP client will be installed and a Cron job added with the policy&#8217;s specified schedule. The <code>SCAP Content</code> tab provides the name of the SCAP content file which will be distributed to the directory <code>/var/lib/openscap/content/</code> on all target hosts.</p>
</div>
</div>
<div class="sect3">
<h4 id="viewing-a-compliance-policy_admin">6.3.3. Viewing a Compliance Policy</h4>
<div class="paragraph">
<p>You can preview the rules which will be applied by specific OpenSCAP content and profile combination. This is useful when planning policies.</p>
</div>
<div class="paragraph">
<p>In the Foreman web UI, view the compliance policy.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>Policies</strong>.</p>
</li>
<li>
<p>Click <strong>Show Guide</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="editing-a-compliance-policy_admin">6.3.4. Editing a Compliance Policy</h4>
<div class="paragraph">
<p>In the Foreman web UI, edit the compliance policy.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>Policies</strong>.</p>
</li>
<li>
<p>From the drop-down list to the right of the policy&#8217;s name, select <strong>Edit</strong>.</p>
</li>
<li>
<p>Edit the necessary attributes.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>An edited policy is applied to the host when its Puppet agent next checks with the Foreman&#160;server for updates. By default this occurs every 30 minutes.</p>
</div>
</div>
<div class="sect3">
<h4 id="deleting-a-compliance-policy_admin">6.3.5. Deleting a Compliance Policy</h4>
<div class="paragraph">
<p>In the Foreman web UI, delete an existing policy.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>Policies</strong>.</p>
</li>
<li>
<p>From the drop-down list to the right of the policy&#8217;s name, select <strong>Delete</strong>.</p>
</li>
<li>
<p>Click <strong>OK</strong> in the confirmation message.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tailoring-files_admin">6.4. Tailoring Files</h3>
<div class="paragraph">
<p>Tailoring Files allow existing OpenSCAP policies to be customized without forking or rewriting the policy. You can assign a Tailoring File to a policy when creating or updating a policy.</p>
</div>
<div class="paragraph">
<p>You can create a Tailoring File using the <a href="https://www.open-scap.org/tools/scap-workbench/">SCAP Workbench</a>. For more information on using the SCAP Workbench tool, see <a href="https://www.open-scap.org/resources/documentation/customizing-scap-security-guide-for-your-use-case/">Customizing SCAP Security Guide for your use-case</a>.</p>
</div>
<div class="sect3">
<h4 id="uplodaing-a-tailoring-file_admin">6.4.1. Uploading a Tailoring File</h4>
<div class="paragraph">
<p>In the Foreman web UI, upload a Tailoring file.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>Compliance - Tailoring Files</strong> and click <strong>New Tailoring File</strong>.</p>
</li>
<li>
<p>Enter a name in the <strong>Name</strong> text box.</p>
</li>
<li>
<p>Click <strong>Choose File</strong>, navigate to the location containing the SCAP DataStream Tailoring File and select <strong>Open</strong>.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to upload the chosen Tailoring File.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="assigning-a-tailoring-file-to-a-policy_admin">6.4.2. Assigning a Tailoring File to a Policy</h4>
<div class="paragraph">
<p>In the Foreman web UI, assign a Tailoring file to a policy.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>Compliance - Policies</strong>.</p>
</li>
<li>
<p>Click <strong>New Policy</strong>, or <strong>New Compliance Policy</strong> if there are existing Compliance Policies.</p>
</li>
<li>
<p>Enter a name in the <strong>Name</strong> text box, and click <strong>Next</strong>.</p>
</li>
<li>
<p>Select a <strong>Scap content</strong> from the dropdown menu.</p>
</li>
<li>
<p>Select a <strong>XCCDF Profile</strong> from the dropdown menu.</p>
</li>
<li>
<p>Select a <strong>Tailoring File</strong> from the dropdown menu.</p>
</li>
<li>
<p>Select a <strong>XCCDF Profile in Tailoring File</strong> from the dropdown menu.</p>
<div class="paragraph">
<p>It is important to select the XCCDF Profile because Tailoring Files are able to contain multiple XCCDF Profiles.</p>
</div>
</li>
<li>
<p>Click <strong>Next</strong>.</p>
</li>
<li>
<p>Select a <strong>Period</strong> from the dropdown menu.</p>
</li>
<li>
<p>Select a <strong>Weekday</strong> from the dropdown menu, and click <strong>Next</strong>.</p>
</li>
<li>
<p>Select a <strong>Location</strong> to move it to the <strong>Selected Items</strong> window, and click <strong>Next</strong>.</p>
</li>
<li>
<p>Select an <strong>Organization</strong> to move it to the <strong>Selected Items</strong> window, and click <strong>Next</strong>.</p>
</li>
<li>
<p>Select a <strong>Hostgroup</strong> to move it to the <strong>Selected Items</strong> window, and click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-a-host-group-for-openscap_admin">6.5. Configuring a host group for OpenSCAP</h3>
<div class="paragraph">
<p>Use this procedure to configure all the OpenSCAP requirements for a host group.</p>
</div>
<div class="paragraph">
<div class="title">OpenSCAP Setup Overview</div>
<p>You must complete the following tasks on Foreman&#160;server to assign the necessary components for a host group:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enable OpenSCAP on Smart&#160;Proxy. For more information, see <a href="https://docs.theforeman.org/master/Installing_Proxy_on_Red_Hat/index-foreman.html#enabling-openscap_smart-proxy">Enabling OpenSCAP on External Smart&#160;Proxies</a> in the <em>Installing Smart&#160;Proxy&#160;server</em> guide.</p>
</li>
<li>
<p>Assign an OpenSCAP Smart&#160;Proxy.</p>
</li>
<li>
<p>Assign a Puppet environment that contains the Puppet classes to deploy the OpenSCAP policies.</p>
</li>
<li>
<p>Assign the <code>foreman_scap_client</code> and <code>foreman_scap_client::params</code> Puppet classes.</p>
</li>
<li>
<p>Assign any compliance policies that you want to add.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For information about creating and administering hosts, see the <a href="https://docs.theforeman.org/master/Managing_Hosts/index-foreman.html#">Managing Hosts</a> guide.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Configure</strong> &gt; <strong>Host Groups</strong>, and either create a host group or click the host group that you want to configure for OpenSCAP reporting.</p>
</li>
<li>
<p>From the <strong>Puppet Environment</strong> list, select the Puppet environment that contains the <code>foreman_scap_client</code> and <code>foreman_scap_client::params</code> Puppet classes.</p>
</li>
<li>
<p>From the <strong>OpenSCAP Smart&#160;Proxy</strong> list, select the Smart&#160;Proxy with OpenSCAP enabled that you want to use.</p>
</li>
<li>
<p>Click the <strong>Puppet Classes</strong> tab, and add the <code>foreman_scap_client</code> and <code>foreman_scap_client::params</code> Puppet classes.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your changes.</p>
</li>
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>Policies</strong>,</p>
</li>
<li>
<p>Select the policy that you want to assign to the host group.</p>
</li>
<li>
<p>Click the <strong>Host Groups</strong> tab.</p>
</li>
<li>
<p>From the <strong>Host Groups</strong> list, select as many host groups as you want to assign to this policy.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your changes.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-a-host-for-openscap_admin">6.6. Configuring a host for OpenSCAP</h3>
<div class="paragraph">
<p>Use this procedure to configure all the OpenSCAP requirements for a host.</p>
</div>
<div class="paragraph">
<div class="title">OpenSCAP Setup Overview</div>
<p>You must complete the following tasks on Foreman&#160;server to assign the necessary components for a host:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enable OpenSCAP on Smart&#160;Proxy. For more information, see <a href="https://docs.theforeman.org/master/Installing_Proxy_on_Red_Hat/index-foreman.html#enabling-openscap_smart-proxy">Enabling OpenSCAP on External Smart&#160;Proxies</a> in the <em>Installing Smart&#160;Proxy&#160;server</em> guide.</p>
</li>
<li>
<p>Assign an OpenSCAP Smart&#160;Proxy.</p>
</li>
<li>
<p>Assign a Puppet environment that contains the Puppet classes to deploy the OpenSCAP policies.</p>
</li>
<li>
<p>Assign the <code>foreman_scap_client</code> and <code>foreman_scap_client::params</code> Puppet classes.</p>
</li>
<li>
<p>Assign any compliance policies that you want to add.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For information about creating and administering hosts, see the <a href="https://docs.theforeman.org/master/Managing_Hosts/index-foreman.html#">Managing Hosts</a> guide.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>All Hosts</strong>, and select <strong>Edit</strong> on the host you want to configure for OpenSCAP reporting.</p>
</li>
<li>
<p>From the <strong>Puppet Environment</strong> list, select the Puppet environment that contains the <code>foreman_scap_client</code> and <code>foreman_scap_client::params</code> Puppet classes.</p>
</li>
<li>
<p>From the <strong>OpenSCAP Smart&#160;Proxy</strong> list, select the Smart&#160;Proxy with OpenSCAP enabled that you want to use.</p>
</li>
<li>
<p>Click the <strong>Puppet Classes</strong> tab, and add the <code>foreman_scap_client</code> and <code>foreman_scap_client::params</code> Puppet classes.</p>
</li>
<li>
<p>To add a compliance policy, navigate to one of the following locations:</p>
</li>
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>All Hosts</strong>,</p>
</li>
<li>
<p>Select the host or hosts to which you want to add the policy.</p>
</li>
<li>
<p>Click <strong>Select Action</strong>.</p>
</li>
<li>
<p>Select <strong>Assign Compliance Policy</strong> from the list.</p>
</li>
<li>
<p>In the Policy window, select the policy that you want from the list of available policies and click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="monitoring-compliance_admin">6.7. Monitoring Compliance</h3>
<div class="paragraph">
<p>Foreman enables centralized compliance monitoring and management. A compliance dashboard provides an overview of compliance of hosts and the ability to view details for each host within the scope of that policy. Compliance reports provide a detailed analysis of compliance of each host with the applicable policy. With this information, you can evaluate the risks presented by each host and manage the resources required to bring hosts into compliance.</p>
</div>
<div class="paragraph">
<p>Common objectives when monitoring compliance using SCAP include the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Verifying policy compliance.</p>
</li>
<li>
<p>Detecting changes in compliance.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="compliance-policy-dashboard_admin">6.7.1. Compliance Policy Dashboard</h4>
<div class="paragraph">
<p>The compliance policy dashboard provides a statistical summary of compliance of hosts and the ability to view details for each host within the scope of that policy. For all hosts which were evaluated as non-compliant, the <code>Failed</code> statistic provides a useful metric for prioritizing compliance effort. The hosts detected as <code>Never audited</code> should also be a priority, since their status is unknown.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/compliance_policy_dashboard.png" alt="Compliance Policy Dashboard">
</div>
</div>
</div>
<div class="sect3">
<h4 id="viewing-the-complience-policy-dashboard_admin">6.7.2. Viewing the Compliance Policy Dashboard</h4>
<div class="paragraph">
<p>Use the Foreman web UI to verify policy compliance with the compliance policy dashboard.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Policies</strong>.</p>
</li>
<li>
<p>Click the required policy name. The dashboard provides the following information:</p>
<div class="ulist">
<ul>
<li>
<p>A ring chart illustrating a high-level view of compliance of hosts with the policy.</p>
</li>
<li>
<p>A statistical breakdown of compliance of hosts with the policy, in a tabular format.</p>
</li>
<li>
<p>Links to the latest policy report for each host.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="compliance-email-notifications_admin">6.7.3. Compliance Email Notifications</h4>
<div class="paragraph">
<p>The Foreman&#160;server sends an OpenSCAP Summary email to all users who subscribe to the <strong>Openscap policy summary</strong> email notifications. For more information on subscribing to email notifications, see <a href="#configuring-email-notifications_admin">Configuring Email Notifications</a>. Each time a policy is run, Foreman checks the results against the previous run, noting any changes between them. The email is sent according to the frequency requested by each subscriber, providing a summary of each policy and its most recent result.</p>
</div>
<div class="paragraph">
<p>An <strong>OpenSCAP Summary</strong> email message contains the following information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Details of the time period it covers.</p>
</li>
<li>
<p>Totals for all hosts by status: changed, compliant, and noncompliant.</p>
</li>
<li>
<p>A tabular breakdown of each host and the result of its latest policy, including totals of the rules that passed, failed, changed, or where results were unknown.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="compliance-report_admin">6.7.4. Compliance Report</h4>
<div class="paragraph">
<p>A compliance report is the output of a policy run against a host. Each report includes the total number of rules passed or failed per policy. By default, reports are listed in descending date order.</p>
</div>
<div class="paragraph">
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Reports</strong> to list all compliance reports.</p>
</div>
<div class="paragraph">
<p>A compliance report consists of the following areas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Introduction</p>
</li>
<li>
<p>Evaluation Characteristics</p>
</li>
<li>
<p>Compliance and Scoring</p>
</li>
<li>
<p>Rule Overview</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Evaluation Characteristics</div>
<p>The Evaluation Characteristics area provides details about an evaluation against a specific profile, including the host that was evaluated, the profile used in the evaluation, and when the evaluation started and finished. For reference, the IPv4, IPv6, and MAC addresses of the host are also listed.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 18.75%;">
<col style="width: 37.5%;">
<col style="width: 43.75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Target machine</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The fully-qualified domain name (FQDN) of the evaluated host.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>test-system.example.com</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Benchmark URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The URL of the SCAP content against which the host was evaluated.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/var/lib/openscap/content/1fbdc87d24db51ca184419a2b6f</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Benchmark ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The identifier of the benchmark against which the host was evaluated. A benchmark is a set of profiles</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xccdf_org.ssgproject.content_benchmark_RHEL_7</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Profile ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The identifier of the profile against which the host was evaluated.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xccdf_org.ssgproject_content_profile_rht-ccp</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Started at</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The date and time at which the evaluation started, in ISO 8601 format.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2015-09-12T14:40:02</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Finished at</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The date and time at which the evaluation finished, in ISO 8601 format.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2015-09-12T14:40:05</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Performed by</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The local account name under which the evaluation was performed on the host.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>root</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">Compliance and Scoring</div>
<p>The Compliance and Scoring area provides an overview of whether or not the host is in compliance with the profile rules, a breakdown of compliance failures by severity, and an overall compliance score as a percentage. If compliance with a rule was not checked, this is categorized in the <strong>Rule results</strong> field as <strong>Other</strong>.</p>
</div>
<div class="paragraph">
<div class="title">Rule Overview</div>
<p>The Rule Overview area provides details about every rule and the compliance result, with the rules presented in a hierarchical layout.</p>
</div>
<div class="paragraph">
<p>Select or clear the check boxes to narrow the list of rules included in the compliance report. For example, if the focus of your review is any non-compliance, clear the <strong>pass</strong> and <strong>informational</strong> check boxes.</p>
</div>
<div class="paragraph">
<p>To search all rules, enter a criterion in the <strong>Search</strong> field. The search is dynamically applied as you type. The <strong>Search</strong> field only accepts a single plain-text search term and it is applied as a case-insensitive search. When you perform a search, only those rules whose descriptions match the search criterion will be listed. To remove the search filter, delete the search criterion.</p>
</div>
<div class="paragraph">
<p>For an explanation of each result, hover the cursor over the status shown in the <strong>Result</strong> column.</p>
</div>
</div>
<div class="sect3">
<h4 id="examining-rule-results_admin">6.7.5. Examining Compliance Failure of Hosts</h4>
<div class="paragraph">
<p>Use the Foreman web UI to determine why a host failed compliance on a rule.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Reports</strong> to list all compliance reports.</p>
</li>
<li>
<p>Click <strong>View Report</strong> in the row of the specific host to view the details of an individual report.</p>
</li>
<li>
<p>Click on the rule&#8217;s title to see further details:</p>
<div class="ulist">
<ul>
<li>
<p>A description of the rule with instructions for bringing the host into compliance if available.</p>
</li>
<li>
<p>The rationale for the rule.</p>
</li>
<li>
<p>In some cases, a remediation script.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Do not implement any of the recommended remedial actions or scripts without first testing them in a non-production environment.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="searching-compliance-reports_admin">6.7.6. Searching Compliance Reports</h4>
<div class="paragraph">
<p>Use the Compliance Reports search field to filter the list of available reports on any given subset of hosts.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To apply a filter, enter the search query in the <strong>Search</strong> field and click <strong>Search</strong>. The search query is case insensitive.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Search Use Cases</div>
<ul>
<li>
<p>The following search query finds all compliance reports for which more than five rules failed:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">failed &gt; 5</pre>
</div>
</div>
</li>
<li>
<p>The following search query finds all compliance reports created after January 1, <em>YYYY</em>, for hosts with host names that contain the <code>prod-</code> group of characters:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">host ~ prod- AND date &gt; "Jan 1, <em>YYYY</em>"</pre>
</div>
</div>
</li>
<li>
<p>The following search query finds all reports generated by the <code>rhel7_audit</code> compliance policy from an hour ago:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">"1 hour ago" AND compliance_policy = date = "1 hour ago" AND compliance_policy = rhel7_audit</pre>
</div>
</div>
</li>
<li>
<p>The following search query finds reports that pass an XCCDF rule:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">xccdf_rule_passed = xccdf_org.ssgproject.content_rule_firefox_preferences-auto-download_actions</pre>
</div>
</div>
</li>
<li>
<p>The following search query finds reports that fail an XCCDF rule:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">xccdf_rule_failed = xccdf_org.ssgproject.content_rule_firefox_preferences-auto-download_actions</pre>
</div>
</div>
</li>
<li>
<p>The following search query finds reports that have a result different than fail or pass for an XCCDF rule:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">xccdf_rule_othered = xccdf_org.ssgproject.content_rule_firefox_preferences-auto-download_actions</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional Information</div>
<ul>
<li>
<p>To see a list of available search parameters, click the empty <strong>Search</strong> field.</p>
</li>
<li>
<p>You can create complex queries with the following logical operators: <code>and</code>, <code>not</code> and <code>has</code>. For more information about logical operators, see <a href="#supported-operators-for-granular-search_admin">Supported Operators for Granular Search</a>.</p>
</li>
<li>
<p>You cannot use regular expressions in a search query. However, you can use multiple fields in a single search expression. For more information about all available search operators, see <a href="#supported-operators-for-granular-search_admin">Supported Operators for Granular Search</a>.</p>
</li>
<li>
<p>You can bookmark a search to reuse the same search query. For more information, see <a href="#sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Searching_and_Bookmarking-Creating_Bookmarks">[sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Searching_and_Bookmarking-Creating_Bookmarks]</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="deleting-a-compliance-reportadmin">6.7.7. Deleting a Compliance Report</h4>
<div class="paragraph">
<p>To delete a compliance report, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Reports</strong>.</p>
</li>
<li>
<p>In the Compliance Reports window, identify the policy that you want to delete and, on the right of the policy&#8217;s name, select <strong>Delete</strong>.</p>
</li>
<li>
<p>Click <strong>OK</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="deleting-multiple-compliance-reportsadmin">6.7.8. Deleting Multiple Compliance Reports</h4>
<div class="paragraph">
<p>You can delete multiple compliance policies simultaneously. However, in the Foreman web UI, compliance policies are paginated, so you must delete one page of reports at a time. If you want to delete all OpenSCAP reports, use the script in the <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.8/html/api_guide/chap-red_hat_satellite-api_guide-using_the_red_hat_satellite_api#sect-API_Guide-Deleting-OpenSCAP-Reports">Deleting OpenSCAP Reports</a> section of the <em>Foreman API Guide</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Reports</strong>.</p>
</li>
<li>
<p>In the Compliance Reports window, select the compliance reports that you want to delete.</p>
</li>
<li>
<p>In the upper right of the list, select <strong>Delete reports</strong>.</p>
</li>
<li>
<p>Repeat these steps for as many pages as you want to delete.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Specifications_Supported_OpenSCAP">6.8. Specifications Supported by OpenSCAP</h3>
<div class="paragraph">
<p>The following specifications are supported by OpenSCAP:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 60%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Title</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">XCCDF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Extensible Configuration Checklist Description Format</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OVAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Open Vulnerability and Assessment Language</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5.11</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asset Identification</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ARF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asset Reporting Format</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CCE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Common Configuration Enumeration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Common Platform Enumeration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CVE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Common Vulnerabilities and Exposures</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CVSS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Common Vulnerability Scoring System</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.0</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Disabling_Weak_SSL_2-0_and_3-0_Encryption">7. Disabling TLS 1.0 and TLS 1.1 Encryption</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You might want to change the encryption settings for Foreman depending on the security requirements of your infrastructure or to fix vulnerabilities quickly.</p>
</div>
<div class="paragraph">
<p>Apache and Qpid services in Foreman have TLS 1.0 and 1.1 encryption enabled by default. Use this procedure on Foreman and Smart&#160;Proxy to configure Foreman and Smart&#160;Proxy to only allow TLS 1.2, as required, for example, by PCI-DSS regulations.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open the <code>/etc/foreman-installer/custom-hiera.yaml</code> file for editing:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># vi /etc/foreman-installer/custom-hiera.yaml</pre>
</div>
</div>
</li>
<li>
<p>Add the following entries:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># Apache
apache::mod::ssl::ssl_protocol: [ 'ALL' , '-SSLv3' , '-TLSv1' , '-TLSv1.1' , '+TLSv1.2' ]

# QPID Dispatch
foreman_proxy_content::qpid_router_ssl_ciphers: 'ALL:!aNULL:+HIGH:-SSLv3:!IDEA-CBC-SHA'</pre>
</div>
</div>
</li>
<li>
<p>Enter the <code>foreman-installer</code> command to apply the above configuration and configure Qpid to use TLS 1.2 only:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--foreman-proxy-content-qpid-router-ssl-protocols=TLSv1.2</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="backing-up-satellite-server-and-capsule-server">8. Backing Up Foreman&#160;server and Smart&#160;Proxy&#160;server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can back up your Foreman deployment to ensure the continuity of your Foreman deployment and associated data in the event of a disaster.
If your deployment uses custom configurations, you must consider how to handle these custom configurations when you plan your backup and disaster recovery policy.</p>
</div>
<div class="paragraph">
<p>To create a backup of your Foreman&#160;server or Smart&#160;Proxy&#160;server and all associated data, use the <code>foreman-maintain backup</code> command. Backing up to a separate storage device on a separate system is highly recommended.</p>
</div>
<div class="paragraph">
<p>Foreman services are unavailable during the backup.
Therefore, you must ensure that no other tasks are scheduled by other administrators.
You can schedule a backup using <code>cron</code>. For more information, see the <a href="#example-of-a-weekly-full-backup-followed-by-daily-incremental-backups_admin">Example of a Weekly Full Backup Followed by Daily Incremental Backups</a>.</p>
</div>
<div class="paragraph">
<p>During offline or snapshot backups, the services are inactive and Foreman is in a maintenance mode. All the traffic from outside on port 443 is rejected by a firewall to ensure there are no modifications triggered.</p>
</div>
<div class="paragraph">
<p>A backup contains sensitive information from the <code>/root/ssl-build</code> directory. For example, it can contain hostnames, ssh keys, request files and SSL certificates. You must encrypt or move the backup to a secure location to minimize the risk of damage or unauthorized access to the hosts.</p>
</div>
<div class="paragraph">
<div class="title">Conventional Backup Methods</div>
<p>You can also use conventional backup methods. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/part-system_backup_and_recovery">System Backup and Recovery</a> in the <em>Red&#160;Hat Enterprise&#160;Linux&#160;7 System Administrator&#8217;s Guide</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you plan to use the <code>foreman-maintain backup</code> command to create a backup, do not stop the <code>foreman-maintain</code> services.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>When creating a snapshot or conventional backup, you must stop all services as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain service stop</pre>
</div>
</div>
</li>
<li>
<p>Start the services after creating a snapshot or conventional backup:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain service start</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="estimating-the-size-of-a-backup_admin">8.1. Estimating the Size of a Backup</h3>
<div class="paragraph">
<p>Note that estimations in this section are for the installations that use the Katello plug-in.</p>
</div>
<div class="paragraph">
<p>The full backup creates uncompressed archives of MongoDB, PostgreSQL and Pulp database files, and Foreman configuration files. Compression occurs after the archives are created to decrease the time when Foreman services are unavailable.</p>
</div>
<div class="paragraph">
<p>A full backup requires space to store the following data:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Uncompressed Foreman database and configuration files</p>
</li>
<li>
<p>Compressed Foreman database and configuration files</p>
</li>
<li>
<p>An extra 20% of the total estimated space to ensure a reliable backup</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Enter the <code>du</code> command to estimate the size of uncompressed directories containing Foreman database and configuration files:</p>
<div class="listingblock">
<div class="content">
<pre># du -sh /var/lib/mongodb /var/lib/pgsql/data /var/lib/pulp
480G	/var/lib/mongodb
100G    /var/lib/pgsql/data
100G	/var/lib/pulp
# du -csh /var/lib/qpidd /var/lib/tftpboot /etc /root/ssl-build \
/var/www/html/pub /opt/puppetlabs
886M    /var/lib/qpidd
16M     /var/lib/tftpboot
37M	/etc
900K	/root/ssl-build
100K	/var/www/html/pub
2M	/opt/puppetlabs
942M   total</pre>
</div>
</div>
</li>
<li>
<p>Calculate how much space is required to store the compressed data.</p>
<div class="paragraph">
<p>The following table describes the compression ratio of all data items included in the backup:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Backup Data Compression Ratio</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 33.3333%;">
<col style="width: 16.6666%;">
<col style="width: 27.7779%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Data type</th>
<th class="tableblock halign-left valign-top">Directory</th>
<th class="tableblock halign-left valign-top">Ratio</th>
<th class="tableblock halign-left valign-top">Example results</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MongoDB database files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/var/lib/mongodb</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">85 - 90 %</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">480 GB &#8594; 60 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PostgreSQL database files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/var/lib/pgsql/data</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80 - 85%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100 GB &#8594; 20 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pulp RPM files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/var/lib/pulp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(not compressed)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration files</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/var/lib/qpidd</code><br>
<code>/var/lib/tftpboot</code><br>
<code>/etc</code><br>
<code>/root-ssl/build</code><br>
<code>/var/www/html/pub</code><br>
<code>/opt/puppetlabs</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">85%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">942 MB &#8594; 141 MB</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In this example, the compressed backup data occupies 180 GB in total.</p>
</div>
</li>
<li>
<p>To calculate the amount of available space you require to store a backup, calculate the sum of the estimated values of compressed and uncompressed backup data, and add an extra 20% to ensure a reliable backup.</p>
<div class="paragraph">
<p>This example requires 681 GB plus 180 GB for the uncompressed and compressed backup data, 861 GB in total. With 172 GB of extra space, 1033 GB must be allocated for the backup location.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="performing-a-full-backup-of-satellite-or-capsule_admin">8.2. Performing a Full Backup of Foreman&#160;server or Smart&#160;Proxy&#160;server</h3>
<div class="paragraph">
<p>Foreman&#160;6.8 uses the <code>foreman-maintain backup</code> command to make backups.</p>
</div>
<div class="paragraph">
<p>There are three main methods of backing up Foreman&#160;server:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Offline backup</p>
</li>
<li>
<p>Online backup</p>
</li>
<li>
<p>Snapshot backups</p>
<div class="paragraph">
<p>For more information about each of these methods, you can view the usage statements for each backup method.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For offline backups:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain backup offline --help</pre>
</div>
</div>
<div class="paragraph">
<p>For online backups:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain backup online --help</pre>
</div>
</div>
<div class="paragraph">
<p>For snapshots backups:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain backup snapshot --help</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Directory creation</div>
<p>The <code>foreman-maintain backup</code> command creates a time-stamped subdirectory in the backup directory that you specify. The <code>foreman-maintain backup</code> command does not overwrite backups, therefore you must select the correct directory or subdirectory when restoring from a backup or an incremental backup.
The <code>foreman-maintain backup</code> command stops and restarts services as required.</p>
</div>
<div class="paragraph">
<p>When you run the <code>foreman-maintain backup offline</code> command, the following default backup directories are created:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>foreman-backup</code> on Foreman</p>
</li>
<li>
<p><code>foreman-proxy-backup</code> on Smart&#160;Proxy</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you want to set a custom directory name, add the  <code>--preserve-directory</code> option and add a directory name. The backup is then stored in the directory you provide in the command line.
If you use the <code>--preserve-directory</code> option, no data is removed if the backup fails.</p>
</div>
<div class="paragraph">
<p>Note that if you use a local PgSQL database, the <code>postgres</code> user requires write access to the backup directory .</p>
</div>
<div class="paragraph">
<div class="title">Remote databases</div>
<p>You can use the <code>foreman-maintain backup</code> command to back up remote databases.</p>
</div>
<div class="paragraph">
<p>You can use both online and offline methods to back up remote databases, but if you use offline methods, such as snapshot, the <code>foreman-maintain backup</code> command performs a database dump.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that your backup location has sufficient available disk space to store the backup. For more information, see <a href="#estimating-the-size-of-a-backup_admin">Estimating the Size of a Backup</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To perform a full offline backup of Foreman&#160;server or Smart&#160;Proxy&#160;server, complete one of the following steps:</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Request other users of Foreman&#160;server or Smart&#160;Proxy&#160;server to save any changes and warn them that Foreman services are unavailable for the duration of the backup. Ensure no other tasks are scheduled for the same time as the backup.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>On Foreman&#160;server, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain backup offline <em>/var/foreman-backup</em></pre>
</div>
</div>
</li>
<li>
<p>On Smart&#160;Proxy&#160;server, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain backup offline <em>/var/foreman-proxy-backup</em></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="performing-a-backup-without-pulp-content_admin">8.3. Performing a Backup without Pulp Content</h3>
<div class="paragraph">
<p>You can perform an offline backup that excludes the contents of the Pulp directory. The backup without Pulp content is useful for debugging purposes and is only intended to provide access to configuration files without backing up the Pulp database. You cannot restore from a directory that does not contain Pulp content.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Request other users of Foreman&#160;server or Smart&#160;Proxy&#160;server to save any changes and warn them that Foreman services are unavailable for the duration of the backup. Ensure no other tasks are scheduled for the same time as the backup.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that your backup location has sufficient available disk space to store the backup. For more information, see <a href="#estimating-the-size-of-a-backup_admin">Estimating the Size of a Backup</a>.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To perform an offline backup without Pulp content, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain backup offline --skip-pulp-content <em>/var/backup_directory</em></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="performing-an-incremental-backup_admin">8.4. Performing an Incremental Backup</h3>
<div class="paragraph">
<p>Use this procedure to perform an offline backup of any changes since a previous backup.</p>
</div>
<div class="paragraph">
<p>To perform incremental backups, you must perform a full backup as a reference to create the first incremental backup of a sequence. Keep the most recent full backup and a complete sequence of incremental backups to restore from.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Request other users of Foreman&#160;server or Smart&#160;Proxy&#160;server to save any changes and warn them that Foreman services are unavailable for the duration of the backup. Ensure no other tasks are scheduled for the same time as the backup.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that your backup location has sufficient available disk space to store the backup. For more information, see <a href="#estimating-the-size-of-a-backup_admin">Estimating the Size of a Backup</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To perform a full offline backup, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain backup offline  <em>/var/backup_directory</em></pre>
</div>
</div>
</li>
<li>
<p>To create a directory within your backup directory to store the first incremental back up, enter the <code>foreman-maintain backup</code> command with the <code>--incremental</code> option:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain backup offline --incremental <em>/var/backup_directory/full_backup</em>  <em>/var/backup_directory</em></pre>
</div>
</div>
</li>
<li>
<p>To create the second incremental backup, enter the <code>foreman-maintain backup</code> command with the <code>--incremental</code> option and include the path to the first incremental backup to indicate the starting point for the next increment. This creates a directory for the second incremental backup in your backup directory:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain backup offline --incremental <em>/var/backup_directory/first_incremental_backup</em>  <em>/var/backup_directory</em></pre>
</div>
</div>
</li>
<li>
<p>Optional: If you want to point to a different version of the backup, and make a series of increments with that version of the backup as the starting point, you can do this at any time. For example, if you want to make a new incremental backup from the full backup rather than the first or second incremental backup, point to the full backup directory:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain backup offline --incremental <em>/var/backup_directory/full_backup</em>  <em>/var/backup_directory</em></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="example-of-a-weekly-full-backup-followed-by-daily-incremental-backups_admin">8.5. Example of a Weekly Full Backup Followed by Daily Incremental Backups</h3>
<div class="paragraph">
<p>The following script performs a full backup on a Sunday followed by incremental backups for each of the following days.  A new subdirectory is created for each day that an incremental backup is performed. The script requires a daily cron job.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">#!/bin/bash -e
PATH=/sbin:/bin:/usr/sbin:/usr/bin
DESTINATION=/var/backup_directory
if [[ $(date +%w) == 0 ]]; then
  foreman-maintain backup offline --assumeyes $DESTINATION
else
  LAST=$(ls -td -- $DESTINATION/*/ | head -n 1)
  foreman-maintain backup offline --assumeyes --incremental "$LAST" $DESTINATION
fi
exit 0</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>foreman-maintain backup</code> command requires <code>/sbin</code> and <code>/usr/sbin</code> directories to be in <code>PATH</code> and the <code>--assumeyes</code> option is used to skip the confirmation prompt.</p>
</div>
</div>
<div class="sect2">
<h3 id="performing-an-online-backup_admin">8.6. Performing an Online Backup</h3>
<div class="paragraph">
<p>Perform an online backup only for debugging purposes.</p>
</div>
<div class="paragraph">
<div class="title">Risks Associated with Online Backups</div>
<p>Data mismatches can occur between Mongo and Postgres databases while the services are online.</p>
</div>
<div class="paragraph">
<p>When performing an online backup, if there are procedures affecting the Pulp database, the Pulp part of the backup procedure repeats until it is no longer being altered. Because the backup of the Pulp database is the most time consuming part of backing up Foreman, if you make a change that alters the Pulp database during this time, the backup procedure keeps restarting.</p>
</div>
<div class="paragraph">
<p>For production environments, use the snapshot method. For more information, see <a href="#performing-a-snapshot-backup_admin">Performing a Snapshot Backup</a>. If you want to use the online backup method in production, proceed with caution and ensure that no modifications occur during the backup.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Request other users of Foreman&#160;server or Smart&#160;Proxy&#160;server to save any changes and warn them that Foreman services are unavailable for the duration of the backup. Ensure no other tasks are scheduled for the same time as the backup.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that your backup location has sufficient available disk space to store the backup. For more information, see <a href="#estimating-the-size-of-a-backup_admin">Estimating the Size of a Backup</a>.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To perform an online backup, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain backup online <em>/var/backup_directory</em></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="performing-a-snapshot-backup_admin">8.7. Performing a Snapshot Backup</h3>
<div class="paragraph">
<p>You can perform a snapshot backup that uses Logical Volume Manager (LVM) snapshots of the Pulp, MongoDB, and PostgreSQL directories.
Creating a backup from LVM snapshots mitigates the risk of an inconsistent backup.</p>
</div>
<div class="paragraph">
<p>The snapshot backup method is faster than a full offline backup and therefore reduces Foreman downtime.</p>
</div>
<div class="paragraph">
<p>To view the usage statement, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">foreman-maintain backup snapshot -h</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Request other Foreman&#160;server or Smart&#160;Proxy&#160;server users to save any changes and warn them that Foreman services are unavailable for the duration of the backup. Ensure no other tasks are scheduled for the same time as the backup.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>Before you perform the snapshot backup, ensure that the following conditions are met:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The system uses LVM for the directories that you snapshot: <code>/var/lib/pulp/</code>, <code>/var/lib/mongodb/</code>, and <code>/var/lib/pgsql/</code>.</p>
</li>
<li>
<p>The free disk space in the relevant volume group (VG) is three times the size of the snapshot. More precisely, the VG must have enough space unreserved by the member logical volumes (LVs) to accommodate new snapshots. In addition, one of the LVs must have enough free space for the backup directory.</p>
</li>
<li>
<p>The target backup directory is on a different LV than the directories that you snapshot.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To perform a snapshot backup, enter the <code>foreman-maintain backup snapshot</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain backup snapshot <em>/var/backup_directory</em></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>foreman-maintain backup snapshot</code> command creates snapshots when the services are active, and stops all services which can impact the backup. This makes the maintenance window shorter. After the successful snapshot, all services are restarted and LVM snapshots are removed.</p>
</div>
</div>
<div class="sect2">
<h3 id="white-listing-and-skipping-steps-when-performing-backups_admin">8.8. White-listing and Skipping Steps When Performing Backups</h3>
<div class="paragraph">
<p>A backup using the <code>foreman-maintain backup</code> command proceeds in a sequence of steps.
To skip part of the backup add the <code>--whitelist</code> option to the command and add the step label that you want to omit.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To display a list of available step labels, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain advanced procedure run -h</pre>
</div>
</div>
</li>
<li>
<p>To skip a step of the backup, enter the <code>foreman-maintain backup</code> command with the <code>--whitelist</code> option. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain backup online --whitelist backup-metadata  -y <em>/var/backup_directory</em></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Backup_and_Disaster_Recovery-Restoring_Satellite_Server_or_Capsule_Server_from_a_Backup">9. Restoring Foreman&#160;server or Smart&#160;Proxy&#160;server from a Backup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can restore Foreman Server or Red&#160;Hat Smart&#160;Proxy&#160;server from the backup data that you create as part of <a href="#backing-up-satellite-server-and-capsule-server">Backing Up Foreman&#160;server and Smart&#160;Proxy&#160;server</a>. This process outlines how to restore the backup on the same server that generated the backup, and all data covered by the backup is deleted on the target system. If the original system is unavailable, provision a system with the same configuration settings and host name.</p>
</div>
<div class="sect2">
<h3 id="restoring-from-a-full-backup_admin">9.1. Restoring from a Full Backup</h3>
<div class="paragraph">
<p>Use this procedure to restore Foreman or Smart&#160;Proxy&#160;server from a full backup. When the restore process completes, all processes are online, and all databases and system configuration revert to the state at the time of the backup.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that you are restoring to the correct instance. The Foreman instance must have the same host name, configuration, and be the same major version as the original system.</p>
</li>
<li>
<p>Ensure that you have an existing target directory. The target directory is read from the configuration files contained within the archive.</p>
</li>
<li>
<p>Ensure that you have enough space to store this data on the base system of Foreman&#160;server or Smart&#160;Proxy&#160;server as well as enough space after the restoration to contain all the data in the <code>/etc/</code> and <code>/var/</code> directories contained within the backup.</p>
<div class="paragraph">
<p>To check the space used by a directory, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># du -sh <em>/var/backup_directory</em></pre>
</div>
</div>
<div class="paragraph">
<p>To check for free space, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># df -h <em>/var/backup_directory</em></pre>
</div>
</div>
<div class="paragraph">
<p>Add the <code>--total</code> option to get a total of the results from more than one directory.</p>
</div>
</li>
<li>
<p>Ensure that all SELinux contexts are correct. Enter the following command to restore the correct SELinux contexts:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># restorecon -Rnv /</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Choose the appropriate method to install Foreman or Smart&#160;Proxy:</p>
<div class="ulist">
<ul>
<li>
<p>To install Foreman&#160;server from a connected network, follow the procedures in <a href="https://docs.theforeman.org/master/Installing_Server_on_Red_Hat/index-foreman.html#">Installing Foreman&#160;server from a Connected Network</a>.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-01-08 11:42:25 UTC
</div>
</div>
</body>
</html>