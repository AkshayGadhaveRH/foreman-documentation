<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.16">
<title>Upgrading and Updating orcharhino server</title>
<link rel="stylesheet" href="./orcharhino.css">
<script>
const rl = document.location.toString();
if (rl.includes("/master/") || rl.includes("/nightly/") || rl.includes("file://")) {
  document.open();
  document.write("<span id=\"ribbon\"><a href=\"https://github.com/theforeman/foreman-documentation/tree/master/guides\">Nightly</a></span>");
  document.close();
}
</script>
</head>
<body class="book">
<div id="header">
<h1>Upgrading and Updating orcharhino server</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="upgrading_process_overview"><a class="anchor" href="#upgrading_process_overview"></a>1. Upgrade Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter details the prerequisites and available upgrade paths to orcharhino 5.10.
Review this information before upgrading your current orcharhino installation.</p>
</div>
<div class="paragraph">
<p>In this guide, the terms update, upgrade, and migrate have the following meanings:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Upgrading</dt>
<dd>
<p>The process of advancing your orcharhino server and orcharhino Proxy installations from a y-stream release to the next, for example orcharhino 5.9 to orcharhino 5.10.</p>
</dd>
<dt class="hdlist1">Updating</dt>
<dd>
<p>The process of advancing your orcharhino server and orcharhino Proxy installations from a z-stream release to the next, for example orcharhino 5.10.0 to orcharhino 5.10.1.</p>
</dd>
<dt class="hdlist1">Migrating</dt>
<dd>
<p>The process of moving an existing orcharhino installation to another Red&#160;Hat Enterprise&#160;Linux server.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For interactive upgrade instructions, you can also use the orcharhino Upgrade Helper on the Red&#160;Hat Customer Portal.
This application provides you with an exact guide to match your current version number.
You can find instructions that are specific to your upgrade path, as well as steps to prevent known issues.
For more information, see <a href="https://access.redhat.com/labs/satelliteupgradehelper/">orcharhino Upgrade Helper</a> on the customer portal.</p>
</div>
<div class="paragraph">
<p>Note that you can upgrade orcharhino Proxies separately from orcharhino.
For more information, see <a href="#Upgrading_Proxies_Separately_from_Server_upgrade-guide">Upgrading orcharhino Proxies Separately from orcharhino</a>.</p>
</div>
<div class="sect2">
<h3 id="upgrading_prerequisites"><a class="anchor" href="#upgrading_prerequisites"></a>1.1. Prerequisites</h3>
<div class="paragraph">
<p>Upgrading to orcharhino 5.10 affects your entire orcharhino infrastructure.
Before proceeding, complete the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Read the orcharhino 5.10 Release Notes.</p>
</li>
<li>
<p>Review this guide so that you are aware of the upgrade process and its impact.</p>
</li>
<li>
<p>Plan your upgrade path.
For more information, see <a href="#upgrade_paths">Upgrade Paths</a>.</p>
</li>
<li>
<p>Plan for the required downtime. orcharhino services are shut down during the upgrade.
The upgrade process duration might vary depending on your hardware configuration, network speed, and the amount of data that is stored on the server.</p>
<div class="paragraph">
<p>Upgrading orcharhino takes approximately 1 - 2 hours.</p>
</div>
<div class="paragraph">
<p>Upgrading orcharhino Proxy takes approximately 10 - 30 minutes.</p>
</div>
</li>
<li>
<p>Ensure that you have sufficient storage space on your server.
For more information, see <a href="https://docs.theforeman.org/nightly/Installing_Server_on_Red_Hat/index-foreman-el.html#Preparing_your_Environment_for_Installation_orcharhino">Preparing your Environment for Installation</a> in <em>Installing orcharhino server from a Connected Network</em> and <a href="https://docs.theforeman.org/nightly/Installing_Proxy_on_Red_Hat/index-foreman-el.html#preparing-environment-for-capsule-installation">Preparing your Environment for Installation</a> in <em>Installing orcharhino Proxy</em>.</p>
</li>
<li>
<p>Back up your orcharhino server and all orcharhino Proxys.
For more information, see <a href="https://docs.theforeman.org/nightly/Administering_Red_Hat_Satellite/index-foreman-el.html#Backing_Up_Server_and_Proxy_admin">Backing Up orcharhino server and orcharhino Proxy</a> in the <em>Administering orcharhino</em> guide.</p>
</li>
<li>
<p>Plan for updating any scripts you use that contain orcharhino API commands because some API commands differ between versions of orcharhino.
For more information about changes in the API, see the Red Hat Knowledgebase article <a href="https://access.redhat.com/articles/4396911">API Changes Between orcharhino Versions</a> on the Red&#160;Hat Customer Portal.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
If you customize configuration files, manually or use a tool such as Hiera, these customizations are overwritten when the installation script runs during upgrading or updating.
You can use the <code>--noop</code> option with the foreman-installer script to test for changes.
For more information, see the Red Hat Knowledgebase solution <a href="https://access.redhat.com/solutions/3351311">How to use the noop option to check for changes in orcharhino config files during an upgrade.</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="upgrade_paths"><a class="anchor" href="#upgrade_paths"></a>1.2. Upgrade Paths</h3>
<div class="paragraph">
<p>You can upgrade to orcharhino 5.10 from orcharhino 5.9.
orcharhino servers and orcharhino Proxys on earlier versions must first be upgraded to orcharhino 5.9.
For more information, see the orcharhino 5.9 Upgrade documentation.</p>
</div>
<div class="paragraph">
<div class="title">Overview of orcharhino 5.10 Upgrade Paths</div>
<p>The high level steps in upgrading to orcharhino 5.10 are as follows.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Upgrade orcharhino server and all orcharhino Proxys to orcharhino 5.10.
For more information, see <a href="#Upgrading_Server_upgrade-guide">Upgrading orcharhino server</a>.</p>
</li>
<li>
<p>Upgrade to orcharhino client on all orcharhino clients.
For more information, see <a href="#upgrading_clients">Upgrading orcharhino Clients</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="following_the_progress_of_the_upgrade"><a class="anchor" href="#following_the_progress_of_the_upgrade"></a>1.3. Following the Progress of the Upgrade</h3>
<div class="paragraph">
<p>Because of the lengthy upgrade time, use a utility such as <code>screen</code> to suspend and reattach a communication session.
You can then check the upgrade progress without staying connected to the command shell continuously.
For more information about using the screen command, see <a href="https://access.redhat.com/articles/5247">How do I use the screen command?</a> article in the <em>Red&#160;Hat Knowledge&#160;Base</em>.
For more information, see the <code>screen</code> manual page.</p>
</div>
<div class="paragraph">
<p>If you lose connection to the command shell where the upgrade command is running you can see the logs in <code>/var/log/foreman-installer/foreman.log</code> to check if the process completed successfully.</p>
</div>
</div>
<div class="sect2">
<h3 id="Upgrading_Proxies_Separately_from_Server_upgrade-guide"><a class="anchor" href="#Upgrading_Proxies_Separately_from_Server_upgrade-guide"></a>1.4. Upgrading orcharhino Proxies Separately from orcharhino</h3>
<div class="paragraph">
<p>You can upgrade orcharhino to version 5.10 and keep orcharhino Proxies at version 5.9 until you have the capacity to upgrade them too.</p>
</div>
<div class="paragraph">
<p>All the functionality that worked previously works on 5.9 orcharhino Proxies.
However, the functionality added in the 5.10 release will not work until you upgrade orcharhino Proxies to 5.10.</p>
</div>
<div class="paragraph">
<p>Upgrading orcharhino Proxies after upgrading orcharhino can be useful in the following example scenarios:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you want to have several smaller outage windows instead of one larger window.</p>
</li>
<li>
<p>If orcharhino Proxies in your organization are managed by several teams and are located in different locations.</p>
</li>
<li>
<p>If you use a load-balanced configuration, you can upgrade one load-balanced orcharhino Proxy and keep other load-balanced orcharhino Proxies at one version lower.
This allows you to upgrade all orcharhino Proxies one after another without any outage.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_upgrading_orcharhino"><a class="anchor" href="#_upgrading_orcharhino"></a>2. Upgrading orcharhino</h2>
<div class="sectionbody">
<div id="introduction_upgrading_satellite" class="paragraph">
<p>Use the following procedures to upgrade your existing orcharhino to orcharhino 5.10:</p>
</div>
<div class="paragraph">
<p>Before upgrading, see <a href="#upgrading_prerequisites">Prerequisites</a>.</p>
</div>
<div class="sect2">
<h3 id="Upgrading_Server_upgrade-guide"><a class="anchor" href="#Upgrading_Server_upgrade-guide"></a>2.1. Upgrading orcharhino server</h3>
<div class="paragraph">
<p>This section describes how to upgrade orcharhino server from 5.9 to 5.10.
You can upgrade from any minor version of orcharhino server 5.9.</p>
</div>
<div id="upgrading_satellite_server_prerequisites" class="ulist">
<div class="title">Before You Begin</div>
<ul>
<li>
<p>Note that you can upgrade orcharhino Proxies separately from orcharhino.
For more information, see <a href="#Upgrading_Proxies_Separately_from_Server_upgrade-guide">Upgrading orcharhino Proxies Separately from orcharhino</a>.</p>
</li>
<li>
<p>Review and update your firewall configuration prior to upgrading your orcharhino server.
For more information, see <a href="https://docs.theforeman.org/nightly/Installing_Server_on_Red_Hat/index-foreman-el.html#Preparing_your_Environment_for_Installation_orcharhino">Preparing your environment for installation</a> in <em>Installing orcharhino server</em>.</p>
</li>
<li>
<p>Ensure that you do not delete the manifest from the Customer Portal or in the orcharhino management UI because this removes all the entitlements of your content hosts.</p>
</li>
<li>
<p>Back up and remove all Foreman hooks before upgrading.
Restore any hooks only after orcharhino is known to be working after the upgrade is complete.</p>
</li>
<li>
<p>If you have edited any of the default templates, back up the files either by cloning or exporting them.
Cloning is the recommended method because that prevents them being overwritten in future updates or upgrades.
To confirm if a template has been edited, you can view its <strong>History</strong> before you upgrade or view the changes in the audit log after an upgrade.
In the orcharhino management UI, navigate to <strong>Monitor</strong> &gt; <strong>Audits</strong> and search for the template to see a record of changes made.
If you use the export method, restore your changes by comparing the exported template and the default template, manually applying your changes.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">orcharhino Proxy Considerations</div>
<ul>
<li>
<p>If you use Content Views to control updates to a orcharhino Proxy’s base operating system, or for orcharhino Proxy repository, you must publish updated versions of those Content Views.</p>
</li>
<li>
<p>Note that orcharhino server upgraded from 5.9 to 5.10 can use orcharhino Proxys still at 5.9.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you implemented custom certificates, you must retain the content of both the <code>/root/ssl-build</code> directory and the directory in which you created any source files associated with your custom
certificates.</p>
</div>
<div class="paragraph">
<p>Failure to retain these files during an upgrade causes the upgrade to fail.
If these files have been deleted, they must be restored from a backup in order for the upgrade to proceed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">FIPS mode</div>
<p>You cannot upgrade orcharhino server from a RHEL base system that is not operating in FIPS mode to a RHEL base system that is operating in FIPS mode.</p>
</div>
<div class="paragraph">
<p>To run orcharhino server on a Red Hat Enterprise Linux base system operating in FIPS mode, you must install orcharhino on a freshly provisioned RHEL base system operating in FIPS mode.
For more information, see <a href="https://docs.theforeman.org/nightly/Installing_Server_on_Red_Hat/index-foreman-el.html#Preparing_your_Environment_for_Installation_orcharhino">Preparing your environment for installation</a> in <em>Installing orcharhino server</em>.</p>
</div>
<div class="sect3">
<h4 id="preparing_to_migrate_pulp_content"><a class="anchor" href="#preparing_to_migrate_pulp_content"></a>2.1.1. Preparing to Migrate Content to Pulp 3</h4>
<div class="paragraph">
<p>The time to prepare content for Pulp 3 depends on the amount of content and the number of content views.
For large systems, this can mean several days of downtime.
To prevent this, pre-migrate Pulp content while running the latest version of orcharhino server 5.9.
This reduces the overall upgrade downtime.</p>
</div>
<div class="paragraph">
<p>Use this procedure to begin migrating content from Pulp 2 to Pulp 3.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>View details of the content you are pre-migrating using the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain content migration-stats</pre>
</div>
</div>
<div class="paragraph">
<p>Use this command as often as necessary during the migration process to determine how long the process will take.
It also identifies corrupted or missing content that might cause the migration to fail.
Output is similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Running Retrieve Pulp 2 to Pulp 3 migration statistics
============================================
Retrieve Pulp 2 to Pulp 3 migration statistics:
============Migration Summary================
Migrated/Total RPMs: 0/367633
Migrated/Total errata: 0/20780140
Migrated/Total repositories: 0/33924
Estimated migration time based on yum content: 47 hours, 23 minutes
Note: ensure there is sufficient storage space for /var/lib/pulp/published to
double in size before starting the migration process.
Check the size of /var/lib/pulp/published with 'du -sh /var/lib/pulp/published/'
[OK]</pre>
</div>
</div>
</li>
<li>
<p>Update the file permissions before upgrading orcharhino server using the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain prep-5.10-upgrade</pre>
</div>
</div>
<div class="paragraph">
<p>This might take some time on high latency systems.</p>
</div>
</li>
<li>
<p>Prepare your content for Pulp migration using the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain content prepare</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You cannot use <strong><code>Ctrl</code> + <code>C</code></strong> to terminate this process.
If you attempt to halt the process using <strong><code>Ctrl</code> + <code>C</code></strong> or by disconnecting your SSH session, the process does not terminate but continues in the background.
You can use the following command to terminate the process gracefully, whenever necessary, so that you can continue later.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain content prepare-abort</pre>
</div>
</div>
<div class="paragraph">
<p>Note that <code>foreman-maintain content-prepare abort</code> can take several minutes to terminate the process.
You can continue the migration process using <code>foreman-maintain content-prepare</code> whenever it is convenient.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>The process does not confirm that migration is complete.
You can determine how near the process is to completion by using:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain content migration-stats</pre>
</div>
</div>
<div class="paragraph">
<p>at intervals until the indicated migration time is at or near zero.</p>
</div>
</li>
<li>
<p>The final steps of Pulp content migration are completed when upgrading orcharhino server from 5.9 to 5.10.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If problems occur, you can restart the pre-migration process from the beginning using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain content migration-reset</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="upgrading_a_connected_satellite_server"><a class="anchor" href="#upgrading_a_connected_satellite_server"></a>2.1.2. Upgrading a Connected orcharhino server</h4>
<div class="paragraph">
<p>Use this procedure for a orcharhino server with access to the public internet</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
If you customize configuration files, manually or using a tool such as Hiera, these changes are overwritten when the installation script runs during upgrading or updating.
You can use the <code>--noop</code> option with the foreman-installer script to test for changes.
For more information, see the Red Hat Knowledgebase solution <a href="https://access.redhat.com/solutions/3351311">How to use the noop option to check for changes in orcharhino config files during an upgrade.</a>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Upgrade orcharhino server</div>
<ol class="arabic">
<li>
<p>Create a backup.</p>
<div class="ulist">
<ul>
<li>
<p>On a virtual machine, take a snapshot.</p>
</li>
<li>
<p>On a physical machine, create a backup.</p>
<div class="paragraph">
<p>For more information about backups, see <a href="https://docs.theforeman.org/nightly/Administering_Red_Hat_Satellite/index-foreman-el.html#Backing_Up_Server_and_Proxy_admin">Backing Up orcharhino server and orcharhino Proxy</a> in the <em>Administering orcharhino 5.9</em> guide.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Optional: If you made manual edits to DNS or DHCP configuration in the <code>/etc/zones.conf</code> or <code>/etc/dhcp/dhcpd.conf</code> files, back up the configuration files because the installer only supports one domain or subnet, and therefore restoring changes from these backups might be required.</p>
</li>
<li>
<p>Optional: If you made manual edits to DNS or DHCP configuration files and do not want to overwrite the changes, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-proxy-dns-managed=false \
--foreman-proxy-dhcp-managed=false</pre>
</div>
</div>
</li>
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Discovered hosts</strong>.
On the Discovered Hosts page, power off and then delete the discovered hosts.
From the <strong>Select an Organization</strong> menu, select each organization in turn and repeat the process to power off and delete the discovered hosts.
Make a note to reboot these hosts when the upgrade is complete.</p>
</li>
<li>
<p>Check when the kernel packages were last updated:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># rpm -qa --last | grep kernel</pre>
</div>
</div>
</li>
<li>
<p>Optional: If a kernel update occurred since the last reboot, reboot the system:</p>
<div class="listingblock">
<div class="content">
<pre># reboot</pre>
</div>
</div>
</li>
<li>
<p>If using a BASH shell, after a successful or failed upgrade, enter:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hash -d foreman-maintain service 2> /dev/null</pre>
</div>
</div>
</li>
<li>
<p>If you have migrated content from Pulp 2 to Pulp 3, remove all Pulp 2 content.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain content remove-pulp2</pre>
</div>
</div>
<div class="paragraph">
<p>This removes Pulp 2 RPMs, content in <code>/var/lib/pulp/content/</code>, the mongo database, and migration content in the Pulp 3 database.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="upgrading_capsule_server"><a class="anchor" href="#upgrading_capsule_server"></a>2.2. Upgrading orcharhino Proxys</h3>
<div class="paragraph">
<p>This section describes how to upgrade orcharhino Proxys from 5.9 to 5.10.</p>
</div>
<div class="ulist">
<div class="title">Before You Begin</div>
<ul>
<li>
<p>You must upgrade orcharhino server before you can upgrade any orcharhino Proxys.
Note that you can upgrade orcharhino Proxies separately from orcharhino.
For more information, see <a href="#Upgrading_Proxies_Separately_from_Server_upgrade-guide">Upgrading orcharhino Proxies Separately from orcharhino</a>.</p>
</li>
<li>
<p>If you use Content Views to control updates to the base operating system of orcharhino Proxy, update those Content Views with new repositories and publish their updated versions.
For more information, see <a href="https://docs.theforeman.org/nightly/Content_Management_Guide/index-foreman-el.html#Managing_Content_Views_content-management">Managing Content Views</a> in the <em>Content Management Guide</em>.</p>
</li>
<li>
<p>Ensure the orcharhino Proxy&#8217;s base system is registered to the newly upgraded orcharhino server.</p>
</li>
<li>
<p>Ensure the orcharhino Proxy has the correct organization and location settings in the newly upgraded orcharhino server.</p>
</li>
<li>
<p>Review and update your firewall configuration prior to upgrading your orcharhino Proxy.
For more information, see <a href="https://docs.theforeman.org/nightly/Installing_Proxy_on_Red_Hat/index-foreman-el.html#preparing-environment-for-capsule-installation">Preparing Your Environment for orcharhino Proxy Installation</a> in <em>Installing orcharhino Proxy</em>.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you implemented custom certificates, you must retain the content of both the <code>/root/ssl-build</code> directory and the directory in which you created any source files associated with your custom certificates.</p>
</div>
<div class="paragraph">
<p>Failure to retain these files during an upgrade causes the upgrade to fail.
If these files have been deleted, they must be restored from a backup in order for the upgrade to proceed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Upgrading orcharhino Proxys</div>
<ol class="arabic">
<li>
<p>Create a backup.</p>
<div class="ulist">
<ul>
<li>
<p>On a virtual machine, take a snapshot.</p>
</li>
<li>
<p>On a physical machine, create a backup.</p>
<div class="paragraph">
<p>For information on backups, see <a href="https://docs.theforeman.org/nightly/Administering_Red_Hat_Satellite/index-foreman-el.html#Backing_Up_Server_and_Proxy_admin">Backing Up orcharhino server and orcharhino Proxy</a> in the <em>Administering orcharhino 5.9</em> guide.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Check when the kernel packages were last updated:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># rpm -qa --last | grep kernel</pre>
</div>
</div>
</li>
<li>
<p>Optional: If a kernel update occurred since the last reboot, reboot the system:</p>
<div class="listingblock">
<div class="content">
<pre># reboot</pre>
</div>
</div>
</li>
<li>
<p>Optional: If you made manual edits to DNS or DHCP configuration files, check and restore any changes required to the DNS and DHCP configuration files using the backups made earlier.</p>
</li>
<li>
<p>Optional: If you use custom repositories, ensure that you enable these custom repositories after the upgrade completes.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="upgrading_clients"><a class="anchor" href="#upgrading_clients"></a>2.3. Upgrading orcharhino Clients</h3>
<div class="paragraph">
<p>The orcharhino client repository provides <code>katello-agent</code> and <code>katello-host-tools</code>, which provide communication services for managing Errata.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The Katello agent is deprecated and will be removed in a future orcharhino version.
Migrate your workloads to use the remote execution feature to update clients remotely.
For more information, see <a href="https://docs.theforeman.org/nightly/Managing_Hosts/index-foreman-el.html#migrating-from-katello-agent-to-remote-execution_managing-hosts">Migrating from Katello Agent to Remote Execution</a> in the <em>Managing Hosts Guide</em>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For deployments using <code>katello-agent</code> and <strong>goferd</strong>, update all clients to the new version of <code>katello-agent</code>.
For deployments not using <code>katello-agent</code> and <strong>goferd</strong>, update all clients to the new version of <code>katello-host-tools</code>.
Complete this action as soon as possible so that your clients are fully compatible with orcharhino server.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must have upgraded orcharhino server.</p>
</li>
<li>
<p>You must have enabled the new orcharhino client repositories on the orcharhino.</p>
</li>
<li>
<p>You must have synchronized the new repositories in the orcharhino.</p>
</li>
<li>
<p>If you have not previously installed <code>katello-agent</code> on your clients and you want to install it, use the manual method.
For more information, see <a href="#upgrading_clients_manually">Upgrade orcharhino Clients Manually</a>.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you implemented custom certificates, you must retain the content of both the <code>/root/ssl-build</code> directory and the directory in which you created any source files associated with your custom certificates.</p>
</div>
<div class="paragraph">
<p>Failure to retain these files during an upgrade causes the upgrade to fail.
If these files have been deleted, they must be restored from a backup in order for the upgrade to proceed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Upgrade orcharhino Clients Using the Bulk Repository Set UI:</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Content Hosts</strong> and select the Content Hosts that you want to upgrade.</p>
</li>
<li>
<p>From the <strong>Select Action</strong> list, select <strong>Manage Repository Sets</strong>.</p>
</li>
<li>
<p>From the <strong>Repository Sets Management</strong> list, select the <strong>orcharhino Tools 5.9</strong> check box.</p>
</li>
<li>
<p>From the <strong>Select Action</strong> list, select <strong>Override to Disabled</strong>, and click <strong>Done</strong>.</p>
</li>
<li>
<p>When the process completes, on the same set of hosts from the previous steps, from the <strong>Select Action</strong> list, select <strong>Manage Repository Sets</strong>.</p>
</li>
<li>
<p>From the <strong>Repository Sets Management</strong> list, select the <strong>Red Hat orcharhino client</strong> check box.</p>
</li>
<li>
<p>From the <strong>Select Action</strong> list, select <strong>Override to Enabled</strong>, and click <strong>Done</strong>.</p>
</li>
<li>
<p>When the process completes, on the same set of hosts from the previous steps, from the <strong>Select Action</strong> list, select <strong>Manage Packages</strong>.</p>
</li>
<li>
<p>In the <strong>Package</strong> search field, enter one of the following options depending on your configuration:</p>
<div class="ulist">
<ul>
<li>
<p>If your deployment uses <code>katello-agent</code> and <strong>goferd</strong>, enter <code>katello-agent</code>.</p>
</li>
<li>
<p>If your deployment does not use <code>katello-agent</code> and <strong>goferd</strong>, enter <code>katello-host-tools</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Until <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1649764">BZ#1649764</a> is resolved, from the <strong>Update</strong> list, you must select <strong>via remote execution</strong>.
This is required because if you update the package using the Katello agent, the package update disrupts the communication between the client and orcharhino or orcharhino Proxy, which causes the update to fail.
For more information, see <a href="https://docs.theforeman.org/nightly/Managing_Hosts/index-foreman-el.html#configuring-and-setting-up-remote-jobs_managing-hosts">Configuring and Setting Up Remote Jobs</a> in the <em>Managing Hosts</em> guide.</p>
</li>
</ol>
</div>
<div id="upgrading_clients_manually" class="olist arabic">
<div class="title">Upgrade orcharhino Clients Manually</div>
<ol class="arabic">
<li>
<p>Log into the client system.</p>
</li>
<li>
<p>Disable the repositories for the previous version of orcharhino.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># subscription-manager repos \
--disable rhel-7-server-satellite-tools-5.9-rpms</pre>
</div>
</div>
</li>
<li>
<p>Enable the orcharhino client repository for this version of orcharhino.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># subscription-manager repos \
--enable=https://yum.theforeman.org/client/nightly/el7/x86_64/foreman-client-release.rpm</pre>
</div>
</div>
</li>
<li>
<p>Depending on your configuration, complete one of the following steps:</p>
<div class="ulist">
<ul>
<li>
<p>If your deployment uses <code>katello-agent</code> and <strong>goferd</strong>, enter the following command to install or upgrade <code>katello-agent</code>:</p>
<div class="listingblock">
<div class="content">
<pre># yum install katello-agent</pre>
</div>
</div>
</li>
<li>
<p>If your deployment does not use <code>katello-agent</code> and <strong>goferd</strong>, enter the following command to install or upgrade <code>katello-host-tools</code>:</p>
<div class="listingblock">
<div class="content">
<pre># yum install katello-host-tools</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="post-upgrade_tasks"><a class="anchor" href="#post-upgrade_tasks"></a>2.3.1. Post-Upgrade Tasks</h4>
<div class="paragraph">
<p>Some of the procedures in this section are optional.
You can choose to perform only those procedures that are relevant to your installation.</p>
</div>
<div class="paragraph">
<p>If you use the PXE-based discovery process, then you must complete the discovery upgrade procedure on orcharhino and on any orcharhino Proxy with hosts that you want to be listed in orcharhino on the <strong>Hosts</strong> &gt; <strong>Discovered hosts</strong> page.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="upgrading_discovery_parent"><a class="anchor" href="#upgrading_discovery_parent"></a>2.4. Upgrading Discovery</h3>
<div class="paragraph">
<p>This section describes updating the PXELinux template and the boot image passed to hosts that use PXE booting to register themselves with orcharhino server.</p>
</div>
<div class="paragraph">
<p>From orcharhino 5.10, provisioning templates now have a separate association with a subnet, and do not default to using the TFTP orcharhino Proxy for that subnet.
If you create subnets after the upgrade, you must specifically enable the orcharhino or a orcharhino Proxy to provide a proxy service for discovery templates and then configure all subnets with discovered hosts to use a specific <em>template orcharhino Proxy</em>.</p>
</div>
<div class="paragraph">
<p>During the upgrade, for every subnet with a TFTP proxy enabled, the template orcharhino Proxy is set to be the same as the TFTP orcharhino Proxy.
After the upgrade, check all subnets to verify this was set correctly.</p>
</div>
<div class="paragraph">
<p>These procedures are not required if you do not use PXE booting of hosts to enable orcharhino to discover new hosts.</p>
</div>
<div class="sect3">
<h4 id="upgrading_discovery_satellite"><a class="anchor" href="#upgrading_discovery_satellite"></a>2.4.1. Upgrading Discovery on orcharhino server</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Update the Discovery template in the orcharhino management UI:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>Provisioning templates</strong>.</p>
</li>
<li>
<p>On the <code>PXELinux global default</code> line, click <strong>Clone</strong>.</p>
</li>
<li>
<p>Enter a new name for the template in the <strong>Name</strong> field, for example <code>ACME PXE global default</code>.</p>
</li>
<li>
<p>In the template editor field, change the line <code>ONTIMEOUT local</code> to <code>ONTIMEOUT discovery</code> and click <strong>Submit</strong>.</p>
</li>
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>.</p>
</li>
<li>
<p>Locate <code>Global default PXELinux template</code> and click on its <strong>Value</strong>.</p>
</li>
<li>
<p>Select the name of the newly created template from the menu and click the tick button.</p>
</li>
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>Provisioning templates</strong>.</p>
</li>
<li>
<p>Click <strong>Build PXE Default</strong>, then click <strong>OK</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>In the orcharhino management UI, go to <strong>Configure</strong> &gt; <strong>Discovery Rules</strong> and associate selected organizations and locations with discovery rules.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="upgrading_discovery_capsule"><a class="anchor" href="#upgrading_discovery_capsule"></a>2.4.2. Upgrading Discovery on orcharhino Proxys</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Verify that the Foreman Discovery package is current on orcharhino server.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install tfm-rubygem-foreman_discovery</pre>
</div>
</div>
</li>
<li>
<p>If an update occurred in the previous step, restart the <code>foreman-maintain</code> services.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain service restart</pre>
</div>
</div>
</li>
<li>
<p>Upgrade the Discovery image on the orcharhino orcharhino Proxy that is either connected to the provisioning network with discovered hosts or provides TFTP services for discovered hosts.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install foreman-discovery-image</pre>
</div>
</div>
</li>
<li>
<p>On the same instance, install the package which provides the Proxy service, and then restart <code>foreman-proxy</code> service.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install tfm-rubygem-smart_proxy_discovery
# service foreman-proxy restart</pre>
</div>
</div>
</li>
<li>
<p>In the orcharhino management UI, go to <strong>Infrastructure</strong> &gt; <strong>orcharhino Proxies</strong> and verify that the relevant orcharhino Proxy lists <strong>Discovery</strong> in the features column.
Select <strong>Refresh</strong> from the <strong>Actions</strong> drop-down menu if necessary.</p>
</li>
<li>
<p>Go to <strong>Infrastructure</strong> &gt; <strong>Subnets</strong> and for each subnet on which you want to use discovery:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click the subnet name.</p>
</li>
<li>
<p>On the <strong>orcharhino Proxies</strong> tab, ensure the <strong>Discovery orcharhino Proxy</strong> is set to a orcharhino Proxy you configured above.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="verify_subnets_have_a_template_capsule"><a class="anchor" href="#verify_subnets_have_a_template_capsule"></a>2.4.3. Verifying Subnets have a Template orcharhino Proxy</h4>
<div class="olist arabic">
<div class="title">Ensure all subnets with discovered hosts have a template orcharhino Proxy:</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Subnets</strong>.</p>
</li>
<li>
<p>Select the subnet you want to check.</p>
</li>
<li>
<p>On the <strong>orcharhino Proxies</strong> tab, ensure a <strong>Template orcharhino Proxy</strong> has been set for this subnet.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For more information about configuring subnets with template orcharhino Proxies, see <a href="https://docs.theforeman.org/nightly/Provisioning_Guide/index-foreman-el.html#configuring-the-discovery-service">Configuring the Discovery Service</a> in the <em>Provisioning Guide</em></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="upgrading_virt_who"><a class="anchor" href="#upgrading_virt_who"></a>2.5. Upgrading virt-who</h3>
<div class="paragraph">
<p>If virt-who is installed on orcharhino server or a orcharhino Proxy, it will be upgraded when they are upgraded.
No further action is required.
If virt-who is installed elsewhere, it must be upgraded manually.</p>
</div>
<div class="paragraph">
<div class="title">Before You Begin</div>
<p>If virt-who is installed on a host registered to orcharhino server or a orcharhino Proxy, first upgrade the host to the latest packages available in the orcharhino client repository.
For information about upgrading hosts, see <a href="#upgrading_clients">Upgrading orcharhino Clients</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Upgrade virt-who Manually</div>
<ol class="arabic">
<li>
<p>Upgrade virt-who.</p>
<div class="listingblock">
<div class="content">
<pre># yum upgrade virt-who</pre>
</div>
</div>
</li>
<li>
<p>Restart the virt-who service so the new version is activated.</p>
<div class="listingblock">
<div class="content">
<pre># systemctl restart virt-who.service</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="removing_satellite_tools_repository"><a class="anchor" href="#removing_satellite_tools_repository"></a>2.6. Removing the Previous Version of the orcharhino Tools Repository</h3>
<div class="paragraph">
<p>After completing the upgrade to orcharhino 5.10, the orcharhino Tools 5.9 repository can be removed from Content Views and then disabled.</p>
</div>
<div class="paragraph">
<p>Disable Version 5.9 of the orcharhino Tools Repository:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Content</strong> &gt; <strong>Red Hat Repositories</strong>.</p>
</li>
<li>
<p>In the <strong>Enabled Repositories</strong> area, locate <strong>orcharhino Tools 5.9 for RHEL 7 Server RPMs x86_64</strong>.</p>
</li>
<li>
<p>Click the <strong>Disable</strong> icon to the right.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If the repository is still contained in a Content View then you cannot disable it.
Packages from a disabled repository are removed automatically by a scheduled task.</p>
</div>
</div>
<div class="sect2">
<h3 id="reclaiming-postgresql-space-after-an-upgrade_upgrade-guide"><a class="anchor" href="#reclaiming-postgresql-space-after-an-upgrade_upgrade-guide"></a>2.7. Reclaiming PostgreSQL Space</h3>
<div class="paragraph">
<p>The PostgreSQL database can use a large amount of disk space especially in heavily loaded deployments.
Use this procedure to reclaim some of this disk space on orcharhino.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Stop all services, except for the <code>postgresql</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain service stop --exclude postgresql</pre>
</div>
</div>
</li>
<li>
<p>Switch to the <code>postgres</code> user and reclaim space on the database:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># su - postgres -c 'vacuumdb --full --dbname=foreman'</pre>
</div>
</div>
</li>
<li>
<p>Start the other services when the vacuum completes:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain service start</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="post_upgrade-updating-templates-parameters"><a class="anchor" href="#post_upgrade-updating-templates-parameters"></a>2.8. Updating Templates, Parameters, Lookup Keys and Values</h3>
<div class="paragraph">
<p>During the upgrade process, orcharhino attempts to locate macros that are deprecated for orcharhino 5.10 and converts old syntax to new syntax for the default orcharhino templates, parameters, and lookup keys and values.
However, orcharhino does not convert old syntax in the custom templates that you have created and in the cloned templates.</p>
</div>
<div class="paragraph">
<p>The process uses simple text replacement, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@host.params['parameter1'] -&gt; host_param('parameter1')
@host.param_true?('parameter1') -&gt; host_param_true?('parameter1')
@host.param_false?('parameter1') -&gt; host_param_false?('parameter1')
@host.info['parameters'] -&gt; host_enc['parameters']</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
If you use cloned templates in orcharhino, verify whether the cloned templates have diverged from the latest version of the original templates in orcharhino.
The syntax for the same template can differ between versions of orcharhino.
If your cloned templates contain outdated syntax, update the syntax to match the latest version of the template.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To ensure that this text replacement does not break or omit any variables in your files during the upgrade, check all templates, parameters, and lookup keys and values for the old syntax and replace manually.</p>
</div>
<div class="paragraph">
<p>The following error occurs because of old syntax remaining in files after the upgrade:</p>
</div>
<div class="listingblock">
<div class="content">
<pre> undefined method '#params' for Host::Managed::Jail</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Fixing the outdated subscription_manager_registration snippet</div>
<p>orcharhino 6.4 onwards uses the <code>redhat_register</code> snippet instead of the <code>subscription_manager_registration</code> snippet.</p>
</div>
<div class="paragraph">
<p>If you upgrade from orcharhino 6.3 and earlier, ensure to replace the <code>subscription_manager_registration</code> snippet in your custom templates as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;%= snippet "subscription_manager_registration" %&gt;
               ↓
&lt;%= snippet 'redhat_register' %&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tuning-with-predefined-profiles_upgrade-guide"><a class="anchor" href="#tuning-with-predefined-profiles_upgrade-guide"></a>2.9. Tuning orcharhino server with Predefined Profiles</h3>
<div class="paragraph">
<p>If your orcharhino deployment includes more than 5000 hosts, you can use predefined tuning profiles to improve performance of orcharhino.</p>
</div>
<div class="paragraph">
<p>Note that you cannot use tuning profiles on orcharhino Proxies.</p>
</div>
<div class="paragraph">
<p>You can choose one of the profiles depending on the number of hosts your orcharhino manages and available hardware resources.</p>
</div>
<div class="paragraph">
<p>The tuning profiles are available in the <code>/usr/share/foreman-installer/config/foreman.hiera/tuning/sizes</code> directory.</p>
</div>
<div class="paragraph">
<p>When you run the <code>foreman-installer</code> command with the <code>--tuning</code> option, deployment configuration settings are applied to orcharhino in the following order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The default tuning profile defined in the <code>/usr/share/foreman-installer/config/foreman.hiera/tuning/common.yaml</code> file</p>
</li>
<li>
<p>The tuning profile that you want to apply to your deployment and is defined in the <code>/usr/share/foreman-installer/config/foreman.hiera/tuning/sizes/</code> directory</p>
</li>
<li>
<p>Optional: If you have configured a <code>/etc/foreman-installer/custom-hiera.yaml</code> file, orcharhino applies these configuration settings.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note that the configuration settings that are defined in the <code>/etc/foreman-installer/custom-hiera.yaml</code> file override the configuration settings that are defined in the tuning profiles.</p>
</div>
<div class="paragraph">
<p>Therefore, before applying a tuning profile, you must compare the configuration settings that are defined in the default tuning profile in <code>/usr/share/foreman-installer/config/foreman.hiera/tuning/common.yaml</code>, the tuning profile that you want to apply and your <code>/etc/foreman-installer/custom-hiera.yaml</code> file, and remove any duplicated configuration from the <code>/etc/foreman-installer/custom-hiera.yaml</code> file.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">default</dt>
<dd>
<p>Number of managed hosts: 0-5000</p>
<div class="paragraph">
<p>RAM: 20G</p>
</div>
<div class="paragraph">
<p>Number of CPU cores: 4</p>
</div>
</dd>
<dt class="hdlist1">medium</dt>
<dd>
<p>Number of managed hosts: 5001-10000</p>
<div class="paragraph">
<p>RAM: 32G</p>
</div>
<div class="paragraph">
<p>Number of CPU cores: 8</p>
</div>
</dd>
<dt class="hdlist1">large</dt>
<dd>
<p>Number of managed hosts: 10001-20000</p>
<div class="paragraph">
<p>RAM: 64G</p>
</div>
<div class="paragraph">
<p>Number of CPU cores: 16</p>
</div>
</dd>
<dt class="hdlist1">extra-large</dt>
<dd>
<p>Number of managed hosts: 20001-60000</p>
<div class="paragraph">
<p>RAM: 128G</p>
</div>
<div class="paragraph">
<p>Number of CPU cores: 32</p>
</div>
</dd>
<dt class="hdlist1">extra-extra-large</dt>
<dd>
<p>Number of managed hosts: 60000+</p>
<div class="paragraph">
<p>RAM: 256G</p>
</div>
<div class="paragraph">
<p>Number of CPU cores: 48+</p>
</div>
</dd>
</dl>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Optional: If you have configured the <code>custom-hiera.yaml</code> file on orcharhino server, back up the <code>/etc/foreman-installer/custom-hiera.yaml</code> file to <code>custom-hiera.original</code>.
You can use the backup file to restore the <code>/etc/foreman-installer/custom-hiera.yaml</code> file to its original state if it becomes corrupted:</p>
<div class="listingblock">
<div class="content">
<pre># cp /etc/foreman-installer/custom-hiera.yaml \
/etc/foreman-installer/custom-hiera.original</pre>
</div>
</div>
</li>
<li>
<p>Optional: If you have configured the <code>custom-hiera.yaml</code> file on orcharhino server, review the definitions of the default tuning profile in <code>/usr/share/foreman-installer/config/foreman.hiera/tuning/common.yaml</code> and the tuning profile that you want to apply in <code>/usr/share/foreman-installer/config/foreman.hiera/tuning/sizes/</code>.
Compare the configuration entries against the entries in your <code>/etc/foreman-installer/custom-hiera.yaml</code> file and remove any duplicated configuration settings in your <code>/etc/foreman-installer/custom-hiera.yaml</code> file.</p>
</li>
<li>
<p>Enter the <code>foreman-installer</code> command with the <code>--tuning</code> option for the profile that you want to apply.
For example, to apply the medium tuning profile settings, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --tuning medium</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="introduction_updating_satellite" class="paragraph">
<p>Use this chapter to update your existing orcharhino server, orcharhino Proxy, and Content Hosts to a new minor version, for example, from 5.10.0 to 5.10.1.</p>
</div>
<div class="paragraph">
<p>Updates patch security vulnerabilities and minor issues discovered after code is released, and are often fast and non-disruptive to your operating environment.</p>
</div>
<div class="paragraph">
<p>Before updating, back up your orcharhino server and all orcharhino Proxys.
For more information, see <a href="https://docs.theforeman.org/nightly/Administering_Red_Hat_Satellite/index-foreman-el.html#Backing_Up_Server_and_Proxy_admin">Backing Up orcharhino server and orcharhino Proxy</a> in the <em>Administering orcharhino</em> guide.</p>
</div>
</div>
<div class="sect2">
<h3 id="updating_satellite_server_to_next_minor_version"><a class="anchor" href="#updating_satellite_server_to_next_minor_version"></a>2.10. Updating orcharhino server</h3>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that you have synchronized orcharhino server repositories for orcharhino, orcharhino Proxy, and orcharhino client.</p>
</li>
<li>
<p>Ensure each external orcharhino Proxy and Content Host can be updated by promoting the updated repositories to all relevant Content Views.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
If you customize configuration files, manually or use a tool such as Hiera, these customizations are overwritten when the installation script runs during upgrading or updating.
You can use the <code>--noop</code> option with the foreman-installer script to test for changes.
For more information, see the Red Hat Knowledgebase solution <a href="https://access.redhat.com/solutions/3351311">How to use the noop option to check for changes in orcharhino config files during an upgrade</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Updating orcharhino server to the Next Minor Version</strong></p>
</div>
<div class="olist arabic">
<div class="title">To Update orcharhino server:</div>
<ol class="arabic">
<li>
<p>Ensure the orcharhino Maintenance repository is enabled:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># subscription-manager repos --enable \
rhel-7-server-satellite-maintenance-6-rpms</pre>
</div>
</div>
</li>
<li>
<p>Check the available versions to confirm the next minor version is listed:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain upgrade list-versions</pre>
</div>
</div>
</li>
<li>
<p>Use the health check option to determine if the system is ready for upgrade.
On first use of this command, <code>foreman-maintain</code> prompts you to enter the hammer admin user credentials and saves them in the <code>/etc/foreman-maintain/foreman-maintain-hammer.yml</code> file.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain upgrade check --target-version 5.10.<em>z</em></pre>
</div>
</div>
<div class="paragraph">
<p>Review the results and address any highlighted error conditions before performing the upgrade.</p>
</div>
</li>
<li>
<p>Because of the lengthy update time, use a utility such as <code>screen</code> to suspend and reattach a communication session.
You can then check the upgrade progress without staying connected to the command shell continuously.
For more information about using the screen command, see <a href="https://access.redhat.com/articles/5247">How do I use the screen command?</a> article in the <em>Red&#160;Hat Knowledge&#160;Base</em>.</p>
<div class="paragraph">
<p>If you lose connection to the command shell where the upgrade command is running, you can see the logged messages in the <code>/var/log/foreman-installer/foreman.log</code> file to check if the process completed successfully.</p>
</div>
</li>
<li>
<p>Perform the upgrade:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain upgrade run --target-version 5.10.<em>z</em></pre>
</div>
</div>
</li>
<li>
<p>Check when the kernel packages were last updated:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># rpm -qa --last | grep kernel</pre>
</div>
</div>
</li>
<li>
<p>Optional: If a kernel update occurred since the last reboot, stop the <code>foreman-maintain</code> services and reboot the system:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain service stop
# reboot</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated Nov 2021
</div>
</div>
</body>
</html>