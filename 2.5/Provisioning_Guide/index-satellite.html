<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.16">
<title>Provisioning Guide</title>
<link rel="stylesheet" href="./satellite.css">
</head>
<body class="book">
<div id="header">
<h1>Provisioning Guide</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="provisioning-introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="provisioning-overview_provisioning">1.1. Provisioning Overview</h3>
<div class="paragraph">
<p>Provisioning is a process that starts with a bare physical or virtual machine and ends with a fully configured, ready-to-use operating system.
Using Red&#160;Hat Satellite, you can define and automate fine-grained provisioning for a large number of hosts.</p>
</div>
<div class="paragraph">
<p>There are many provisioning methods.
For example, you can use Satellite&#160;Server&#8217;s integrated Capsule or an external Capsule&#160;Server to provision bare metal hosts using PXE based methods.
You can also provision cloud instances from specific providers through their APIs.
These provisioning methods are part of the Red&#160;Hat Satellite application life cycle to create, manage, and update hosts.</p>
</div>
<div class="paragraph">
<p>Red&#160;Hat Satellite has different methods for provisioning hosts:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Bare Metal Provisioning</dt>
<dd>
<p>Satellite provisions bare metal hosts primarily through PXE boot and MAC address identification.
You can create host entries and specify the MAC address of the physical host to provision.
You can also boot blank hosts to use Satellite&#8217;s discovery service, which creates a pool of ready-to-provision hosts.</p>
</dd>
<dt class="hdlist1">Cloud Providers</dt>
<dd>
<p>Satellite connects to private and public cloud providers to provision instances of hosts from images that are stored with the Cloud environment.
This also includes selecting which hardware profile or flavor to use.</p>
</dd>
<dt class="hdlist1">Virtualization Infrastructure</dt>
<dd>
<p>Satellite connects to virtualization infrastructure services such as Red&#160;Hat&#160;Virtualization and VMware to provision virtual machines from virtual image templates or using the same PXE-based boot methods as bare metal providers.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="provisioning-workflow_provisioning">1.2. Network Boot Provisioning Workflow</h3>
<div class="paragraph">
<p>PXE booting assumes that a host, either physical or virtual, is configured to boot from network as the first booting device, and from the hard drive as the second booting device.</p>
</div>
<div class="paragraph">
<p>The provisioning process follows a basic PXE workflow:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>You create a host and select a domain and subnet.
Satellite requests an available IP address from the DHCP Capsule&#160;Server that is associated with the subnet or from the PostgreSQL database in Satellite.
Satellite loads this IP address into the <strong>IP address</strong> field in the Create Host window.
When you complete all the options for the new host, submit the new host request.</p>
</li>
<li>
<p>Depending on the configuration specifications of the host and its domain and subnet, Satellite creates the following settings:</p>
<div class="ulist">
<ul>
<li>
<p>A DHCP record on Capsule&#160;Server that is associated with the subnet.</p>
</li>
<li>
<p>A forward DNS record on Capsule&#160;Server that is associated with the domain.</p>
</li>
<li>
<p>A reverse DNS record on the DNS Capsule&#160;Server that is associated with the subnet.</p>
</li>
<li>
<p>PXELinux, Grub, Grub2, and iPXE configuration files for the host in the TFTP Capsule&#160;Server that is associated with the subnet.</p>
</li>
<li>
<p>A Puppet certificate on the associated Puppet server.</p>
</li>
<li>
<p>A realm on the associated identity server.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The new host requests a DHCP reservation from the DHCP server.</p>
</li>
<li>
<p>The DHCP server responds to the reservation request and returns TFTP <code>next-server</code> and <code>filename</code> options.</p>
</li>
<li>
<p>The host requests the boot loader and menu from the TFTP server according to the PXELoader setting.</p>
</li>
<li>
<p>A boot loader is returned over TFTP.</p>
</li>
<li>
<p>The boot loader fetches configuration for the host through its provisioning interface MAC address.</p>
</li>
<li>
<p>The boot loader fetches the operating system installer kernel, init RAM disk, and boot parameters.</p>
</li>
<li>
<p>The installer requests the provisioning template from Satellite.</p>
</li>
<li>
<p>Satellite renders the provision template and returns the result to the host.</p>
</li>
<li>
<p>The installer performs installation of the operating system.</p>
<div class="ulist">
<ul>
<li>
<p>The installer registers the host to Satellite using Red Hat Subscription Manager.</p>
</li>
<li>
<p>The installer installs management tools such as <code>katello-agent</code> and <code>puppet</code>.</p>
</li>
<li>
<p>The installer notifies Satellite of a successful build in the <code>postinstall</code> script.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The PXE configuration files revert to a local boot template.</p>
</li>
<li>
<p>The host reboots.</p>
</li>
<li>
<p>The new host requests a DHCP reservation from the DHCP server.</p>
</li>
<li>
<p>The DHCP server responds to the reservation request and returns TFTP <code>next-server</code> and <code>filename</code> options.</p>
</li>
<li>
<p>The host requests the bootloader and menu from the TFTP server according to the PXELoader setting.</p>
</li>
<li>
<p>A boot loader is returned over TFTP.</p>
</li>
<li>
<p>The boot loader fetches the configuration for the host through its provision interface MAC address.</p>
</li>
<li>
<p>The boot loader initiates boot from the local drive.</p>
</li>
<li>
<p>If you configured the host to use any Puppet classes, the host configures itself using the modules.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This workflow differs depending on custom options.
For example:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Discovery</dt>
<dd>
<p>If you use the discovery service, Satellite automatically detects the MAC address of the new host and restarts the host after you submit a request.
Note that TCP port 8443 must be reachable by the Capsule to which the host is attached for Satellite to restart the host.</p>
</dd>
<dt class="hdlist1">PXE-less Provisioning</dt>
<dd>
<p>After you submit a new host request, you must boot the specific host with the boot disk that you download from Satellite and transfer using a USB port of the host.</p>
</dd>
<dt class="hdlist1">Compute Resources</dt>
<dd>
<p>Satellite creates the virtual machine and retrieves the MAC address and stores the MAC address in Satellite.
If you use image-based provisioning, the host does not follow the standard PXE boot and operating system installation.
The compute resource creates a copy of the image for the host to use.
Depending on image settings in Satellite, seed data can be passed in for initial configuration, for example using <code>cloud-init</code>.
Satellite can connect using SSH to the host and execute a template to finish the customization.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>By default, deleting the provisioned profile host from Satellite does not destroy the actual VM on the external compute resource.
To destroy the VM when deleting the host entry on Satellite, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong> &gt; <strong>Provisioning</strong> and configure this behavior using the <strong>destroy_vm_on_host_delete</strong> setting.
If you do not destroy the associated VM and attempt to create a new VM with the same resource name later, it will fail because that VM name already exists in the external compute resource.
You can still register the existing VM to Satellite using the standard host registration workflow you would use for any already provisioned host.</p>
</div>
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-provisioning-resources">2. Configuring Provisioning Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="provisioning-contexts_provisioning">2.1. Provisioning Contexts</h3>
<div class="paragraph">
<p>A provisioning context is the combination of an organization and location that you specify for Satellite components.
The organization and location that a component belongs to sets the ownership and access for that component.</p>
</div>
<div class="paragraph">
<p>Organizations divide Red&#160;Hat Satellite&#160;6 components into logical groups based on ownership, purpose, content, security level, and other divisions.
You can create and manage multiple organizations through Red&#160;Hat Satellite&#160;6 and assign components to each individual organization.
This ensures Satellite&#160;Server provisions hosts within a certain organization and only uses components that are assigned to that organization.
For more information about organizations, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.9/html-single/content_management_guide/index#Managing_Organizations">Managing Organizations</a> in the <em>Content Management Guide</em>.</p>
</div>
<div class="paragraph">
<p>Locations function similar to organizations.
The difference is that locations are based on physical or geographical setting.
Users can nest locations in a hierarchy.
For more information about locations, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.9/html-single/content_management_guide/index#Managing_Locations">Managing Locations</a> in the <em>Content Management Guide</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="setting-the-provisioning-context_provisioning">2.2. Setting the Provisioning Context</h3>
<div class="paragraph">
<p>When you set a provisioning context, you define which organization and location to use for provisioning hosts.</p>
</div>
<div class="paragraph">
<p>The organization and location menus are located in the menu bar, on the upper left of the Satellite web UI.
If you have not selected an organization and location to use, the menu displays: <strong>Any Organization</strong> and <strong>Any Location</strong>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <strong>Any Organization</strong> and select the organization.</p>
</li>
<li>
<p>Click <strong>Any Location</strong> and select the location to use.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Each user can set their default provisioning context in their account settings.
Click the user name in the upper right of the Satellite web UI and select <strong>My account</strong> to edit your user account settings.</p>
</div>
<div class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>When using the CLI, include either <code>--organization</code> or <code>--organization-label</code> and <code>--location</code> or <code>--location-id</code> as an option.
For example:</p>
<div class="listingblock">
<div class="content">
<pre># hammer host list --organization "Default_Organization" --location "Default_Location"</pre>
</div>
</div>
<div class="paragraph">
<p>This command outputs hosts allocated for the Default_Organization and Default_Location.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="creating-operating-systems_provisioning">2.3. Creating Operating Systems</h3>
<div class="paragraph">
<p>An operating system is a collection of resources that define how Satellite&#160;Server installs a base operating system on a host.
Operating system entries combine previously defined resources, such as installation media, partition tables, provisioning templates, and others.</p>
</div>
<div class="paragraph">
<p>Importing operating systems from Red Hat&#8217;s CDN creates new entries on the <strong>Hosts</strong> &gt; <strong>Operating Systems</strong> page.</p>
</div>
<div class="paragraph">
<p>You can also add custom operating systems using the following procedure.
To use the CLI instead of the web UI, see the <a href="#cli-creating-operating-systems_provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Hosts</strong> &gt; <strong>Operating systems</strong> and click <strong>New Operating</strong> system.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name to represent the operating system entry.</p>
</li>
<li>
<p>In the <strong>Major</strong> field, enter the number that corresponds to the major version of the operating system.</p>
</li>
<li>
<p>In the <strong>Minor</strong> field, enter the number that corresponds to the minor version of the operating system.</p>
</li>
<li>
<p>In the <strong>Description</strong> field, enter a description of the operating system.</p>
</li>
<li>
<p>From the <strong>Family</strong> list, select the operating system&#8217;s family.</p>
</li>
<li>
<p>From the <strong>Root Password Hash</strong> list, select the encoding method for the root password.</p>
</li>
<li>
<p>From the <strong>Architectures</strong> list, select the architectures that the operating system uses.</p>
</li>
<li>
<p>Click the <strong>Partition table</strong> tab and select the possible partition tables that apply to this operating system.</p>
</li>
<li>
<p>Optional: if you use non-Red&#160;Hat content, click the Installation Media tab and select the installation media that apply to this operating system.
For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.9/html-single/provisioning_guide/index#adding-installation-media_provisioning">Adding Installation Media to Satellite</a>.</p>
</li>
<li>
<p>Click the <strong>Templates</strong> tab and select a <strong>PXELinux template</strong>, a <strong>Provisioning template</strong>, and a <strong>Finish template</strong> for your operating system to use.
You can select other templates, for example an <strong>iPXE template</strong>, if you plan to use iPXE for provisioning.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your provisioning template.</p>
</li>
</ol>
</div>
<div id="cli-creating-operating-systems_provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create the operating system using the <code>hammer os create</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer os create --name "<em>MyOS</em>" \
--description "<em>My_custom_operating_system</em>" \
--major 7 --minor 3 --family "Redhat" --architectures "x86_64" \
--partition-tables "<em>My_Partition</em>" --media "<em>Red_Hat</em>" \
--provisioning-templates "<em>My_Provisioning_Template</em>"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="updating-the-details-of-multiple-operating-systems_provisioning">2.4. Updating the Details of Multiple Operating Systems</h3>
<div class="paragraph">
<p>Use this procedure to update the details of multiple operating systems.
This example shows you how to assign each operating system a partition table called <code>Kickstart default</code>, a configuration template called <code>Kickstart default PXELinux</code>, and a provisioning template called <code>Kickstart Default</code>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On Satellite&#160;Server, run the following Bash script:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-Bash" data-lang="Bash">PARTID=$(hammer --csv partition-table list | grep "Kickstart default," | cut -d, -f1)
PXEID=$(hammer --csv template list --per-page=1000 | grep "Kickstart default PXELinux" | cut -d, -f1)
SATID=$(hammer --csv template list --per-page=1000 | grep "provision" | grep ",Kickstart default" | cut -d, -f1)

for i in $(hammer --no-headers --csv os list | awk -F, {'print $1'})
do
   hammer partition-table add-operatingsystem --id="${PARTID}" --operatingsystem-id="${i}"
   hammer template add-operatingsystem --id="${PXEID}" --operatingsystem-id="${i}"
   hammer os set-default-template --id="${i}" --config-template-id=${PXEID}
   hammer os add-config-template --id="${i}" --config-template-id=${SATID}
   hammer os set-default-template --id="${i}" --config-template-id=${SATID}
done</code></pre>
</div>
</div>
</li>
<li>
<p>Display information about the updated operating system to verify that the operating system is updated correctly:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer os info --id <em>1</em></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="creating-architectures_provisioning">2.5. Creating Architectures</h3>
<div class="paragraph">
<p>An architecture in Satellite represents a logical grouping of hosts and operating systems.
Architectures are created by Satellite automatically when hosts check in with Puppet.
Basic i386 and x86_64 architectures are already preset in Satellite.</p>
</div>
<div class="paragraph">
<p>Use this procedure to create an architecture in Satellite.</p>
</div>
<div class="paragraph">
<div class="title">Supported Architectures</div>
<p>Only Intel x86_64 architecture is supported for provisioning using PXE, Discovery, and boot disk.
For more information, see the Red Hat Knowledgebase solution <a href="https://access.redhat.com/solutions/2674001">Supported architectures and provisioning scenarios in Satellite 6</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Hosts</strong> &gt; <strong>Architectures</strong> and click <strong>Create Architecture</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the architecture.</p>
</li>
<li>
<p>From the <strong>Operating Systems</strong> list, select an operating system.
If none are available, you can create and assign them under <strong>Hosts</strong> &gt; <strong>Operating Systems</strong>.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Enter the <code>hammer architecture create</code> command to create an architecture.
Specify its name and operating systems that include this architecture:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer architecture create --name "<em>Architecture_Name</em>" \
--operatingsystems "<em>os</em>"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="creating-hardware-models_provisioning">2.6. Creating Hardware Models</h3>
<div class="paragraph">
<p>Use this procedure to create a hardware model in Satellite so that you can specify which hardware model a host uses.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Hosts</strong> &gt; <strong>Hardware Models</strong> and click <strong>Create Model</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the hardware model.</p>
</li>
<li>
<p>Optionally, in the <strong>Hardware Model</strong> and <strong>Vendor Class</strong> fields, you can enter corresponding information for your system.</p>
</li>
<li>
<p>In the <strong>Info</strong> field, enter a description of the hardware model.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your hardware model.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create a hardware model using the <code>hammer model create</code> command.
The only required parameter is <code>--name</code>.
Optionally, enter the hardware model with the <code>--hardware-model</code> option, a vendor class with the <code>--vendor-class</code> option, and a description with the <code>--info</code> option:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer model create --name "<em>model_name</em>" --info "<em>description</em>" \
--hardware-model "<em>hardware_model</em>" --vendor-class "<em>vendor_class</em>"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="using-a-synced-kickstart-repository_provisioning">2.7. Using a Synced Kickstart Repository for a Host&#8217;s Operating System</h3>
<div class="paragraph">
<p>Satellite contains a set of synchronized kickstart repositories that you use to install the provisioned host&#8217;s operating system.
For more information about adding repositories, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.9/html-single/content_management_guide/index#Importing_Content-Synchronizing_Repositories">Syncing Repositories</a> in the <em>Content Management Guide</em>.</p>
</div>
<div class="paragraph">
<p>Use this procedure to set up a kickstart repository.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add the synchronized kickstart repository that you want to use to the existing Content View, or create a new Content View and add the kickstart repository.</p>
<div class="paragraph">
<p>For Red&#160;Hat Enterprise Linux 8, ensure that you add both <strong>Red&#160;Hat Enterprise Linux 8 for x86_64 - AppStream Kickstart x86_64 8</strong> and <strong>Red&#160;Hat Enterprise Linux 8 for x86_64 - BaseOS Kickstart x86_64 8</strong> repositories.</p>
</div>
<div class="paragraph">
<p>If you use a disconnected environment, you must import the Kickstart repositories from a Red&#160;Hat Enterprise Linux binary DVD.
For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.9/html-single/content_management_guide/index#importing-kickstart-repositories_content-management">Importing Kickstart Repositories</a> in the <em>Content Management Guide</em>.</p>
</div>
</li>
<li>
<p>Publish a new version of the Content View where the kickstart repository is added and promote it to a required lifecycle environment.
For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.9/html-single/content_management_guide/index#Managing_Content_Views">Managing Content Views</a> in the <em>Content Management Guide</em>.</p>
</li>
<li>
<p>When you create a host, in the <strong>Operating System</strong> tab, for <strong>Media Selection</strong>, select the <strong>Synced Content</strong> check box.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To view the kickstart tree, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># hammer medium list --organization "<em>your_organization</em>"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="adding-installation-media_provisioning">2.8. Adding Installation Media to Satellite</h3>
<div class="paragraph">
<p>Installation media are sources of packages that Satellite&#160;Server uses to install a base operating system on a machine from an external repository.
You can use this parameter to install third-party content.
Red Hat content is delivered through repository syncing instead.</p>
</div>
<div class="paragraph">
<p>Installation media must be in the format of an operating system installation tree, and must be accessible to the machine hosting the installer through an HTTP URL.
You can view installation media by navigating to <strong>Hosts</strong> &gt; <strong>Installation Media</strong> menu.</p>
</div>
<div class="paragraph">
<p>By default, Satellite includes installation media for some official Linux distributions.
Note that some of those installation media are targeted for a specific version of an operating system.
For example <strong>CentOS mirror (7.x)</strong> must be used for CentOS 7 or earlier, and <strong>CentOS mirror (8.x)</strong> must be used for CentOS 8 or later.</p>
</div>
<div class="paragraph">
<p>If you want to improve download performance when using installation media to install operating systems on multiple host, you must modify the installation medium&#8217;s <strong>Path</strong> to point to the closest mirror or a local copy.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the web UI, see the <a href="#cli-adding-installation-media_provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Hosts</strong> &gt; <strong>Installation Media</strong> and click <strong>Create Medium</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name to represent the installation media entry.</p>
</li>
<li>
<p>In the <strong>Path</strong> enter the URL or NFS share that contains the installation tree.
You can use following variables in the path to represent multiple different system architectures and versions:</p>
<div class="ulist">
<ul>
<li>
<p><code>$arch</code> - The system architecture.</p>
</li>
<li>
<p><code>$version</code> - The operating system version.</p>
</li>
<li>
<p><code>$major</code> - The operating system major version.</p>
</li>
<li>
<p><code>$minor</code> - The operating system minor version.</p>
<div class="paragraph">
<p>Example HTTP path:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://download.example.com/centos/$version/Server/$arch/os/</pre>
</div>
</div>
<div class="paragraph">
<p>Example NFS path:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>nfs://download.example.com:/centos/$version/Server/$arch/os/</pre>
</div>
</div>
<div class="paragraph">
<p>Synchronized content on Capsule&#160;Servers always uses an HTTP path.
Capsule&#160;Server managed content does not support NFS paths.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>From the <strong>Operating system family</strong> list, select the distribution or family of the installation medium.
For example, CentOS and Fedora are in the <code>Red Hat</code> family.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> and <strong>Locations</strong> tabs, to change the provisioning context.
Satellite&#160;Server adds the installation medium to the set provisioning context.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your installation medium.</p>
</li>
</ol>
</div>
<div id="cli-adding-installation-media_provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create the installation medium using the <code>hammer medium create</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer medium create --name "CustomOS" --os-family "Redhat" \
--path 'http://download.example.com/centos/$version/Server/$arch/os/' \
--organizations "<em>My_Organization</em>" --locations "<em>My_Location</em>"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="creating-partition-tables_provisioning">2.9. Creating Partition Tables</h3>
<div class="paragraph">
<p>A partition table is a type of template that defines the way Satellite&#160;Server configures the disks available on a new host.
A Partition table uses the same ERB syntax as provisioning templates.
Red&#160;Hat Satellite contains a set of default partition tables to use, including a <code>Kickstart default</code>.
You can also edit partition table entries to configure the preferred partitioning scheme, or create a partition table entry and add it to the operating system entry.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the web UI, see the <a href="#cli-creating-partition-tables_provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Hosts</strong> &gt; <strong>Partition Tables</strong> and click <strong>Create Partition Table</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the partition table.</p>
</li>
<li>
<p>Select the <strong>Default</strong> check box if you want to set the template to automatically associate with new organizations or locations.</p>
</li>
<li>
<p>Select the <strong>Snippet</strong> check box if you want to identify the template as a reusable snippet for other partition tables.</p>
</li>
<li>
<p>From the <strong>Operating System Family</strong> list, select the distribution or family of the partitioning layout.
For example, Red Hat Enterprise Linux, CentOS, and Fedora are in the Red Hat family.</p>
</li>
<li>
<p>In the <strong>Template editor</strong> field, enter the layout for the disk partition.
For example:</p>
<div class="listingblock">
<div class="content">
<pre>zerombr
clearpart --all --initlabel
autopart</pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the <strong>Template</strong> file browser to upload a template file.</p>
</div>
<div class="paragraph">
<p>The format of the layout must match that for the intended operating system.
For example, Red Hat Enterprise Linux 7.2 requires a layout that matches a kickstart file.</p>
</div>
</li>
<li>
<p>In the <strong>Audit Comment</strong> field, add a summary of changes to the partition layout.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> and <strong>Locations</strong> tabs to add any other provisioning contexts that you want to associate with the partition table.
Satellite adds the partition table to the current provisioning context.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your partition table.</p>
</li>
</ol>
</div>
<div id="cli-creating-partition-tables_provisioning" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Before you create a partition table with the CLI, create a plain text file that contains the partition layout.
This example uses the <code>~/my-partition</code> file.</p>
</li>
<li>
<p>Create the installation medium using the <code>hammer partition-table create</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer partition-table create --name "My Partition" --snippet false \
--os-family Redhat --file ~/my-partition --organizations "<em>My_Organization</em>" \
--locations "<em>My_Location</em>"</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="dynamic-partition-example_provisioning">2.10. Dynamic Partition Example</h3>
<div class="paragraph">
<p>Using an Anaconda kickstart template, the following section instructs Anaconda to erase the whole disk, automatically partition, enlarge one partition to maximum size, and then proceed to the next sequence of events in the provisioning process:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>zerombr
clearpart --all --initlabel
autopart &lt;%= host_param('autopart_options') %&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Dynamic partitioning is executed by the installation program.
Therefore, you can write your own rules to specify how you want to partition disks according to runtime information from the node, for example, disk sizes, number of drives, vendor, or manufacturer.</p>
</div>
<div class="paragraph">
<p>If you want to provision servers and use dynamic partitioning, add the following example as a template.
When the <code>#Dynamic</code> entry is included, the content of the template loads into a <code>%pre</code> shell scriplet and creates a <code>/tmp/diskpart.cfg</code> that is then included into the Kickstart partitioning section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>#Dynamic (do not remove this line)

MEMORY=$((`grep MemTotal: /proc/meminfo | sed 's/^MemTotal: *//'|sed 's/ .*//'` / 1024))
if [ "$MEMORY" -lt 2048 ]; then
    SWAP_MEMORY=$(($MEMORY * 2))
elif [ "$MEMORY" -lt 8192 ]; then
    SWAP_MEMORY=$MEMORY
elif [ "$MEMORY" -lt 65536 ]; then
    SWAP_MEMORY=$(($MEMORY / 2))
else
    SWAP_MEMORY=32768
fi

cat &lt;&lt;EOF &gt; /tmp/diskpart.cfg
zerombr yes
clearpart --all --initlabel
part /boot --fstype ext4 --size 200 --asprimary
part swap --size "$SWAP_MEMORY"
part / --fstype ext4 --size 1024 --grow
EOF</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="provisioning-templates_provisioning">2.11. Provisioning Templates</h3>
<div class="paragraph">
<p>A provisioning template defines the way Satellite&#160;Server installs an operating system on a host.</p>
</div>
<div class="paragraph">
<p>Red&#160;Hat Satellite includes many template examples.
In the Satellite web UI, navigate to <strong>Hosts</strong> &gt; <strong>Provisioning templates</strong> to view them.
You can create a template or clone a template and edit the clone.
For help with templates, navigate to <strong>Hosts</strong> &gt; <strong>Provisioning templates</strong> &gt; <strong>Create Template</strong> &gt; <strong>Help</strong>.</p>
</div>
<div class="paragraph">
<p>Templates accept the Embedded Ruby (ERB) syntax.
For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.9/html-single/managing_hosts/index#appe-Red_Hat_Satellite-Managing_Hosts-Template_Writing_Reference">Template Writing Reference</a> in <em>Managing Hosts</em>.</p>
</div>
<div class="paragraph">
<p>You can download provisioning templates.
Before you can download the template, you must create a debug certificate.
For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.9/html-single/content_management_guide/index#Managing_Organizations-Creating_an_Organization_Debug_Certificate">Creating an Organization Debug Certificate</a> in the <em>Content Management Guide</em>.</p>
</div>
<div class="paragraph">
<p>You can synchronize templates between Satellite&#160;Server and a Git repository or a local directory.
For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.9/html-single/managing_hosts/index#Synchronizing_Templates_Repositories">Synchronizing Templates Repositories</a> in the <em>Managing Hosts</em> guide.</p>
</div>
<div class="paragraph">
<p>To view the history of changes applied to a template, navigate to <strong>Hosts</strong> &gt; <strong>Provisioning templates</strong>, select one of the templates, and click <strong>History</strong>.
Click <strong>Revert</strong> to override the content with the previous version.
You can also revert to an earlier change.
Click <strong>Show Diff</strong> to see information about a specific change:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <strong>Template Diff</strong> tab displays changes in the body of a provisioning template.</p>
</li>
<li>
<p>The <strong>Details</strong> tab displays changes in the template description.</p>
</li>
<li>
<p>The <strong>History</strong> tab displays the user who made a change to the template and date of the change.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="types-of-provisioning-templates_provisioning">2.12. Types of Provisioning Templates</h3>
<div class="paragraph">
<p>There are various types of provisioning templates:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Provision</dt>
<dd>
<p>The main template for the provisioning process.
For example, a kickstart template.
For more information about kickstart template syntax, see the <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/installation_guide/sect-kickstart-syntax">Kickstart Syntax Reference</a> in the <em>Red Hat Enterprise Linux 7 Installation Guide</em>.</p>
</dd>
<dt class="hdlist1">PXELinux, PXEGrub, PXEGrub2</dt>
<dd>
<p>PXE-based templates that deploy to the template Capsule associated with a subnet to ensure that the host uses the installer with the correct kernel options.
For BIOS provisioning, select <strong>PXELinux</strong> template.
For UEFI provisioning, select <strong>PXEGrub2</strong>.</p>
</dd>
<dt class="hdlist1">Finish</dt>
<dd>
<p>Post-configuration scripts to execute using an SSH connection when the main provisioning process completes.
You can use Finishing templates only for imaged-based provisioning in virtual or cloud environments that do not support user_data.
Do not confuse an image with a foreman discovery ISO, which is sometimes called a Foreman discovery image.
An image in this context is an install image in a virtualized environment for easy deployment.</p>
<div class="paragraph">
<p>When a finish script successfully exits with the return code <code>0</code>, Red&#160;Hat Satellite treats the code as a success and the host exits the build mode.
Note that there are a few finish scripts with a build mode that uses a <em>call back</em> HTTP call.
These scripts are not used for image-based provisioning, but for post configuration of operating-system installations such as Debian, Ubuntu, and BSD.</p>
</div>
</dd>
<dt class="hdlist1">user_data</dt>
<dd>
<p>Post-configuration scripts for providers that accept custom data, also known as seed data.
You can use the user_data template to provision virtual machines in cloud or virtualised environments only.
This template does not require Satellite to be able to reach the host; the cloud or virtualization platform is responsible for delivering the data to the image.</p>
<div class="paragraph">
<p>Ensure that the image that you want to provision has the software to read the data installed and set to start during boot.
For example, <code>cloud-init</code>, which expects YAML input, or <code>ignition</code>, which expects JSON input.</p>
</div>
</dd>
<dt class="hdlist1">cloud_init</dt>
<dd>
<p>Some environments, such as VMWare, either do not support custom data or have their own data format that limits what can be done during customization.
In this case, you can configure a cloud-init client with the <code>foreman</code> plug-in, which attempts to download the template directly from Satellite over HTTP or HTTPS.
This technique can be used in any environment, preferably virtualized.</p>
<div class="paragraph">
<p>Ensure that you meet the following requirements to use the <code>cloud_init</code> template:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ensure that the image that you want to provision has the software to read the data installed and set to start during boot.</p>
</li>
<li>
<p>A provisioned host is able to reach Satellite from the IP address that matches the host&#8217;s provisioning interface IP.</p>
<div class="paragraph">
<p>Note that cloud-init does not work behind NAT.</p>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Bootdisk</dt>
<dd>
<p>Templates for PXE-less boot methods.</p>
</dd>
<dt class="hdlist1">Kernel Execution (kexec)</dt>
<dd>
<p>Kernel execution templates for PXE-less boot methods.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Kernel Execution is a Technology Preview feature.
Technology Preview features are not fully supported under Red Hat Subscription Service Level Agreements (SLAs), may not be functionally complete, and are not intended for production use.
However, these features provide early access to upcoming product innovations, enabling customers to test functionality and provide feedback during the development process.</p>
</div>
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1">Script</dt>
<dd>
<p>An arbitrary script not used by default but useful for custom tasks.</p>
</dd>
<dt class="hdlist1">ZTP</dt>
<dd>
<p>Zero Touch Provisioning templates.</p>
</dd>
<dt class="hdlist1">POAP</dt>
<dd>
<p>PowerOn Auto Provisioning templates.</p>
</dd>
<dt class="hdlist1">iPXE</dt>
<dd>
<p>Templates for <code>iPXE</code> or <code>gPXE</code> environments to use instead of PXELinux.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="creating-provisioning-templates_provisioning">2.13. Creating Provisioning Templates</h3>
<div class="paragraph">
<p>A provisioning template defines the way Satellite&#160;Server installs an operating system on a host.
Use this procedure to create a new provisioning template.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Hosts</strong> &gt; <strong>Provisioning Templates</strong> and click <strong>Create Template</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the provisioning template.</p>
</li>
<li>
<p>Fill in the rest of the fields as required.
The <strong>Help</strong> tab provides information about the template syntax and details the available functions, variables, and methods that can be called on different types of objects within the template.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Before you create a template with the CLI, create a plain text file that contains the template.
This example uses the <code>~/my-template</code> file.</p>
</li>
<li>
<p>Create the template using the <code>hammer template create</code> command and specify the type with the <code>--type</code> option:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer template create --name "My Provisioning Template" \
--file ~/my-template --type provision --organizations "<em>My_Organization</em>" \
--locations "<em>My_Location</em>"</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="cloning-provisioning-templates_provisioning">2.14. Cloning Provisioning Templates</h3>
<div class="paragraph">
<p>A provisioning template defines the way Satellite&#160;Server installs an operating system on a host.
Use this procedure to clone a template and add your updates to the clone.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Hosts</strong> &gt; <strong>Provisioning Templates</strong> and search for the template that you want to use.</p>
</li>
<li>
<p>Click <strong>Clone</strong> to duplicate the template.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the provisioning template.</p>
</li>
<li>
<p>Select the <strong>Default</strong> check box to set the template to associate automatically with new organizations or locations.</p>
</li>
<li>
<p>In the <strong>Template editor</strong> field, enter the body of the provisioning template.
You can also use the <strong>Template</strong> file browser to upload a template file.</p>
</li>
<li>
<p>In the <strong>Audit Comment</strong> field, enter a summary of changes to the provisioning template for auditing purposes.</p>
</li>
<li>
<p>Click the <strong>Type</strong> tab and if your template is a snippet, select the <strong>Snippet</strong> check box.
A snippet is not a standalone provisioning template, but a part of a provisioning template that can be inserted into other provisioning templates.</p>
</li>
<li>
<p>From the <strong>Type</strong> list, select the type of the template.
For example, <strong>Provisioning template</strong>.</p>
</li>
<li>
<p>Click the <strong>Association</strong> tab and from the <strong>Applicable Operating Systems</strong> list, select the names of the operating systems that you want to associate with the provisioning template.</p>
</li>
<li>
<p>Optionally, click <strong>Add combination</strong> and select a host group from the <strong>Host Group</strong> list or an environment from the <strong>Environment</strong> list to associate provisioning template with the host groups and environments.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> and <strong>Locations</strong> tabs to add any additional contexts to the template.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your provisioning template.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="creating-compute-profiles_provisioning">2.15. Creating Compute Profiles</h3>
<div class="paragraph">
<p>You can use compute profiles to predefine virtual machine hardware details such as CPUs, memory, and storage.
A default installation of Red&#160;Hat Satellite contains three predefined profiles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>1-Small</code></p>
</li>
<li>
<p><code>2-Medium</code></p>
</li>
<li>
<p><code>3-Large</code></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Profiles</strong> and click <strong>Create Compute Profile</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the profile.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.
A new window opens with the name of the compute profile.</p>
</li>
<li>
<p>In the new window, click the name of each compute resource and edit the attributes you want to set for this compute profile.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">CLI procedure</div>
<p>The compute profile CLI commands are not yet implemented in Red&#160;Hat Satellite 6.10.</p>
</div>
</div>
<div class="sect2">
<h3 id="setting-a-default-encrypted-root-password_provisioning">2.16. Setting a Default Encrypted Root Password for Hosts</h3>
<div class="paragraph">
<p>If you do not want to set a plain text default root password for the hosts that you provision, you can use a default encrypted password.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Generate an encrypted password:</p>
<div class="listingblock">
<div class="content">
<pre># python -c 'import crypt,getpass;pw=getpass.getpass(); print(crypt.crypt(pw)) if (pw==getpass.getpass("Confirm: ")) else exit()'</pre>
</div>
</div>
</li>
<li>
<p>Copy the password for later use.</p>
</li>
<li>
<p>In the Satellite web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>.</p>
</li>
<li>
<p>On the <strong>Settings</strong> page, select the <strong>Provisioning</strong> tab.</p>
</li>
<li>
<p>In the <strong>Name</strong> column, navigate to <strong>Root password</strong>, and click <strong>Click to edit</strong>.</p>
</li>
<li>
<p>Paste the encrypted password, and click <strong>Save</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="using-novnc-to-access-virtual-machines_provisioning">2.17. Using noVNC to Access Virtual Machines</h3>
<div class="paragraph">
<p>You can use your browser to access the VNC console of VMs created by Satellite.</p>
</div>
<div class="paragraph">
<p>Satellite supports using noVNC on the following virtualization platforms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>VMware</p>
</li>
<li>
<p>Libvirt</p>
</li>
<li>
<p>Red&#160;Hat&#160;Virtualization</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must have a virtual machine created by Satellite.</p>
</li>
<li>
<p>For existing virtual machines, ensure that the <strong>Display type</strong> in the <strong>Compute Resource</strong> settings is <strong>VNC</strong>.</p>
</li>
<li>
<p>You must import the Katello root CA certificate into your Satellite&#160;Server.
Adding a security exception in the browser is not enough for using noVNC.
For more information, see the <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.9/html-single/administering_red_hat_satellite/index#sect-Administering-Installing_the_Katello_Root_CA_Certificate">Installing the Katello Root CA Certificate</a> section in the <em>Administering Red&#160;Hat Satellite</em> guide.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On the VM host system, configure the firewall to allow VNC service on ports 5900 to 5930:</p>
<div class="ulist">
<ul>
<li>
<p>On Red Hat Enterprise Linux 6:</p>
<div class="listingblock">
<div class="content">
<pre># iptables -A INPUT -p tcp --dport 5900:5930 -j ACCEPT
# service iptables save</pre>
</div>
</div>
</li>
<li>
<p>On Red Hat Enterprise Linux 7:</p>
<div class="listingblock">
<div class="content">
<pre># firewall-cmd --add-port=5900-5930/tcp
# firewall-cmd --add-port=5900-5930/tcp --permanent</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong> and select the name of a compute resource.</p>
</li>
<li>
<p>In the <strong>Virtual Machines</strong> tab, select the name of a VM host.
Ensure the machine is powered on and then select <strong>Console</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Configuring_Networking">3. Configuring Networking</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Each provisioning type requires some network configuration.
Use this chapter to configure network services in your integrated Capsule on Satellite&#160;Server.</p>
</div>
<div class="paragraph">
<p>New hosts must have access to your Capsule&#160;Server.
Capsule&#160;Server can be either your integrated Capsule on Satellite&#160;Server or an external Capsule&#160;Server.
You might want to provision hosts from an external Capsule&#160;Server when the hosts are on isolated networks and cannot connect to Satellite&#160;Server directly, or when the content is synchronized with Capsule&#160;Server.
Provisioning using the external Capsule&#160;Server can save on network bandwidth.</p>
</div>
<div class="paragraph">
<p>Configuring Capsule&#160;Server has two basic requirements:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configuring network services.
This includes:</p>
<div class="ulist">
<ul>
<li>
<p>Content delivery services</p>
</li>
<li>
<p>Network services (DHCP, DNS, and TFTP)</p>
</li>
<li>
<p>Puppet configuration</p>
</li>
</ul>
</div>
</li>
<li>
<p>Defining network resource data in Satellite&#160;Server to help configure network interfaces on new hosts.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following instructions have similar applications to configuring standalone Capsules managing a specific network.
To configure Satellite to use external DHCP, DNS, and TFTP services, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.9/html-single/installing_satellite_server_from_a_connected_network/index#configuring-external-services">Configuring External Services</a> in <em>Installing Satellite Server from a Connected Network</em>.</p>
</div>
<div class="sect2">
<h3 id="networking_resources">3.1. Network Resources</h3>
<div class="paragraph">
<p>Satellite contains networking resources that you must set up and configure to create a host.
Satellite includes the following networking resources:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Domain</dt>
<dd>
<p>You must assign every host that is managed by Satellite to a domain.
Using the domain, Satellite can manage A, AAAA, and PTR records.
Even if you do not want Satellite to manage your DNS servers, you still must create and associate at least one domain.
Domains are included in the naming conventions Satellite hosts, for example, a host with the name <code>test123</code> in the <code>example.com</code> domain has the fully qualified domain name <code>test123.example.com</code>.</p>
</dd>
<dt class="hdlist1">Subnet</dt>
<dd>
<p>You must assign every host managed by Satellite to a subnet.
Using subnets, Satellite can then manage IPv4 reservations.
If there are no reservation integrations, you still must create and associate at least one subnet.
When you manage a subnet in Satellite, you cannot create DHCP records for that subnet outside of Satellite.
In Satellite, you can use IP Address Management (IPAM) to manage IP addresses with one of the following options:</p>
<div class="ulist">
<ul>
<li>
<p><strong>DHCP</strong>: DHCP Capsule manages the assignment of IP addresses by finding the next available IP address starting from the first address of the range and skipping all addresses that are reserved.
Before assigning an IP address, Capsule sends an ICMP and TCP pings to check whether the IP address is in use.
Note that if a host is powered off, or has a firewall configured to disable connections, Satellite makes a false assumption that the IP address is available.
This check does not work for hosts that are turned off, therefore, the <strong>DHCP</strong> option can only be used with subnets that Satellite controls and that do not have any hosts created externally.</p>
<div class="paragraph">
<p>The Capsule DHCP module retains the offered IP addresses for a short period of time to prevent collisions during concurrent access, so some IP addresses in the IP range might remain temporarily unused.</p>
</div>
</li>
<li>
<p><strong>Internal DB</strong>: Satellite finds the next available IP address from the Subnet range by excluding all IP addresses from the Satellite database in sequence.
The primary source of data is the database, not DHCP reservations.
This IPAM is not safe when multiple hosts are being created in parallel; in that case, use <strong>DHCP</strong> or <strong>Random DB</strong> IPAM instead.</p>
</li>
<li>
<p><strong>Random DB</strong>: Satellite finds the next available IP address from the Subnet range by excluding all IP addresses from the Satellite database randomly.
The primary source of data is the database, not DHCP reservations.
This IPAM is safe to use with concurrent host creation as IP addresses are returned in random order, minimizing the chance of a conflict.</p>
</li>
<li>
<p><strong>EUI-64</strong>: Extended Unique Identifier (EUI) 64bit IPv6 address generation, as per RFC2373, is obtained through the 48-bit MAC address.</p>
</li>
<li>
<p><strong>External IPAM</strong>: Delegates IPAM to an external system through Capsule feature.
Satellite currently does not ship with any external IPAM implementations, but several plug-ins are in development.</p>
</li>
<li>
<p><strong>None</strong>: IP address for each host must be entered manually.</p>
<div class="paragraph">
<p>Options DHCP, Internal DB and Random DB can lead to DHCP conflicts on subnets with records created externally.
These subnets must be under exclusive Satellite control.</p>
</div>
<div class="paragraph">
<p>For more information about adding a subnet, see <a href="#Configuring_Networking-Adding_a_Subnet_to_the_Satellite_Server">Adding a Subnet to Satellite&#160;Server</a>.</p>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">DHCP Ranges</dt>
<dd>
<p>You can define the same DHCP range in Satellite&#160;Server for both discovered and provisioned systems, but use a separate range for each service within the same subnet.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_satellite_and_dhcp_options">3.2. Satellite and DHCP Options</h3>
<div class="paragraph">
<p>Satellite manages DHCP reservations through a DHCP Capsule.
Satellite also sets the <code>next-server</code> and <code>filename</code> DHCP options.</p>
</div>
<div class="paragraph">
<div class="title">The next-server option</div>
<p>The <code>next-server</code> option provides the IP address of the TFTP server to boot from.
This option is not set by default and must be set for each TFTP Capsule.
You can use the <code>satellite-installer</code> command with the <code>--foreman-proxy-tftp-servername</code> option to set the TFTP server in the <code>/etc/foreman-proxy/settings.d/tftp.yml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># satellite-installer --foreman-proxy-tftp-servername <em>1.2.3.4</em></pre>
</div>
</div>
<div class="paragraph">
<p>Each TFTP Capsule then reports this setting through the API and Satellite can retrieve the configuration information when it creates the DHCP record.</p>
</div>
<div class="paragraph">
<p>When the PXE loader is set to <code>none</code>, Satellite does not populate the <code>next-server</code> option into the DHCP record.</p>
</div>
<div class="paragraph">
<p>If the <code>next-server</code> option remains undefined, Satellite uses reverse DNS search to find a TFTP server address to assign, but you might encounter the following problems:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DNS timeouts during provisioning</p>
</li>
<li>
<p>Querying of incorrect DNS server.
For example, authoritative rather than caching</p>
</li>
<li>
<p>Errors about incorrect IP address for the TFTP server.
For example, <code>PTR record was invalid</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you encounter these problems, check the DNS setup on both Satellite and Capsule, specifically the PTR record resolution.</p>
</div>
<div class="paragraph">
<div class="title">The filename option</div>
<p>The <code>filename</code> option contains the full path to the file that downloads and executes during provisioning.
The PXE loader that you select for the host or host group defines which <code>filename</code> option to use.
When the PXE loader is set to <code>none</code>, Satellite does not populate the <code>filename</code> option into the DHCP record.
Depending on the PXE loader option, the <code>filename</code> changes as follows:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">PXE loader option</th>
<th class="tableblock halign-left valign-top">filename entry</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PXELinux BIOS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pxelinux.0</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PXELinux UEFI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pxelinux.efi</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">iPXE Chain BIOS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>undionly.kpxe</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PXEGrub2 UEFI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grub2/grubx64.efi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x64 can differ depending on architecture</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">iPXE UEFI HTTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\http://<em>capsule.example.com</em>:8000/httpboot/ipxe-x64.efi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Requires the <code>httpboot</code> feature and renders the <code>filename</code> as a full URL where <em>capsule.example.com</em> is a known host name of Capsule in Satellite.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Grub2 UEFI HTTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\http://<em>capsule.example.com</em>:8000/httpboot/grub2/grubx64.efi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Requires the <code>httpboot</code> feature and renders the <code>filename</code> as a full URL where <em>capsule.example.com</em> is a known host name of Capsule in Satellite.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_troubleshooting_dhcp_problems_in_satellite">3.3. Troubleshooting DHCP Problems in Satellite</h3>
<div class="paragraph">
<p>Satellite can manage an ISC DHCP server on internal or external DHCP Capsule.
Satellite can list, create, and delete DHCP reservations and leases.
However, there are a number of problems that you might encounter on occasions.</p>
</div>
<div class="paragraph">
<div class="title">Out of sync DHCP records</div>
<p>When an error occurs during DHCP orchestration, DHCP records in the Satellite database and the DHCP server might not match.
To fix this, you must add missing DHCP records from the Satellite database to the DHCP server and then remove unwanted records from the DHCP server as per the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To preview the DHCP records that are going to be added to the DHCP server, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-rake orchestration:dhcp:add_missing subnet_name=NAME</pre>
</div>
</div>
</li>
<li>
<p>If you are satisfied by the preview changes in the previous step, apply them by entering the above command with the <code>perform=1</code> argument:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-rake orchestration:dhcp:add_missing subnet_name=NAME perform=1</pre>
</div>
</div>
</li>
<li>
<p>To keep DHCP records in Satellite and in the DHCP server synchronized, you can remove unwanted DHCP records from the DHCP server.
Note that Satellite assumes that all managed DHCP servers do not contain third-party records, therefore, this step might delete those unexpected records.
To preview what records are going to be removed from the DHCP server, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-rake orchestration:dhcp:remove_offending subnet_name=NAME</pre>
</div>
</div>
</li>
<li>
<p>If you are satisfied by the preview changes in the previous step, apply them by entering the above command with the <code>perform=1</code> argument:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-rake orchestration:dhcp:remove_offending subnet_name=NAME perform=1</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">PXE loader option change</div>
<p>When the PXE loader option is changed for an existing host, this causes a DHCP conflict.
The only workaround is to overwrite the DHCP entry.</p>
</div>
<div class="paragraph">
<div class="title">Incorrect permissions on DHCP files</div>
<p>An operating system update can update the <code>dhcpd</code> package.
This causes the permissions of important directories and files to reset so that the DHCP Capsule cannot read the required information.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://access.redhat.com/solutions/2952061">DHCP error while provisioning host from Satellite server Error ERF12-6899 ProxyAPI::ProxyException: Unable to set DHCP entry RestClient::ResourceNotFound 404 Resource Not Found</a> on Red&#160;Hat Knowledgebase.</p>
</div>
<div class="paragraph">
<div class="title">Changing the DHCP Capsule entry</div>
<p>Satellite manages DHCP records only for hosts that are assigned to subnets with a DHCP Capsule set.
If you create a host and then clear or change the DHCP Capsule, when you attempt to delete the host, the action fails.</p>
</div>
<div class="paragraph">
<p>If you create a host without setting the DHCP Capsule and then try to set the DHCP Capsule, this causes DHCP conflicts.</p>
</div>
<div class="paragraph">
<div class="title">Deleted hosts entries in the dhcpd.leases file</div>
<p>Any changes to a DHCP lease are appended to the end of the <code>dhcpd.leases</code> file.
Because entries are appended to the file, it is possible that two or more entries of the same lease can exist in the <code>dhcpd.leases</code> file at the same time.
When there are two or more entries of the same lease, the last entry in the file takes precedence.
Group, subgroup and host declarations in the lease file are processed in the same manner.
If a lease is deleted, <code>{ deleted; }</code> is appended to the declaration.</p>
</div>
</div>
<div class="sect2">
<h3 id="_prerequisites_for_image_based_provisioning">3.4. Prerequisites for Image Based Provisioning</h3>
<div class="paragraph">
<div class="title">Post-Boot Configuration Method</div>
<p>Images that use the <code>finish</code> post-boot configuration scripts require a managed DHCP server, such as Satellite&#8217;s integrated Capsule or an external Capsule.
The host must be created with a subnet associated with a DHCP Capsule, and the IP address of the host must be a valid IP address from the DHCP range.</p>
</div>
<div class="paragraph">
<p>It is possible to use an external DHCP service, but IP addresses must be entered manually.
The SSH credentials corresponding to the configuration in the image must be configured in Satellite to enable the post-boot configuration to be made.</p>
</div>
<div class="paragraph">
<p>Check the following items when troubleshooting a virtual machine booted from an image that depends on post-configuration scripts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The host has a subnet assigned in Satellite&#160;Server.</p>
</li>
<li>
<p>The subnet has a DHCP Capsule assigned in Satellite&#160;Server.</p>
</li>
<li>
<p>The host has a valid IP address assigned in Satellite&#160;Server.</p>
</li>
<li>
<p>The IP address acquired by the virtual machine using DHCP matches the address configured in Satellite&#160;Server.</p>
</li>
<li>
<p>The virtual machine created from an image responds to SSH requests.</p>
</li>
<li>
<p>The virtual machine created from an image authorizes the user and password, over SSH, which is associated with the image being deployed.</p>
</li>
<li>
<p>Satellite&#160;Server has access to the virtual machine via SSH keys.
This is required for the virtual machine to receive post-configuration scripts from Satellite&#160;Server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Pre-Boot Initialization Configuration Method</div>
<p>Images that use the <code>cloud-init</code> scripts require a DHCP server to avoid having to include the IP address in the image.
A managed DHCP Capsule is preferred.
The image must have the <code>cloud-init</code> service configured to start when the system boots and fetch a script or configuration data to use in completing the configuration.</p>
</div>
<div class="paragraph">
<p>Check the following items when troubleshooting a virtual machine booted from an image that depends on initialization scripts included in the image:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There is a DHCP server on the subnet.</p>
</li>
<li>
<p>The virtual machine has the <code>cloud-init</code> service installed and enabled.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For information about the differing levels of support for <code>finish</code> and <code>cloud-init</code> scripts in virtual-machine images, see the Red Hat Knowledgebase Solution <a href="https://access.redhat.com/solutions/2987171">What are the supported compute resources for the finish and cloud-init scripts</a> on the Red Hat Customer Portal.</p>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_Networking-Configuring_Network_Services_for_PXE_Boot">3.5. Configuring Network Services</h3>
<div class="paragraph">
<p>Some provisioning methods use Capsule&#160;Server services.
For example, a network might require Capsule&#160;Server to act as a DHCP server.
A network can also use PXE boot services to install the operating system on new hosts.
This requires configuring Capsule&#160;Server to use the main PXE boot services: DHCP, DNS, and TFTP.</p>
</div>
<div class="paragraph">
<p>Use the <code>satellite-installer</code> command with the options to configure these services on Satellite&#160;Server.</p>
</div>
<div class="paragraph">
<p>To configure these services on an external Capsule&#160;Server, run <code>satellite-installer --scenario capsule</code>.</p>
</div>
<div class="paragraph">
<p>Satellite&#160;Server uses <code>eth0</code> for external communication, such as connecting to Red Hat&#8217;s CDN.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To configure network services on Satellite&#8217;s integrated Capsule, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enter the <code>satellite-installer</code> command to configure the required network services:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># satellite-installer --foreman-proxy-dhcp true \
--foreman-proxy-dhcp-managed true \
--foreman-proxy-dhcp-gateway "<em>192.168.140.1</em>" \
--foreman-proxy-dhcp-interface "eth1" \
--foreman-proxy-dhcp-nameservers "<em>192.168.140.2</em>" \
--foreman-proxy-dhcp-range "<em>192.168.140.10</em> <em>192.168.140.110</em>" \
--foreman-proxy-dhcp-server "<em>192.168.140.2</em>" \
--foreman-proxy-dns true \
--foreman-proxy-dns-managed true \
--foreman-proxy-dns-forwarders "<em>8.8.8.8</em>; <em>8.8.4.4</em>" \
--foreman-proxy-dns-interface "eth1" \
--foreman-proxy-dns-reverse "<em>140.168.192.in-addr.arpa</em>" \
--foreman-proxy-dns-server "<em>127.0.0.1</em>" \
--foreman-proxy-dns-zone "<em>example.com</em>" \
--foreman-proxy-tftp true \
--foreman-proxy-tftp-managed true</pre>
</div>
</div>
</li>
<li>
<p>Find Capsule&#160;Server that you configure:</p>
<div class="listingblock">
<div class="content">
<pre># hammer proxy list</pre>
</div>
</div>
</li>
<li>
<p>Refresh features of Capsule&#160;Server to view the changes:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer proxy refresh-features --name "<em>satellite.example.com</em>"</pre>
</div>
</div>
</li>
<li>
<p>Verify the services configured on Capsule&#160;Server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer proxy info --name "<em>satellite.example.com</em>"</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="Configuring_Networking-Multiple_Subnets_or_Domains_via_Installer">3.5.1. Multiple Subnets or Domains via Installer</h4>
<div class="paragraph">
<p>The satellite-installer options allow only for a single DHCP subnet or DNS domain.
One way to define more than one subnet is by using a custom configuration file.</p>
</div>
<div class="paragraph">
<p>For every additional subnet or domain, create an entry in <code>/etc/foreman-installer/custom-hiera.yaml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>dhcp::pools:
 isolated.lan:
   network: 192.168.99.0
   mask: 255.255.255.0
   gateway: 192.168.99.1
   range: 192.168.99.5 192.168.99.49

dns::zones:
  # creates @ SOA $::fqdn root.example.com.
  # creates $::fqdn A $::ipaddress
  example.com: {}

  # creates @ SOA test.example.net. hostmaster.example.com.
  # creates test.example.net A 192.0.2.100
  example.net:
    soa: test.example.net
    soaip: 192.0.2.100
    contact: hostmaster.example.com.

  # creates @ SOA $::fqdn root.example.org.
  # does NOT create an A record
  example.org:
    reverse: true

  # creates @ SOA $::fqdn hostmaster.example.com.
  2.0.192.in-addr.arpa:
    reverse: true
    contact: hostmaster.example.com.</pre>
</div>
</div>
<div class="paragraph">
<p>Execute satellite-installer to perform the changes and verify that the <code>/etc/dhcp/dhcpd.conf</code> contains appropriate entries.
Subnets must be then defined in Satellite database.</p>
</div>
</div>
<div class="sect3">
<h4 id="_dhcp_dns_and_tftp_options_for_network_configuration">3.5.2. DHCP, DNS, and TFTP Options for Network Configuration</h4>
<div class="dlist">
<div class="title">DHCP Options</div>
<dl>
<dt class="hdlist1">--foreman-proxy-dhcp</dt>
<dd>
<p>  Enables the DHCP service.
You can set this option to <code>true</code> or <code>false</code>.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dhcp-managed</dt>
<dd>
<p>  Enables Foreman to manage the DHCP service.
You can set this option to <code>true</code> or <code>false</code>.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dhcp-gateway</dt>
<dd>
<p>  The DHCP pool gateway.
Set this to the address of the external gateway for hosts on your private network.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dhcp-interface</dt>
<dd>
<p>  Sets the interface for the DHCP service to listen for requests.
Set this to <code>eth1</code>.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dhcp-nameservers</dt>
<dd>
<p>  Sets the addresses of the nameservers provided to clients through DHCP.
Set this to the address for Satellite&#160;Server on <code>eth1</code>.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dhcp-range</dt>
<dd>
<p>A space-separated DHCP pool range for Discovered and Unmanaged services.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dhcp-server</dt>
<dd>
<p>Sets the address of the DHCP server to manage.</p>
</dd>
</dl>
</div>
<div class="dlist">
<div class="title">DNS Options</div>
<dl>
<dt class="hdlist1">--foreman-proxy-dns</dt>
<dd>
<p>  Enables DNS service.
You can set this option to <code>true</code> or <code>false</code>.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dns-managed</dt>
<dd>
<p>  Enables Foreman to manage the DNS service.
You can set this option to <code>true</code> or <code>false</code>.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dns-forwarders</dt>
<dd>
<p>  Sets the DNS forwarders.
Set this to your DNS servers.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dns-interface</dt>
<dd>
<p>  Sets the interface to listen for DNS requests.
Set this to <code>eth1</code>.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dns-reverse</dt>
<dd>
<p>The DNS reverse zone name.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dns-server</dt>
<dd>
<p>Sets the address of the DNS server to manage.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dns-zone</dt>
<dd>
<p>Sets the DNS zone name.</p>
</dd>
</dl>
</div>
<div class="dlist">
<div class="title">TFTP Options</div>
<dl>
<dt class="hdlist1">--foreman-proxy-tftp</dt>
<dd>
<p>  Enables TFTP service.
You can set this option to <code>true</code> or <code>false</code>.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-tftp-managed</dt>
<dd>
<p>  Enables Foreman to manage the TFTP service.
You can set this option to <code>true</code> or <code>false</code>.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-tftp-servername</dt>
<dd>
<p>  Sets the TFTP server to use.
Ensure that you use Capsule&#8217;s IP address.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Run <code>satellite-installer --help</code> to view more options related to DHCP, DNS, TFTP, and other Satellite Capsule services</p>
</div>
</div>
<div class="sect3">
<h4 id="Configuring_Networking-Using_TFTP_Services_through_NAT">3.5.3. Using TFTP Services through NAT</h4>
<div class="paragraph">
<p>You can use Satellite TFTP services through NAT.
To do this, on all NAT routers or firewalls, you must enable a TFTP service on UDP port 69 and enable the TFTP state tracking feature.
For more information, see the documentation for your NAT device.</p>
</div>
<div class="paragraph">
<div class="title">Using NAT on Red Hat Enterprise Linux 7:</div>
<p>Use the following command to allow TFTP service on UDP port 69, load the kernel TFTP state tracking module, and make the changes persistent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># firewall-cmd --add-service=tftp &amp;&amp; firewall-cmd --runtime-to-permanent</pre>
</div>
</div>
<div class="olist arabic">
<div class="title">For a NAT running on Red Hat Enterprise Linux 6:</div>
<ol class="arabic">
<li>
<p>Configure the firewall to allow TFTP service UDP on port 69.</p>
<div class="listingblock">
<div class="content">
<pre># iptables -A OUTPUT -i eth0 -p udp --sport 69 -m state \
--state ESTABLISHED -j ACCEPT
# service iptables save</pre>
</div>
</div>
</li>
<li>
<p>Load the <code>ip_conntrack_tftp</code> kernel TFTP state module.
In the <code>/etc/sysconfig/iptables-config</code> file, locate <code>IPTABLES_MODULES</code> and add <code>ip_conntrack_tftp</code> as follows:</p>
<div class="listingblock">
<div class="content">
<pre>IPTABLES_MODULES="ip_conntrack_tftp"</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_Networking-Adding_a_Domain_to_the_Satellite_Server">3.6. Adding a Domain to Satellite&#160;Server</h3>
<div class="paragraph">
<p>Satellite&#160;Server defines domain names for each host on the network.
Satellite&#160;Server must have information about the domain and Capsule&#160;Server responsible for domain name assignment.</p>
</div>
<div class="paragraph">
<div class="title">Checking for Existing Domains</div>
<p>Satellite&#160;Server might already have the relevant domain created as part of Satellite&#160;Server installation.
Switch the context to <code>Any Organization</code> and <code>Any Location</code> then check the domain list to see if it exists.</p>
</div>
<div class="paragraph">
<div class="title">DNS Server Configuration Considerations</div>
<p>During the DNS record creation, Satellite performs conflict DNS lookups to verify that the host name is not in active use.
This check runs against one of the following DNS servers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The system-wide resolver if <strong>Administer</strong> &gt; <strong>Settings</strong> &gt; <strong>Query local nameservers</strong> is set to <strong>true</strong>.</p>
</li>
<li>
<p>The nameservers that are defined in the subnet associated with the host.</p>
</li>
<li>
<p>The authoritative NS-Records that are queried from the SOA from the domain name associated with the host.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you experience timeouts during DNS conflict resolution, check the following settings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The subnet nameservers must be reachable from Satellite&#160;Server.</p>
</li>
<li>
<p>The domain name must have a Start of Authority (SOA) record available from Satellite&#160;Server.</p>
</li>
<li>
<p>The system resolver in the <code>/etc/resolv.conf</code> file must have a valid and working configuration.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To use the CLI instead of the web UI, see the <a href="#cli-adding-a-domain_provisioning">CLI procedure</a>.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To add a domain to Satellite, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Domains</strong> and click <strong>Create Domain</strong>.</p>
</li>
<li>
<p>In the <strong>DNS Domain</strong> field, enter the full DNS domain name.</p>
</li>
<li>
<p>In the <strong>Fullname</strong> field, enter the plain text name of the domain.</p>
</li>
<li>
<p>Click the <strong>Parameters</strong> tab and configure any domain level parameters to apply to hosts attached to this domain.
For example, user defined Boolean or string parameters to use in templates.</p>
</li>
<li>
<p>Click <strong>Add Parameter</strong> and fill in the <strong>Name</strong> and <strong>Value</strong> fields.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> tab, and add the location where the domain resides.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab, and add the organization that the domain belongs to.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the changes.</p>
</li>
</ol>
</div>
<div id="cli-adding-a-domain_provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Use the <code>hammer domain create</code> command to create a domain:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer domain create --name "<em>domain_name.com</em>" \
--description "<em>My example domain</em>" --dns-id 1 \
--locations "<em>My_Location</em>" --organizations "<em>My_Organization</em>"</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this example, the <code>--dns-id</code> option uses <code>1</code>, which is the ID of your integrated Capsule on Satellite&#160;Server.</p>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_Networking-Adding_a_Subnet_to_the_Satellite_Server">3.7. Adding a Subnet to Satellite&#160;Server</h3>
<div class="paragraph">
<p>You must add information for each of your subnets to Satellite&#160;Server because Satellite configures interfaces for new hosts.
To configure interfaces, Satellite&#160;Server must have all the information about the network that connects these interfaces.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the web UI, see the <a href="#cli-adding-a-subnet_provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Subnets</strong>, and in the Subnets window, click <strong>Create Subnet</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the subnet.</p>
</li>
<li>
<p>In the <strong>Description</strong> field, enter a description for the subnet.</p>
</li>
<li>
<p>In the <strong>Network address</strong> field, enter the network address for the subnet.</p>
</li>
<li>
<p>In the <strong>Network prefix</strong> field, enter the network prefix for the subnet.</p>
</li>
<li>
<p>In the <strong>Network mask</strong> field, enter the network mask for the subnet.</p>
</li>
<li>
<p>In the <strong>Gateway address</strong> field, enter the external gateway for the subnet.</p>
</li>
<li>
<p>In the <strong>Primary DNS server</strong> field, enter a primary DNS for the subnet.</p>
</li>
<li>
<p>In the <strong>Secondary DNS server</strong>, enter a secondary DNS for the subnet.</p>
</li>
<li>
<p>From the <strong>IPAM</strong> list, select the method that you want to use for IP address management (IPAM).
For more information about IPAM, see <a href="#networking_resources">Network Resources</a>.</p>
</li>
<li>
<p>Enter the information for the IPAM method that you select.
Click the <strong>Remote Execution</strong> tab and select the Capsule that controls the remote execution.</p>
</li>
<li>
<p>Click the <strong>Domains</strong> tab and select the domains that apply to this subnet.</p>
</li>
<li>
<p>Click the <strong>Capsules</strong> tab and select the Capsule that applies to each service in the subnet, including DHCP, TFTP, and reverse DNS services.</p>
</li>
<li>
<p>Click the <strong>Parameters</strong> tab and configure any subnet level parameters to apply to hosts attached to this subnet.
For example, user defined Boolean or string parameters to use in templates.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> tab and select the locations that use this Capsule.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab and select the organizations that use this Capsule.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the subnet information.</p>
</li>
</ol>
</div>
<div id="cli-adding-a-subnet_provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create the subnet with the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer subnet create --name "<em>My_Network</em>" \
--description "<em>your_description</em>" \
--network "192.168.140.0" --mask "255.255.255.0" \
--gateway "192.168.140.1" --dns-primary "192.168.140.2" \
--dns-secondary "8.8.8.8" --ipam "DHCP" \
--from "192.168.140.111" --to "192.168.140.250" --boot-mode "DHCP" \
--domains "<em>example.com</em>" --dhcp-id 1 --dns-id 1 --tftp-id 1 \
--locations "<em>My_Location</em>" --organizations "<em>My_Organization</em>"</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In this example, the <code>--dhcp-id</code>, <code>--dns-id</code>, and <code>--tftp-id</code> options use 1, which is the ID of the integrated Capsule in Satellite&#160;Server.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Infoblox-Integration">4. Using Infoblox as DHCP and DNS Providers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use Capsule&#160;Server to connect to your Infoblox application to create and manage DHCP and DNS records, and to reserve IP addresses.</p>
</div>
<div class="paragraph">
<p>The supported Infoblox version is NIOS 8.0 or higher and Satellite&#160;6.10 or higher.</p>
</div>
<div class="sect2">
<h3 id="_limitations">4.1. Limitations</h3>
<div class="paragraph">
<p>All DHCP and DNS records can be managed only in a single Network or DNS view.
After you install the Infoblox modules on Capsule and set up the view using the <code>satellite-installer</code> command, you cannot edit the view.</p>
</div>
<div class="paragraph">
<p>Capsule&#160;Server communicates with a single Infoblox node using the standard HTTPS web API.
If you want to configure clustering and High Availability, make the configurations in Infoblox.</p>
</div>
<div class="paragraph">
<p>Hosting PXE-related files using Infoblox&#8217;s TFTP functionality is not supported.
You must use Capsule as a TFTP server for PXE provisioning.
For more information, see <a href="#Configuring_Networking">Configuring Networking</a>.</p>
</div>
<div class="paragraph">
<p>Satellite IPAM feature cannot be integrated with Infoblox.</p>
</div>
</div>
<div class="sect2">
<h3 id="_prerequisites">4.2. Prerequisites</h3>
<div class="paragraph">
<p>You must have Infoblox account credentials to manage DHCP and DNS entries in Satellite.</p>
</div>
<div class="paragraph">
<p>Ensure that you have Infoblox administration roles with the names: <code>DHCP Admin</code> and <code>DNS Admin</code>.</p>
</div>
<div class="paragraph">
<p>The administration roles must have permissions or belong to an admin group that permits the accounts to perform tasks through the Infoblox API.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installing_the_infoblox_ca_certificate_on_capsuleserver">4.3. Installing the Infoblox CA Certificate on Capsule&#160;Server</h3>
<div class="paragraph">
<p>You must install Infoblox HTTPS CA certificate on the base system for all Capsules that you want to integrate with Infoblox applications.</p>
</div>
<div class="paragraph">
<p>You can download the certificate from the Infoblox web UI, or you can use the following OpenSSL commands to download the certificate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># update-ca-trust enable
# openssl s_client -showcerts -connect <em>infoblox.example.com</em>:443 &lt;/dev/null | \
openssl x509 -text &gt;/etc/pki/ca-trust/source/anchors/infoblox.crt
# update-ca-trust extract</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code><em>infoblox.example.com</em></code> entry must match the host name for the Infoblox application in the X509 certificate.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To test the CA certificate, use a CURL query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># curl -u admin:password https://<em>infoblox.example.com</em>/wapi/v2.0/network</pre>
</div>
</div>
<div class="paragraph">
<p>Example positive response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[
    {
        "_ref": "network/ZG5zLm5ldHdvcmskMTkyLjE2OC4yMDIuMC8yNC8w:<em>infoblox.example.com</em>/24/default",
        "network": "192.168.202.0/24",
        "network_view": "default"
    }
]</pre>
</div>
</div>
<div class="paragraph">
<p>Use the following Red&#160;Hat Knowledgebase article to install the certificate: <a href="https://access.redhat.com/solutions/1519813">How to install a CA certificate on Red Hat Enterprise Linux 6 / 7</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Infoblox-Integration-Installing_the_DHCP_Infoblox_Module">4.4. Installing the DHCP Infoblox module</h3>
<div class="paragraph">
<p>Use this procedure to install the DHCP Infoblox module on Capsule.
Note that you cannot manage records in separate views.</p>
</div>
<div class="paragraph">
<p>You can also install DHCP and DNS Infoblox modules simultaneously by combining this procedure and <a href="#Infoblox-Integration-Installing_the_DNS_Infoblox_Module">Installing the DNS Infoblox Module</a></p>
</div>
<div class="paragraph">
<div class="title">DHCP Infoblox Record Type Considerations</div>
<p>Use only the <code>--foreman-proxy-plugin-dhcp-infoblox-record-type fixedaddress</code> option to configure the DHCP and DNS modules.</p>
</div>
<div class="paragraph">
<p>Configuring both DHCP and DNS Infoblox modules with the <code>host</code> record type setting causes DNS conflicts and is not supported.
If you install the Infoblox module on Capsule&#160;Server with the <code>--foreman-proxy-plugin-dhcp-infoblox-record-type</code> option set to <code>host</code>, you must unset both DNS Capsule and Reverse DNS Capsule options because Infoblox does the DNS management itself.
You cannot use the <code>host</code> option without creating conflicts and, for example, being unable to rename hosts in Satellite.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To install the Infoblox module for DHCP, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On Capsule, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># satellite-installer --enable-foreman-proxy-plugin-dhcp-infoblox \
--foreman-proxy-dhcp true \
--foreman-proxy-dhcp-managed false \
--foreman-proxy-dhcp-provider infoblox \
--foreman-proxy-plugin-dhcp-infoblox-record-type fixedaddress \
--foreman-proxy-dhcp-server <em>infoblox.example.com</em> \
--foreman-proxy-plugin-dhcp-infoblox-username admin \
--foreman-proxy-plugin-dhcp-infoblox-password infoblox \
--foreman-proxy-plugin-dhcp-infoblox-network-view default \
--foreman-proxy-plugin-dhcp-infoblox-dns-view default</pre>
</div>
</div>
</li>
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Capsules</strong> and select the Capsule with the Infoblox DHCP module and click <strong>Refresh</strong>.</p>
</li>
<li>
<p>Ensure that the <strong>dhcp</strong> features are listed.</p>
</li>
<li>
<p>For all domains managed through Infoblox, ensure that the DNS Capsule is set for that domain.
To verify, in the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Domains</strong>, and inspect the settings of each domain.</p>
</li>
<li>
<p>For all subnets managed through Infoblox, ensure that DHCP Capsule and Reverse DNS Capsule is set.
To verify, in the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Subnets</strong>, and inspect the settings of each subnet.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Infoblox-Integration-Installing_the_DNS_Infoblox_Module">4.5. Installing the DNS Infoblox Module</h3>
<div class="paragraph">
<p>Use this procedure to install the DNS Infoblox module on Capsule.
You can also install DHCP and DNS Infoblox modules simultaneously by combining this procedure and <a href="#Infoblox-Integration-Installing_the_DHCP_Infoblox_Module">Installing the DHCP Infoblox module</a>.</p>
</div>
<div class="paragraph">
<p>DNS records are managed only in the default DNS view, it&#8217;s not possible to specify which DNS view to use.</p>
</div>
<div class="paragraph">
<p>To install the DNS Infoblox module, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On Capsule, enter the following command to configure the Infoblox module:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># satellite-installer --enable-foreman-proxy-plugin-dns-infoblox \
--foreman-proxy-dns true \
--foreman-proxy-dns-managed false \
--foreman-proxy-dns-provider infoblox \
--foreman-proxy-plugin-dns-infoblox-dns-server <em>infoblox.example.com</em> \
--foreman-proxy-plugin-dns-infoblox-username admin \
--foreman-proxy-plugin-dns-infoblox-password infoblox \
--foreman-proxy-plugin-dns-infoblox-dns-view default</pre>
</div>
</div>
<div class="paragraph">
<p>Optionally, you can change the value of the <code>--foreman-proxy-plugin-dns-infoblox-dns-view</code> option to specify a DNS Infoblox view other than the default view.</p>
</div>
</li>
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Capsules</strong> and select the Capsule with the Infoblox DNS module and click <strong>Refresh</strong>.</p>
</li>
<li>
<p>Ensure that the <strong>dns</strong> features are listed.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Configuring_Networking-Configuring_gPXE_to_Reduce_Provisioning_Times">5. Configuring iPXE to Reduce Provisioning Times</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use Satellite to configure PXELinux to chainboot iPXE in BIOS mode and boot using the HTTP protocol if you have the following restrictions that prevent you from using PXE:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A network with unmanaged DHCP servers.</p>
</li>
<li>
<p>A PXE service that is blacklisted on your network or restricted by a firewall.</p>
</li>
<li>
<p>An unreliable TFTP UDP-based protocol because of, for example, a low-bandwidth network.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated Jan 2022
</div>
</div>
</body>
</html>